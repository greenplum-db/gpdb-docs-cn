<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  
  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300italic,400italic,400,600' rel='stylesheet' type='text/css'>
  <!-- Use title if it's in the page YAML frontmatter -->
  <title>
      配置PXF HADOOP连接器 |
    Greenplum Database Docs
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/stylesheets/all.css" rel="stylesheet" media="screen, print" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href='/images/favicon.ico' rel='shortcut icon'>

  <script src="/javascripts/all.js"></script>
  
</head>

<body class="x6-0 x6-0_pxf x6-0_pxf_client_instcfg has-subnav">

<div class="viewport">
  <div class='wrap'>
    <script type="text/javascript">
      document.domain = "greenplum.org";
    </script>

     
  <header class="header header-layout">
    <h1 class="logo">
      <a href="/">Greenplum Database Documentation</a>
    </h1>
    
    <div class="header-links js-bar-links">
      <div class="btn-menu" data-behavior="MenuMobile"></div>
      <div class="header-item"><a href="https://greenplum.org">Back to Greenplum Database</a></div>
      <div class="header-item">
        <a href="https://github.com/greenplum-db/gpdb/wiki">Wiki</a>
      </div>
      
    </div>
  </header>


    <div class="container">

      <!--googleoff: index-->
      <div id="sub-nav" class="js-sidenav nav-container" role="navigation">
  <a class="sidenav-title" data-behavior="SubMenuMobile">  Doc Index</a>
  <div class="nav-content">
    <ul>
      <li>
        <a href="/v6/homenav.html">Greenplum数据库&reg; 6.0文档</a>
      </li>
      <li><a href="/v6/pxf/overview_pxf.html" format="markdown">Greenplum平台扩展框架(PXF)</a></li>
      <li class="has_submenu">
        <a href="/v6/pxf/intro_pxf.html" format="markdown">PXF介绍</a>
        <ul>
          <li><a href="/v6/pxf/filter_push.html" format="markdown">PXF谓词下推</a></li>
          <li><a href="/v6/pxf/col_project.html" format="markdown">PXF列投影</a></li>
        </ul>
      </li>
      <li class="has_submenu">
        <span>PXF管理手册</span>
        <ul>
          <li class="has_submenu">
            <a href="/v6/pxf/instcfg_pxf.html" format="markdown">配置PXF</a>
            <ul>
              <li><a href="/v6/pxf/about_pxf_dir.html" format="markdown">PXF安装和配置目录</a></li>
              <li><a href="/v6/pxf/install_java.html" format="markdown">为PXF安装JAVA环境</a></li>
              <li><a href="/v6/pxf/init_pxf.html" format="markdown">初始化PXF</a></li>
              <li><a href="/v6/pxf/cfg_server.html" format="markdown">配置PXF服务器</a></li>
              <li class="has_submenu">
                <a href="/v6/pxf/client_instcfg.html" format="markdown">配置PXF HADOOP连接器（可选）</a>
                <ul>
                  <li>
                    <a href="/v6/pxf/pxfuserimpers.html">配置用户模拟和代理</a>
                  </li>
                  <li>
                    <a href="/v6/pxf/pxf_kerbhdfs.html" format="markdown">为安全HDFS配置PXF</a>
                  </li>
                </ul>
              </li>
              <li><a href="/v6/pxf/s3_objstore_cfg.html" format="markdown">配置Minio和S3对象存储的连接器（可选）</a> </li>
              <li><a href="/v6/pxf/objstore_cfg.html" format="markdown">配置Azure和Google云端存储的连接器（可选）</a> </li>
              <li><a href="/v6/pxf/jdbc_cfg.html" format="markdown">配置JDBC连接器（可选）</a> </li>
              <li><a href="/v6/pxf/cfghostport.html" format="markdown">配置PXF客户端主机和端口(可选)</a> </li>
            </ul>
          </lie>
          <li><a href="/v6/pxf/upgrade_pxf.html" format="markdown">升级PXF</a></li>
          <li><a href="/v6/pxf/cfginitstart_pxf.html" format="markdown">PXF的启动、停止和重启</a></li>
          <li><a href="/v6/pxf/using_pxf.html" format="markdown">授权用户访问PXF</a></li>
          <li><a href="/v6/pxf/reg_jar_depend.html" format="markdown">注册PXF的jar依赖</a></li>
          <li><a href="/v6/pxf/monitor_pxf.html" format="markdown">监控PXF</a></li>
        </ul>
      </li>
      <li class="has_submenu">
        <a href="/v6/pxf/access_hdfs.html" format="markdown">使用PXF访问hadoop</a>
        <ul>
          <li><a href="/v6/pxf/hdfs_text.html" format="markdown">读写文本数据</a></li>
          <li><a href="/v6/pxf/hdfs_avro.html" format="markdown">读取Avro数据</a></li>
          <li><a href="/v6/pxf/hdfs_json.html" format="markdown">读取JSON数据</a></li>
          <li><a href="/v6/pxf/hdfs_parquet.html" format="markdown">读写Parquet数据</a></li>
          <li><a href="/v6/pxf/hdfs_seqfile.html" format="markdown">读写SequenceFile数据</a></li>
          <li><a href="/v6/pxf/hdfs_fileasrow.html" format="markdown">将多行文本文件读入单个表行</a></li>
          <li><a href="/v6/pxf/hive_pxf.html" format="markdown">读取Hive表数据</a></li>
          <li><a href="/v6/pxf/hbase_pxf.html" format="markdown">读取HBase表数据</a></li>
        </ul>
      </li>
      <li class="has_submenu">
        <a href="/v6/pxf/access_objstore.html" format="markdown">使用PXF访问Azure，Google云端存储，Minio和S3对象存储</a>
        <ul>
          <li><a href="/v6/pxf/access_s3.html" format="markdown">About Accessing the S3 Object Store</a></li>
          <li><a href="/v6/pxf/objstore_text.html" format="markdown">读取和写入文本数据</a></li>
          <li><a href="/v6/pxf/objstore_avro.html" format="markdown">读取Avro数据</a></li>
          <li><a href="/v6/pxf/objstore_json.html" format="markdown">读取JSON数据</a></li>
          <li><a href="/v6/pxf/objstore_parquet.html" format="markdown">读写Parquet数据</a></li>
          <li><a href="/v6/pxf/objstore_seqfile.html" format="markdown">读写SequenceFile数据</a></li>
          <li><a href="/v6/pxf/objstore_fileasrow.html" format="markdown">将多行文本文件读入单个表行</a></li>
          <li><a href="/v6/pxf/read_s3_s3select.html" format="markdown">使用S3 Select从S3读取CSV和Parquet数据</a></li>
        </ul>
      </li>
      <li><a href="/v6/pxf/jdbc_pxf.html" format="markdown">使用PXF访问SQL数据库（JDBC）</a></li>
      <li><a href="/v6/pxf/troubleshooting_pxf.html" format="markdown">PXF故障排除</a></li>
      <li class="has_submenu">
        <a href="/v6/pxf/ref/pxf-ref.html" format="markdown">PXF实用程序手册</a>
        <ul>
          <li><a href="/v6/pxf/ref/pxf-cluster.html" format="markdown">pxf cluster</a></li>
          <li><a href="/v6/pxf/ref/pxf.html" format="markdown">pxf</a></li>
        </ul>
      </li>
      <!--li class="has_submenu">
        <a href="/v6/pxf/sdk/dev_overview.html" format="markdown">Using the PXF Java SDK</a>
        <ul>
          <li>
            <a href="/v6/pxf/sdk/dev_concepts.html" format="markdown">PXF Developer Concepts</a>
          </li>
          <li>
            <a href="/v6/pxf/sdk/pxfapi.html" format="markdown">Introducing the PXF API</a>
          </li>
          <li>
            <a href="/v6/pxf/sdk/build_conn.html" format="markdown">Building a Connector</a>
          </li>
          <li class="has_submenu">
            <a href="/v6/pxf/sdk/deploy_conn.html" format="markdown">Deploying a Connector</a>
            <ul>
              <li>
            <a href="/v6/pxf/sdk/deploy_profile.html" format="markdown">Deploying a Profile</a>
              </li>
            </ul>
          </li>
        </ul>
      </li-->
      <li>
         <a href="/v6/admin_guide/external/pxf-overview.html" format="dita" scope="peer">Back to the Administrator Guide</a>
      </li>
    </ul>
  </div>
</div>
<!--end of sub-nav-->

      <!--googleon: index-->

      <main class="content content-layout" id="js-content" role="main">
        <a id="top"></a>
        
          <h1 class="title-container" >
    配置PXF HADOOP连接器
  </h1>

          <div id="js-quick-links" >
            <div class="quick-links"><ul>
<li><a href="#prereq">&#20934;&#22791;</a></li>
<li><a href="#client-pxf-config-steps">&#36807;&#31243;</a></li>
<li><a href="#client-cfg-update">&#26356;&#26032;hadoop&#37197;&#32622;</a></li>
</ul></div>
          </div>
        <div class="to-top" id="js-to-top">
          <a href="#top" title="back to top"></a>
        </div>
        <p>PXF与Cloudera，Hortonworks Data Platform，MapR和通用Apache Hadoop发行版兼容。 本主题描述如何配置PXF Hadoop，Hive和HBase连接器。</p>

<p><em>如果您不想使用与Hadoop相关的PXF连接器，则无需执行此过程。</em></p>

<h2 id="准备"><a id="prereq"></a>准备</h2>

<p>配置PXF Hadoop连接器需要将配置文件从Hadoop群集复制到Greenplum master主机。如果你使用的是MapR Hadoop发行版，则还必须将某些JAR文件复制到master主机。在配置PXF Hadoop连接器之前，请确保可以将文件从Hadoop群集中的主机复制到Greenplum数据库master服务器。</p>

<h2 id="过程"><a id="client-pxf-config-steps"></a>过程</h2>

<p>在GPDB master主机上执行以下操作去配置PXF映射hadoop的连接器。在你配置连接器完成后，需要运行<code>pxf cluster sync</code>命令拷贝PXF的配置到Greenplum数据库集群。
在此过程中，您将使用<code>default</code>，或创建新的PXF服务器配置。您将Hadoop配置文件复制到Greenplum数据库master主机上的服务器配置目录。您也可以将库复制到<code>$PXF_CONF/lib</code>以获取MapR支持。然后，您可以将master主机上的PXF配置同步到standby和segment主机。(当您运行<code>pxf cluster init</code>时，PXF将创建<code>$PXF_CONF/*</code>目录。)</p>

<ol>
<li><p>登录到GPDB master节点:</p>
<pre class="highlight shell"><code><span class="gp">$ </span>ssh gpadmin@&lt;gpmaster&gt;
</code></pre></li>
<li><p>确定您的PXF Hadoop服务器配置的名称。如果您的Hadoop集群是Kerberized，则必须使用<code>default</code>PXF服务器。</p></li>
<li><p>如果您没有使用默认的PXF服务器，请创建<code>$PXF_HOME/servers/&lt;server_name&gt;</code>目录。例如，使用以下命令创建名为<code>hdp3</code>的Hadoop服务器配置：</p>
<pre class="highlight shell"><code><span class="gp">gpadmin@gpmaster$ </span>mkdir <span class="nv">$PXF_CONF</span>/servers/hdp3
</code></pre></li>
<li><p>转到服务器目录。例如：</p>
<pre class="highlight shell"><code><span class="gp">gpadmin@gpmaster$ </span><span class="nb">cd</span> <span class="nv">$PXF_CONF</span>/servers/default
</code></pre>

<p>或，</p>
<pre class="highlight shell"><code><span class="gp">gpadmin@gpmaster$ </span><span class="nb">cd</span> <span class="nv">$PXF_CONF</span>/servers/hdp3
</code></pre></li>
<li><p>PXF服务需要从<code>core-site.xml</code>和其他Hadoop配置文件中获取需要的信息。使用你选择的工具从你的Hadoop集群namenode节点主机上拷贝<code>core-site.xml</code>、<code>hdfs-site.xml</code>、<code>mapred-site.xml</code>和<code>yarn-site.xml</code>文件到当前主机上(您的文件路径可能会根据使用的Hadoop发行版而有所不同)。例如，这些命令使用<code>scp</code>去拷贝文件：</p>
<pre class="highlight shell"><code><span class="gp">gpadmin@gpmaster$ </span><span class="nb">cd</span> <span class="nv">$PXF_CONF</span>/servers/default
<span class="gp">gpadmin@gpmaster$ </span>scp hdfsuser@namenode:/etc/hadoop/conf/core-site.xml .
<span class="gp">gpadmin@gpmaster$ </span>scp hdfsuser@namenode:/etc/hadoop/conf/hdfs-site.xml .
<span class="gp">gpadmin@gpmaster$ </span>scp hdfsuser@namenode:/etc/hadoop/conf/mapred-site.xml .
<span class="gp">gpadmin@gpmaster$ </span>scp hdfsuser@namenode:/etc/hadoop/conf/yarn-site.xml .
</code></pre></li>
<li><p>如果你想要使用PXF的HIVE连接器访问hive表的数据，同样拷贝hive的配置到GPDB master上。例如：</p>
<pre class="highlight shell"><code><span class="gp">gpadmin@gpmaster$ </span>scp hiveuser@hivehost:/etc/hive/conf/hive-site.xml .
</code></pre></li>
<li><p>如果你想要使用PXF的HBASE连接器访问hbase表数据，同样需要拷贝hbase的配置到GPDB master上。例如:</p>
<pre class="highlight shell"><code><span class="gp">gpadmin@gpmaster$ </span>scp hbaseuser@hbasehost:/etc/hbase/conf/hbase-site.xml .
</code></pre></li>
<li><p>如果你要使用PXF访问MapR Hadoop发行版，你必须要从你的MapR拷贝匹配的JAR文件到GPDB master上(您的文件路径可能会根据使用的MapR版本而有所不同)。例如：这些是使用<code>scp</code>命令拷贝文件</p>
<pre class="highlight shell"><code><span class="gp">gpadmin@gpmaster$ </span><span class="nb">cd</span> <span class="nv">$PXF_CONF</span>/lib
<span class="gp">gpadmin@gpmaster$ </span>scp mapruser@maprhost:/opt/mapr/hadoop/hadoop-2.7.0/share/hadoop/common/lib/maprfs-5.2.2-mapr.jar .
<span class="gp">gpadmin@gpmaster$ </span>scp mapruser@maprhost:/opt/mapr/hadoop/hadoop-2.7.0/share/hadoop/common/lib/hadoop-auth-2.7.0-mapr-1707.jar .
<span class="gp">gpadmin@gpmaster$ </span>scp mapruser@maprhost:/opt/mapr/hadoop/hadoop-2.7.0/share/hadoop/common/hadoop-common-2.7.0-mapr-1707.jar .
</code></pre></li>
<li><p>同步PXF的配置到Greenplum数据库集群。例如：</p>
<pre class="highlight shell"><code><span class="gp">gpadmin@gpmaster$ </span><span class="nv">$GPHOME</span>/pxf/bin/pxf cluster sync
</code></pre></li>
<li><p>Greenplum数据库最终用户访问Hadoop服务。默认情况下，PXF服务尝试使用GPDB的用户去验证访问HDFS, Hive, and HBase。为了支持此功能，如果要使用这些PXF连接器，则必须为Hadoop以及Hive和HBase配置代理设置。参照<a href="/v6/pxf/pxfuserimpers.html">Configuring User Impersonation and Proxying</a> 中的过程为Hadoop服务配置用户模拟和代理，或关闭PXF用户模拟。</p></li>
<li><p>授予HDFS文件和目录的读取权限，这些文件和目录将作为Greenplum数据库中的外部表进行访问。 如果启用了用户模拟(默认设置)，则必须向每个Greenplum数据库用户/角色名称授予此权限，这些用户/角色名称将使用引用HDFS文件的外部表。如果未启用用户模拟，则必须将此权限授予gpadmin用户。</p></li>
<li><p>如果您的Hadoop集群使用Kerberos保护，则为安全HDFS配置PXF必须为每个segment主机生成Kerberos主体和密钥表。</p></li>
</ol>

<h2 id="更新hadoop配置"><a id="client-cfg-update"></a>更新hadoop配置</h2>

<p>在PXF服务运行时，如果你想要更新Hadoop、Hive或者HBase的配置，你必须在你的GPDB集群上重新同步PXF的配置并且在每个segment节点上重启pxf服务。例如：</p>
<pre class="highlight shell"><code><span class="gp">gpadmin@gpmaster$ </span><span class="nb">cd</span> <span class="nv">$PXF_CONF</span>/servers/&lt;server_name&gt;
<span class="gp">gpadmin@gpmaster$ </span>scp hiveuser@hivehost:/etc/hive/conf/hive-site.xml .
<span class="gp">gpadmin@gpmaster$ </span><span class="nv">$GPHOME</span>/pxf/bin/pxf cluster sync
</code></pre>

        

      </main>
    </div>
  </div>
</div>

<div id="scrim"></div>

<div class="container">
  <footer class="site-footer-links">
    
  </footer>
</div><!--end of container-->

</body>
</html>
