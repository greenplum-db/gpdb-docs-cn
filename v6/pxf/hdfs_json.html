<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  
  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300italic,400italic,400,600' rel='stylesheet' type='text/css'>
  <!-- Use title if it's in the page YAML frontmatter -->
  <title>
      从HDFS从读取JSON数据 |
    Greenplum Database Docs
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/stylesheets/all.css" rel="stylesheet" media="screen, print" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href='/images/favicon.ico' rel='shortcut icon'>

  <script src="/javascripts/all.js"></script>
  
</head>

<body class="x6-0 x6-0_pxf x6-0_pxf_hdfs_json has-subnav">

<div class="viewport">
  <div class='wrap'>
    <script type="text/javascript">
      document.domain = "greenplum.org";
    </script>

     
  <header class="header header-layout">
    <h1 class="logo">
      <a href="/">Greenplum Database Documentation</a>
    </h1>
    
    <div class="header-links js-bar-links">
      <div class="btn-menu" data-behavior="MenuMobile"></div>
      <div class="header-item"><a href="https://greenplum.org">Back to Greenplum Database</a></div>
      <div class="header-item">
        <a href="https://github.com/greenplum-db/gpdb/wiki">Wiki</a>
      </div>
      
    </div>
  </header>


    <div class="container">

      <!--googleoff: index-->
      <div id="sub-nav" class="js-sidenav nav-container" role="navigation">
  <a class="sidenav-title" data-behavior="SubMenuMobile">  Doc Index</a>
  <div class="nav-content">
    <ul>
      <li>
        <a href="/v6/homenav.html">Greenplum数据库&reg; 6.0文档</a>
      </li>
      <li><a href="/v6/pxf/overview_pxf.html" format="markdown">Greenplum平台扩展框架(PXF)</a></li>
      <li class="has_submenu">
        <a href="/v6/pxf/intro_pxf.html" format="markdown">PXF介绍</a>
        <ul>
          <li><a href="/v6/pxf/filter_push.html" format="markdown">PXF谓词下推</a></li>
          <li><a href="/v6/pxf/col_project.html" format="markdown">PXF列投影</a></li>
        </ul>
      </li>
      <li class="has_submenu">
        <span>PXF管理手册</span>
        <ul>
          <li class="has_submenu">
            <a href="/v6/pxf/instcfg_pxf.html" format="markdown">配置PXF</a>
            <ul>
              <li><a href="/v6/pxf/about_pxf_dir.html" format="markdown">PXF安装和配置目录</a></li>
              <li><a href="/v6/pxf/install_java.html" format="markdown">为PXF安装JAVA环境</a></li>
              <li><a href="/v6/pxf/init_pxf.html" format="markdown">初始化PXF</a></li>
              <li><a href="/v6/pxf/cfg_server.html" format="markdown">配置PXF服务器</a></li>
              <li class="has_submenu">
                <a href="/v6/pxf/client_instcfg.html" format="markdown">配置PXF HADOOP连接器（可选）</a>
                <ul>
                  <li>
                    <a href="/v6/pxf/pxfuserimpers.html">配置用户模拟和代理</a>
                  </li>
                  <li>
                    <a href="/v6/pxf/pxf_kerbhdfs.html" format="markdown">为安全HDFS配置PXF</a>
                  </li>
                </ul>
              </li>
              <li><a href="/v6/pxf/s3_objstore_cfg.html" format="markdown">配置Minio和S3对象存储的连接器（可选）</a> </li>
              <li><a href="/v6/pxf/objstore_cfg.html" format="markdown">配置Azure和Google云端存储的连接器（可选）</a> </li>
              <li><a href="/v6/pxf/jdbc_cfg.html" format="markdown">配置JDBC连接器（可选）</a> </li>
              <li><a href="/v6/pxf/cfghostport.html" format="markdown">配置PXF客户端主机和端口(可选)</a> </li>
            </ul>
          </lie>
          <li><a href="/v6/pxf/upgrade_pxf.html" format="markdown">升级PXF</a></li>
          <li><a href="/v6/pxf/cfginitstart_pxf.html" format="markdown">PXF的启动、停止和重启</a></li>
          <li><a href="/v6/pxf/using_pxf.html" format="markdown">授权用户访问PXF</a></li>
          <li><a href="/v6/pxf/reg_jar_depend.html" format="markdown">注册PXF的jar依赖</a></li>
          <li><a href="/v6/pxf/monitor_pxf.html" format="markdown">监控PXF</a></li>
        </ul>
      </li>
      <li class="has_submenu">
        <a href="/v6/pxf/access_hdfs.html" format="markdown">使用PXF访问hadoop</a>
        <ul>
          <li><a href="/v6/pxf/hdfs_text.html" format="markdown">读写文本数据</a></li>
          <li><a href="/v6/pxf/hdfs_avro.html" format="markdown">读取Avro数据</a></li>
          <li><a href="/v6/pxf/hdfs_json.html" format="markdown">读取JSON数据</a></li>
          <li><a href="/v6/pxf/hdfs_parquet.html" format="markdown">读写Parquet数据</a></li>
          <li><a href="/v6/pxf/hdfs_seqfile.html" format="markdown">读写SequenceFile数据</a></li>
          <li><a href="/v6/pxf/hdfs_fileasrow.html" format="markdown">将多行文本文件读入单个表行</a></li>
          <li><a href="/v6/pxf/hive_pxf.html" format="markdown">读取Hive表数据</a></li>
          <li><a href="/v6/pxf/hbase_pxf.html" format="markdown">读取HBase表数据</a></li>
        </ul>
      </li>
      <li class="has_submenu">
        <a href="/v6/pxf/access_objstore.html" format="markdown">使用PXF访问Azure，Google云端存储，Minio和S3对象存储</a>
        <ul>
          <li><a href="/v6/pxf/access_s3.html" format="markdown">About Accessing the S3 Object Store</a></li>
          <li><a href="/v6/pxf/objstore_text.html" format="markdown">读取和写入文本数据</a></li>
          <li><a href="/v6/pxf/objstore_avro.html" format="markdown">读取Avro数据</a></li>
          <li><a href="/v6/pxf/objstore_json.html" format="markdown">读取JSON数据</a></li>
          <li><a href="/v6/pxf/objstore_parquet.html" format="markdown">读写Parquet数据</a></li>
          <li><a href="/v6/pxf/objstore_seqfile.html" format="markdown">读写SequenceFile数据</a></li>
          <li><a href="/v6/pxf/objstore_fileasrow.html" format="markdown">将多行文本文件读入单个表行</a></li>
          <li><a href="/v6/pxf/read_s3_s3select.html" format="markdown">使用S3 Select从S3读取CSV和Parquet数据</a></li>
        </ul>
      </li>
      <li><a href="/v6/pxf/jdbc_pxf.html" format="markdown">使用PXF访问SQL数据库（JDBC）</a></li>
      <li><a href="/v6/pxf/troubleshooting_pxf.html" format="markdown">PXF故障排除</a></li>
      <li class="has_submenu">
        <a href="/v6/pxf/ref/pxf-ref.html" format="markdown">PXF实用程序手册</a>
        <ul>
          <li><a href="/v6/pxf/ref/pxf-cluster.html" format="markdown">pxf cluster</a></li>
          <li><a href="/v6/pxf/ref/pxf.html" format="markdown">pxf</a></li>
        </ul>
      </li>
      <!--li class="has_submenu">
        <a href="/v6/pxf/sdk/dev_overview.html" format="markdown">Using the PXF Java SDK</a>
        <ul>
          <li>
            <a href="/v6/pxf/sdk/dev_concepts.html" format="markdown">PXF Developer Concepts</a>
          </li>
          <li>
            <a href="/v6/pxf/sdk/pxfapi.html" format="markdown">Introducing the PXF API</a>
          </li>
          <li>
            <a href="/v6/pxf/sdk/build_conn.html" format="markdown">Building a Connector</a>
          </li>
          <li class="has_submenu">
            <a href="/v6/pxf/sdk/deploy_conn.html" format="markdown">Deploying a Connector</a>
            <ul>
              <li>
            <a href="/v6/pxf/sdk/deploy_profile.html" format="markdown">Deploying a Profile</a>
              </li>
            </ul>
          </li>
        </ul>
      </li-->
      <li>
         <a href="/v6/admin_guide/external/pxf-overview.html" format="dita" scope="peer">Back to the Administrator Guide</a>
      </li>
    </ul>
  </div>
</div>
<!--end of sub-nav-->

      <!--googleon: index-->

      <main class="content content-layout" id="js-content" role="main">
        <a id="top"></a>
        
          <h1 class="title-container" >
    从HDFS从读取JSON数据
  </h1>

          <div id="js-quick-links" >
            <div class="quick-links"><ul>
<li><a href="#prereq">&#20808;&#20915;&#26465;&#20214;</a></li>
<li>
<a href="#hdfsjson_work">&#20351;&#29992;JSON&#25968;&#25454;</a><ul>
<li><a href="#datatypemap_json">JSON&#21040;Greenplum&#25968;&#25454;&#24211;&#25968;&#25454;&#31867;&#22411;&#26144;&#23556;</a></li>
<li><a href="#topic_jsonreadmodes">JSON&#25968;&#25454;&#35835;&#21462;&#27169;&#24335;</a></li>
</ul>
</li>
<li><a href="#jsontohdfs">&#23558;&#26679;&#26412;JSON&#25968;&#25454;&#21152;&#36733;&#21040;HDFS</a></li>
<li><a href="#json_cet">&#21019;&#24314;&#22806;&#37096;&#34920;</a></li>
<li><a href="#jsonexample1">&#31034;&#20363;&#65306;&#35835;&#21462;&#21333;&#34892;&#35760;&#24405;&#30340;JSON&#25991;&#20214;</a></li>
</ul></div>
          </div>
        <div class="to-top" id="js-to-top">
          <a href="#top" title="back to top"></a>
        </div>
        <!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->

<p>使用PXF HDFS连接器读取JSON格式数据的数据。本节描述了如何使用PXF访问HDFS中的JSON数据，包括如何创建和查询引用HDFS中JSON文件的外部表。</p>

<h2 id="先决条件"><a id="prereq"></a>先决条件</h2>

<p>在尝试从HDFS读取或向HDFS写入数据之前，请确保已满足PXF Hadoop<a href="/v6/pxf/access_hdfs.html#hadoop_prereq">先决条件</a>。</p>

<h2 id="使用json数据"><a id="hdfsjson_work"></a>使用JSON数据</h2>

<p>JSON是基于文本的数据交换格式。JSON数据通常存储在带有 <code>.json</code>后缀的文件中。</p>

<p><code>.json</code>文件将包含对象的集合。JSON对象是无序键/值对的集合。值可以是字符串(string)、数字(number)、true、false、null或对象(object)或数组(array)。您可以定义嵌套的JSON对象和数组。</p>

<p>样本JSON数据文件内容：</p>
<pre class="highlight json"><code><span class="w">  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"created_at"</span><span class="p">:</span><span class="s2">"MonSep3004:04:53+00002013"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"id_str"</span><span class="p">:</span><span class="s2">"384529256681725952"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"user"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="mi">31424214</span><span class="p">,</span><span class="w">
      </span><span class="nt">"location"</span><span class="p">:</span><span class="s2">"COLUMBUS"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"coordinates"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"Point"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"values"</span><span class="p">:[</span><span class="w">
         </span><span class="mi">13</span><span class="p">,</span><span class="w">
         </span><span class="mi">99</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre>

<p>在上述的示例中，<code>user</code>是一个由名为<code>id</code>和<code>location</code>的字段组成的对象。要将<code>user</code>对象中的嵌套字段指定为Greenplum数据库外部表列，请使用<code>.</code>映射：</p>
<pre class="highlight plaintext"><code>user.id
user.location
</code></pre>

<p><code>coordinates</code>是一个由名为<code>type</code>字段和名为<code>values</code>的整数数组组成的对象。使用<code>[]</code>来指定特定<code>values</code>数组中特定的元素作为Greenplum数据库外部表的列：</p>
<pre class="highlight plaintext"><code>coordinates.values[0]
coordinates.values[1]
</code></pre>

<p>有关JSON语法的详细信息，请参阅<a href="http://www.json.org/">JSON 简介</a>。</p>

<h3 id="json到greenplum数据库数据类型映射"><a id="datatypemap_json"></a>JSON到Greenplum数据库数据类型映射</a></h3>

<p>要在Greenplum数据库中表示JSON数据，请将使用基本数据类型的值映射到相同类型的Greenplum数据库列。JSON支持复杂的数据类型包括投影和数组。 使用N级投影将嵌套对象和数组的成员映射到基本数据类型。</p>

<p>下表总结了JSON数据的外部映射规则。</p>

<p><caption><span class="tablecap">表1. JSON映射</span></caption></p>

<p><a id="topic_table_jsondatamap"></a></p>

<table><thead>
<tr>
<th>JSON 数据类型</th>
<th>PXF/Greenplum Data Type</th>
</tr>
</thead><tbody>
<tr>
<td>基本类型(integer, float, string, boolean, null)</td>
<td>使用相应的Greenplum数据库内置数据类型；请参阅<a href="/v6/ref_guide/data_types.html">Greenplum数据库数据类型</a>.</td>
</tr>
<tr>
<td>数组(Array)</td>
<td>使用<code>[]</code>括号标识基本数据类型数组特定成员的索引。</td>
</tr>
<tr>
<td>对象(Object)</td>
<td>使用<code>.</code>点号指定基本类型的每一层投影(嵌套)。</td>
</tr>
</tbody></table>

<h3 id="json数据读取模式"><a id="topic_jsonreadmodes"></a>JSON数据读取模式</h3>

<p>PXF支持两种数据读取模式。默认模式是每行一条完成的JSON记录。PXF还支持对跨多行的JSON记录进行操作的读取模式。</p>

<p>在接下来的示例中，您将使用两种模式对样本数据集进行操作。样本数据集的模式定义具有以下成员名称和数据类型的对象：</p>

<ul>
<li>&ldquo;created_at&rdquo; - text</li>
<li>&ldquo;id_str&rdquo; - text</li>
<li>&ldquo;user&rdquo; - object

<ul>
<li>&ldquo;id&rdquo; - integer</li>
<li>&ldquo;location&rdquo; - text</li>
</ul></li>
<li>&ldquo;coordinates&rdquo; - object (可选)

<ul>
<li>&ldquo;type&rdquo; - text</li>
<li>&ldquo;values&rdquo; - array

<ul>
<li>[0] - integer</li>
<li>[1] - integer</li>
</ul></li>
</ul></li>
</ul>

<p>每行单条JSON记录数据如下：</p>
<pre class="highlight plaintext"><code>{"created_at":"FriJun0722:45:03+00002013","id_str":"343136551322136576","user":{
"id":395504494,"location":"NearCornwall"},"coordinates":{"type":"Point","values"
: [ 6, 50 ]}},
{"created_at":"FriJun0722:45:02+00002013","id_str":"343136547115253761","user":{
"id":26643566,"location":"Austin,Texas"}, "coordinates": null},
{"created_at":"FriJun0722:45:02+00002013","id_str":"343136547136233472","user":{
"id":287819058,"location":""}, "coordinates": null}
</code></pre>

<p>这是用于多行JSON数据的数据集:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"root"</span><span class="p">:[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"record_obj"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"created_at"</span><span class="p">:</span><span class="s2">"MonSep3004:04:53+00002013"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"id_str"</span><span class="p">:</span><span class="s2">"384529256681725952"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"user"</span><span class="p">:{</span><span class="w">
          </span><span class="nt">"id"</span><span class="p">:</span><span class="mi">31424214</span><span class="p">,</span><span class="w">
          </span><span class="nt">"location"</span><span class="p">:</span><span class="s2">"COLUMBUS"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"coordinates"</span><span class="p">:</span><span class="kc">null</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"record_obj"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"created_at"</span><span class="p">:</span><span class="s2">"MonSep3004:04:54+00002013"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"id_str"</span><span class="p">:</span><span class="s2">"384529260872228864"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"user"</span><span class="p">:{</span><span class="w">
          </span><span class="nt">"id"</span><span class="p">:</span><span class="mi">67600981</span><span class="p">,</span><span class="w">
          </span><span class="nt">"location"</span><span class="p">:</span><span class="s2">"KryberWorld"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"coordinates"</span><span class="p">:{</span><span class="w">
          </span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"Point"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"values"</span><span class="p">:[</span><span class="w">
             </span><span class="mi">8</span><span class="p">,</span><span class="w">
             </span><span class="mi">52</span><span class="w">
          </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>在下一节中您将为示例数据集创建JSON文件，并将其添加到HDFS中。</p>

<h2 id="将样本json数据加载到hdfs"><a id="jsontohdfs"></a>将样本JSON数据加载到HDFS</h2>

<p>PXF HDFS连接器读取存储在HDFS本地的JSON文件。在使用Greenplum数据库查询JSON格式数据之前，该数据必须存在于HDFS中。</p>

<p>将上面的单行JSON记录样本数据集复制并黏贴到名为<code>singleline.json</code>的文件中。同样的，将多行JSON记录数据集复制并黏贴到名为<code>multiline.json</code>的文件中。</p>

<p><strong>注意</strong>: 确保JSON文件中<strong>没有</strong>空白行。</p>

<p>将您刚创建的文件复制到HDFS中。如果您在上一个练习中没有创建<code>/data/pxf_examples</code>目录，请创建它。例如：</p>
<pre class="highlight shell"><code><span class="gp">$ </span>hdfs dfs -mkdir /data/pxf_examples
<span class="gp">$ </span>hdfs dfs -put singleline.json /data/pxf_examples
<span class="gp">$ </span>hdfs dfs -put multiline.json /data/pxf_examples
</code></pre>

<p>数据加载到HDFS后，您可以使用Greenplum数据库和PXF查询和分析JSON数据。</p>

<h2 id="创建外部表"><a id="json_cet"></a>创建外部表</h2>

<p>使用<code>hdfs:json</code>配置文件从HDFS中读取JSON格式的文件。以下语法创建一个引用此类文件的Greenplum数据库可读外部表：</p>
<pre class="highlight sql"><code><span class="k">CREATE</span> <span class="k">EXTERNAL</span> <span class="k">TABLE</span> <span class="o">&lt;</span><span class="k">table_name</span><span class="o">&gt;</span>
    <span class="p">(</span> <span class="o">&lt;</span><span class="k">column_name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">data_type</span><span class="o">&gt;</span> <span class="p">[,</span> <span class="p">...]</span> <span class="o">|</span> <span class="k">LIKE</span> <span class="o">&lt;</span><span class="n">other_table</span><span class="o">&gt;</span> <span class="p">)</span>
<span class="k">LOCATION</span> <span class="p">(</span><span class="s1">'pxf://&lt;path-to-hdfs-file&gt;?PROFILE=hdfs:json[&amp;SERVER=&lt;server_name&gt;][&amp;&lt;custom-option&gt;=&lt;value&gt;[...]]'</span><span class="p">)</span>
<span class="n">FORMAT</span> <span class="s1">'CUSTOM'</span> <span class="p">(</span><span class="n">FORMATTER</span><span class="o">=</span><span class="s1">'pxfwritable_import'</span><span class="p">);</span>
</code></pre>

<p><a href="/v6/ref_guide/sql_commands/CREATE_EXTERNAL_TABLE.html">CREATE EXTERNAL TABLE</a>命令中使用的特定关键字和值见下表中描述。</p>

<table><thead>
<tr>
<th>关键字</th>
<th>值</th>
</tr>
</thead><tbody>
<tr>
<td>&lt;path&#8209;to&#8209;hdfs&#8209;file&gt;</td>
<td>HDFS数据存储中目录或文件的绝对路径</td>
</tr>
<tr>
<td>PROFILE</td>
<td><code>PROFILE</code>关键字必须指定为<code>hdfs:json</code></td>
</tr>
<tr>
<td>SERVER=&lt;server_name&gt;</td>
<td>PXF用于访问数据的命名服务器配置。可选的; 如果未指定，PXF将使用<code>default</code>服务器。</td>
</tr>
<tr>
<td>&lt;custom&#8209;option&gt;</td>
<td>&lt;custom-option&gt;描述见下方</td>
</tr>
<tr>
<td>FORMAT &lsquo;CUSTOM&rsquo;</td>
<td>在 <code>hdfs:json</code>配置文件中使用 <code>FORMAT</code> <code>&#39;CUSTOM&#39;</code> 。 <code>CUSTOM</code> <code>FORMAT</code> 要求您指定为 <code>(FORMATTER=&#39;pxfwritable_import&#39;)</code>。</td>
</tr>
</tbody></table>

<p><a id="customopts"></a>
PXF支持单行和多行JSON记录。当您想读取多行JSON记录时，必须提供<code>IDENTIFIER</code> &lt;custom-option&gt; 和值。 使用这个&lt;custom-option&gt;标识JSON记录对象中第一个字段的成员名称：</p>

<table><thead>
<tr>
<th>选项关键字</th>
<th>&nbsp;&nbsp;语法、&nbsp;&nbsp;示例&nbsp;&nbsp;</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>IDENTIFIER</td>
<td><code>&amp;IDENTIFIER=&lt;value&gt;</code><br><code>&amp;IDENTIFIER=created_at</code></td>
<td>仅在访问多行JSON记录时，才必须在<code>LOCATION</code>字符串中指定<code>IDENTIFIER</code>关键字和值。 使用这个值标识JSON记录对象中第一个字段的成员名称。</td>
</tr>
</tbody></table>

<h2 id="示例：读取单行记录的json文件"><a id="jsonexample1"></a>示例：读取单行记录的JSON文件</h2>

<p>使用以下<a href="/v6/ref_guide/sql_commands/CREATE_EXTERNAL_TABLE.html">CREATE EXTERNAL TABLE</a>SQL命令来创建可读的外部表，该表引用每条记录单行JSON数据文件并使用PXF默认服务器。</p>
<pre class="highlight sql"><code><span class="k">CREATE</span> <span class="k">EXTERNAL</span> <span class="k">TABLE</span> <span class="n">singleline_json_tbl</span><span class="p">(</span>
  <span class="n">created_at</span> <span class="n">TEXT</span><span class="p">,</span>
  <span class="n">id_str</span> <span class="n">TEXT</span><span class="p">,</span>
  <span class="nv">"user.id"</span> <span class="n">INTEGER</span><span class="p">,</span>
  <span class="nv">"user.location"</span> <span class="n">TEXT</span><span class="p">,</span>
  <span class="nv">"coordinates.values[0]"</span> <span class="n">INTEGER</span><span class="p">,</span>
  <span class="nv">"coordinates.values[1]"</span> <span class="n">INTEGER</span>
<span class="p">)</span>
<span class="k">LOCATION</span><span class="p">(</span><span class="s1">'pxf://data/pxf_examples/singleline.json?PROFILE=hdfs:json'</span><span class="p">)</span>
<span class="n">FORMAT</span> <span class="s1">'CUSTOM'</span> <span class="p">(</span><span class="n">FORMATTER</span><span class="o">=</span><span class="s1">'pxfwritable_import'</span><span class="p">);</span>
</code></pre>

<p>注意使用<code>.</code>投影访问<code>user</code>和<code>coordinates</code>对象中的嵌套字段。还要注意使用<code>[]</code>来访问<code>coordinates.values[]</code>数组中的特定元素。</p>

<p>查询外部表中的JSON数据:</p>
<pre class="highlight sql"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">singleline_json_tbl</span><span class="p">;</span>
</code></pre>

<h2 id="示例：读取多行记录的json文件"><a id="jsonexample2" class="no-quick-link"></a>示例：读取多行记录的JSON文件</h2>

<p>从多行JSON记录文件中创建可读外部表的SQL命令和上面单行JSON记录的非常类似。当您要读取多行JSON记录时，您必须额外指定<code>LOCATION</code>子句的<code>IDENTIFIER</code>关键字和值。例如：</p>
<pre class="highlight sql"><code><span class="k">CREATE</span> <span class="k">EXTERNAL</span> <span class="k">TABLE</span> <span class="n">multiline_json_tbl</span><span class="p">(</span>
  <span class="n">created_at</span> <span class="n">TEXT</span><span class="p">,</span>
  <span class="n">id_str</span> <span class="n">TEXT</span><span class="p">,</span>
  <span class="nv">"user.id"</span> <span class="n">INTEGER</span><span class="p">,</span>
  <span class="nv">"user.location"</span> <span class="n">TEXT</span><span class="p">,</span>
  <span class="nv">"coordinates.values[0]"</span> <span class="n">INTEGER</span><span class="p">,</span>
  <span class="nv">"coordinates.values[1]"</span> <span class="n">INTEGER</span>
<span class="p">)</span>
<span class="k">LOCATION</span><span class="p">(</span><span class="s1">'pxf://data/pxf_examples/multiline.json?PROFILE=hdfs:json&amp;IDENTIFIER=created_at'</span><span class="p">)</span>
<span class="n">FORMAT</span> <span class="s1">'CUSTOM'</span> <span class="p">(</span><span class="n">FORMATTER</span><span class="o">=</span><span class="s1">'pxfwritable_import'</span><span class="p">);</span>
</code></pre>

<p><code>created_at</code>标识示例数据模式中JSON记录<code>record_obj</code>中第一个字段的成员名称。</p>

<p>查询外部表中的JSON数据：</p>
<pre class="highlight sql"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">multiline_json_tbl</span><span class="p">;</span>
</code></pre>

        

      </main>
    </div>
  </div>
</div>

<div id="scrim"></div>

<div class="container">
  <footer class="site-footer-links">
    
  </footer>
</div><!--end of container-->

</body>
</html>
