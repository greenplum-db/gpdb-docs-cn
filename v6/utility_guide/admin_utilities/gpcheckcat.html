<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  
  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300italic,400italic,400,600' rel='stylesheet' type='text/css'>
  <!-- Use title if it's in the page YAML frontmatter -->
  <title>
      gpcheckcat |
    Greenplum Database Docs
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/stylesheets/all.css" rel="stylesheet" media="screen, print" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href='/images/favicon.ico' rel='shortcut icon'>

  <script src="/javascripts/all.js"></script>
  
</head>

<body class="x6-0 x6-0_utility_guide x6-0_utility_guide_admin_utilities x6-0_utility_guide_admin_utilities_gpcheckcat has-subnav">

<div class="viewport">
  <div class='wrap'>
    <script type="text/javascript">
      document.domain = "greenplum.org";
    </script>

     
  <header class="header header-layout">
    <h1 class="logo">
      <a href="/">Greenplum Database Documentation</a>
    </h1>
    
    <div class="header-links js-bar-links">
      <div class="btn-menu" data-behavior="MenuMobile"></div>
      <div class="header-item"><a href="https://greenplum.org">Back to Greenplum Database</a></div>
      <div class="header-item">
        <a href="https://github.com/greenplum-db/gpdb/wiki">Wiki</a>
      </div>
      
    </div>
  </header>


    <div class="container">

      <!--googleoff: index-->
      <div id="sub-nav" class="nav-container js-sidenav" role="navigation" >
  <a class="sidenav-title" data-behavior="SubMenuMobile">
    Doc Index
  </a>
  <div class="nav-content">
    
  <ul>
    
      <li class="">
        <a href="/v6/utility_guide/../../v6/homenav.html">Greenplum数据库® 6.0文档</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/utility_guide/utility_guide.html">工具指南</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/v6/utility_guide/admin_utilities/util_ref.html">管理工具参考</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/analyzedb.html">analyzedb</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpactivatestandby.html">gpactivatestandby</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpaddmirrors.html">gpaddmirrors</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpbackup.html">gpbackup</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpcheck.html">gpcheck</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpcheckcat.html">gpcheckcat</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpcheckperf.html">gpcheckperf</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpconfig.html">gpconfig</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpdeletesystem.html">gpdeletesystem</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpexpand.html">gpexpand</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpfdist.html">gpfdist</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpinitstandby.html">gpinitstandby</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpinitsystem.html">gpinitsystem</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpload.html">gpload</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gplogfilter.html">gplogfilter</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpmapreduce.html">gpmapreduce</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpmovemirrors.html">gpmovemirrors</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpperfmon_install.html">gpperfmon_install</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gppkg.html">gppkg</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gprecoverseg.html">gprecoverseg</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpreload.html">gpreload</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gprestore.html">gprestore</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpscp.html">gpscp</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpseginstall.html">gpseginstall</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpssh.html">gpssh</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpssh-exkeys.html">gpssh-exkeys</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpstart.html">gpstart</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpstate.html">gpstate</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpstop.html">gpstop</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/gpsys.html">gpsys1</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/pgbouncer.html">pgbouncer</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/pgbouncer-ini.html">pgbouncer.ini</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/admin_utilities/pgbouncer-admin.html">pgbouncer-admin</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/../pxf/ref/pxf.html">pxf</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/../pxf/ref/pxf-cluster.html">pxf cluster</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/utility_guide/cli_ref.html">客户端工具参考</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/v6/utility_guide/client_utilities/ClientUtilitySummary.html">客户端工具摘要</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/utility_guide/client_utilities/clusterdb.html">clusterdb</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/client_utilities/createdb.html">createdb</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/client_utilities/createlang.html">createlang</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/client_utilities/createuser.html">createuser</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/client_utilities/dropdb.html">dropdb</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/client_utilities/droplang.html">droplang</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/client_utilities/dropuser.html">dropuser</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/client_utilities/pg_config.html">pg_config</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/client_utilities/pg_dump.html">pg_dump</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/client_utilities/pg_dumpall.html">pg_dumpall</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/client_utilities/pg_restore.html">pg_restore</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/client_utilities/psql.html">psql</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/client_utilities/reindexdb.html">reindexdb</a>
        

      </li>
    
      <li class="">
        <a href="/v6/utility_guide/client_utilities/vacuumdb.html">vacuumdb</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/utility_guide/contrib-programs.html">附加程序</a>
        
  <ul>
    
      <li class="">
        <a href="https://www.postgresql.org/docs/9.4/pgupgrade.html">pg_upgrade</a>
        

      </li>
    
      <li class="">
        <a href="https://www.postgresql.org/docs/9.4/pgxlogdump.html">pg_xlogdump</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
  </ul>


  </div>
</div>

      <!--googleon: index-->

      <main class="content content-layout" id="js-content" role="main">
        <a id="top"></a>
        
          <h1 class="title-container" style="display: none;">
    gpcheckcat
  </h1>

          <div id="js-quick-links" >
            
          </div>
        <div class="to-top" id="js-to-top">
          <a href="#top" title="back to top"></a>
        </div>
        

  <h1 class="title topictitle1">gpcheckcat</h1>

  <div class="body">
    <p class="p"><samp class="ph codeph">gpcheckcat</samp>gpcheckcat工具测试Greenplum数据库目录表的不一致性。</p>

    <p class="p">该工具在<samp class="ph codeph">$GPHOME/bin/lib</samp>中。</p>

    <div class="section" id="topic1__section2">
<h2 class="title sectiontitle">概要</h2>
      
      <pre class="pre codeblock"><strong class="ph b">gpcheckcat</strong> [ <var class="keyword varname">options</var>] [ <var class="keyword varname">dbname</var>] 
        
        <strong class="ph b">Options:</strong>
        <strong class="ph b">-g</strong> <var class="keyword varname">dir</var>
        <strong class="ph b">-p</strong> <var class="keyword varname">port</var>
        <strong class="ph b">-P</strong> <var class="keyword varname">password</var>
        <strong class="ph b">-U</strong> <var class="keyword varname">user_name</var>
        <strong class="ph b">-S</strong> {none | only}
        <strong class="ph b">-O</strong>
        <strong class="ph b">-R</strong> <var class="keyword varname">test_name</var> 
        <strong class="ph b">-C</strong> <var class="keyword varname">catalog_name</var>
        <strong class="ph b">-B</strong> <var class="keyword varname">parallel_processes</var>
        <strong class="ph b">-v</strong>
        <strong class="ph b">-A</strong>
        
        <strong class="ph b">gpcheckcat</strong>  <strong class="ph b">-l</strong> 
        
        <strong class="ph b">gpcheckcat</strong> <strong class="ph b">-?</strong> 
      </pre>

    </div>

    <div class="section" id="topic1__section3">
<h2 class="title sectiontitle">描述</h2>
      
      <p class="p"><samp class="ph codeph">gpcheckcat</samp>工具运行多种测试检查数据库目录的不一致。 某些测试不能与其他负载语句同时运行，
        否则结果将不可用。运行<samp class="ph codeph">gpcheckcat</samp>时，要以受限模式重新启动数据库，否则，<samp class="ph codeph">gpcheckcat</samp>
        可能会由于正在进行的数据库操作而报告不一致，这会与实际的不一致数量不同。如果用户在不停止数据库活动的情况下运行
        <samp class="ph codeph">gpcheckcat</samp>，请使用<samp class="ph codeph">-O</samp>选项运行它。</p>

      <div class="note note">
<span class="notetitle">Note:</span> 每当用户运行该工具时，它都会检查并删除指定数据库中的孤立的临时数据库方案（没有会话ID的临时方案）。
        该工具在命令行上显示孤立临时模式检查的结果，并在日志中记录该结果。
      </div>

      <div class="p">目录不一致是Greenplum数据库系统表之间发生的不一致。一般来说，有三种不一致：<ul class="ul" id="topic1__ul_jry_gmh_mp">
        <li class="li">Segment级的系统表不一致。例如，包含表数据的系统表与包含列数据的系统表之间的不一致。另一个例子是一个
          系统表在本该唯一的列中包含重复。
        </li>

      </ul>
<ul class="ul" id="topic1__ul_smw_hmh_mp">
        <li class="li">Segment之间相同系统表之间的不一致。例如，一个系统表在一个Segment上缺少一行，但其他Segment具有这一行。
          作为另一个例子，特定的行列数据的值在不同的Segment之间不同，例如表所有者或表访问特权。
        </li>

        <li class="li">持久化系统表对象状态和文件系统对象间的不一致。例如，一个文件在数据库目录中存在，但数据库系统表中
          不存在相应的对象。
        </li>

      </ul>
</div>

    </div>

    <div class="section" id="topic1__section4">
<h2 class="title sectiontitle">选项</h2>
      
      <dl class="dl parml">
        
          <dt class="dt pt dlterm">-A</dt>

          <dd class="dd pd">在Greenplum数据库安装的所有数据库上运行<samp class="ph codeph">gpcheckcat</samp>。
          </dd>

        
        
          <dt class="dt pt dlterm">-B <var class="keyword varname">parallel_processes</var>
</dt>

          <dd class="dd pd">并行运行的进程数量。</dd>

          <dd class="dd pd">
            <div class="p">
<samp class="ph codeph">gpcheckcat</samp>工具尝试确定要同时使用的进程数（批尺寸）。该工具假定它可以为
              每个进程使用最小为20MB的缓冲区。并行进程的最大数量是Greenplum数据库Segment实例的数量。
              当该工具开始检查目录时，它会显示所使用的并行进程的数量。
              <div class="note note">
<span class="notetitle">Note:</span> 如果返回的错误数量超过缓冲区大小，则该工具可能会耗尽内存。如果发生内存不足错误，可以使用
                <samp class="ph codeph">-B</samp>选项降低批尺寸。例如，如果该工具显示批尺寸为936并且内存不足，则可以指定
                <samp class="ph codeph">-B 468</samp>并行运行468个进程。
              </div>
</div>

          </dd>

        
        
          <dt class="dt pt dlterm">-C <var class="keyword varname">catalog_table</var>
</dt>

          <dd class="dd pd">对指定的目录表运行交叉一致性、外键和ACL测试。</dd>

        
        
          <dt class="dt pt dlterm">-g <var class="keyword varname">data_directory</var>
</dt>

          <dd class="dd pd">生成SQL脚本来修复目录不一致。脚本被放置在<var class="keyword varname">data_directory</var>中。
          </dd>

        
        
          <dt class="dt pt dlterm">-l</dt>

          <dd class="dd pd">列出<samp class="ph codeph">gpcheckcat</samp>测试。</dd>

        
        
          <dt class="dt pt dlterm">-O</dt>

          <dd class="dd pd">只运行可以在线（不受限）模式运行的<samp class="ph codeph">gpcheckcat</samp>测试。
          </dd>

        
        
          <dt class="dt pt dlterm">-p <var class="keyword varname">port</var>
</dt>

          <dd class="dd pd">这一选项指定Greenplum数据库使用的端口。</dd>

        
        
          <dt class="dt pt dlterm">-P <var class="keyword varname">password</var>
</dt>

          <dd class="dd pd">连接到Greenplum数据库的用户的密码。</dd>

        
        
          <dt class="dt pt dlterm">-R <var class="keyword varname">test_name</var>
          </dt>

          <dd class="dd pd">指定要运行的测试。某些测试只有当Greenplum数据库处于受限模式时才能运行。
          </dd>

          <dd class="dd pd">这些是可以执行的测试：<p class="p"><samp class="ph codeph">acl</samp> - 对访问控制特权的交叉一致性检查</p>

            <p class="p"><samp class="ph codeph">duplicate</samp> - 检查重复项</p>

            <p class="p"><samp class="ph codeph">foreign_key</samp> - 检查外键</p>

            <p class="p"><samp class="ph codeph">inconsistent</samp> - 对Master和Segment不一致性的交叉一致性检查</p>

            <p class="p"><samp class="ph codeph">missing_extraneous</samp> - 对缺少的或无关的项的交叉一致性检查</p>

            <p class="p"><samp class="ph codeph">owner</samp> - 检查表的拥有关系是否与Master数据库不一致</p>

            <div class="p">
<samp class="ph codeph">orphaned_toast_tables</samp> -检查孤立的TOAST表 
              <div class="note note">
<span class="notetitle">Note:</span> 有很多种情况都会导致TOAST表变成孤立表，此时不会生成修复脚本，要求进行手工元数据维护。
                其中一种情况是<em class="ph i">pg_class</em>中的<samp class="ph codeph">reltoastrelid</samp>指向一个不正确的TOAST
                表（不能匹配到TOAST表）。另外一种情况可能是<em class="ph i">pg_class</em>表的<samp class="ph codeph">reltoastrelid</samp>
                和<samp class="ph codeph">pg_depend</samp>丢失（双孤立TOAST表）。如果需要手工修复元数据，
                <samp class="ph codeph">gpcheckcat</samp>会显示详细的元数据更新步骤。
                </div>
</div>

            <p class="p"><samp class="ph codeph">part_integrity</samp> - 检查<em class="ph i">pg_partition</em>分支的完整性、带OID的分区、
              分区分布策略</p>

            <p class="p"><samp class="ph codeph">part_constraint</samp> - 检查分区表上的约束</p>

            <p class="p"><samp class="ph codeph">unique_index_violation</samp> - 检查有唯一索引约束的列的表中是否有重复项</p>

            <p class="p"><samp class="ph codeph">dependency</samp> - 检查不存在对象的依赖关系（仅限于受限模式）</p>

            <p class="p"><samp class="ph codeph">distribution_policy</samp> - 检查随机分布表上的约束（仅限于受限模式）</p>

            <p class="p"><samp class="ph codeph">namespace</samp> - 检查缺少方案定义的方案（仅限于受限模式）</p>

            <p class="p"><samp class="ph codeph">pgclass</samp> - 检查没有任何对应的<em class="ph i">pg_attribute</em>项的（仅限于受限模式）
              <em class="ph i">pg_class</em>项。</p>

          </dd>

        
        
          <dt class="dt pt dlterm">-S {none | only}</dt>

          <dd class="dd pd">指定这一选项以控制对Greenplum数据库安装中所有数据库（如<em class="ph i">pg_database</em>）上共享的目录表的测试。
          </dd>

          <dd class="dd pd">值<samp class="ph codeph">none</samp>禁用对共享目录表的测试。值<samp class="ph codeph">only</samp>仅测试共享目录表。</dd>

        
        
          <dt class="dt pt dlterm">-U <var class="keyword varname">user_name</var>
</dt>

          <dd class="dd pd">连接到Greenplum数据库的用户。</dd>

        
        
          <dt class="dt pt dlterm">-?（帮助）</dt>

          <dd class="dd pd">显示在线帮助。</dd>

        
        
          <dt class="dt pt dlterm">-v（详细模式）</dt>

          <dd class="dd pd">显示所执行测试的详细信息。</dd>

        
      </dl>

    </div>

    <div class="section">
<h2 class="title sectiontitle">注解</h2>
      该工具可识别缺少属性的表，并将其以非标准格式显示在输出中的各个位置。在显示输出信息之后，该工具还会以格式
      <samp class="ph codeph"><var class="keyword varname">database</var>.<var class="keyword varname">schema</var>.<var class="keyword varname">table</var>.<var class="keyword varname">segment_id</var></samp>
      显示缺少属性的表的摘要列表。
      <p class="p">如果<samp class="ph codeph">gpcheckcat</samp>检测到不一致的OID（对象ID）信息，它将生成一个或者多个包含SQL查询的验证文件。
        用户可以运行SQL查询来查看有关OID不一致的详细信息，并调查不一致之处。这些文件在<samp class="ph codeph">gpcheckcat</samp>
        被调用的目录中生成。
      </p>

      <p class="p">这是该文件的格式：
      </p>
<pre class="pre">gpcheckcat.verify.<var class="keyword varname">dbname</var>.<var class="keyword varname">catalog_table_name</var>.<var class="keyword varname">test_name</var>.<var class="keyword varname">TIMESTAMP</var>.sql</pre>

      <div class="p">这是当<samp class="ph codeph">gpcheckcat</samp>检测到数据库<samp class="ph codeph">mydb</samp>中的目录表<em class="ph i">pg_type</em>中的不一致OID
        （对象ID）信息时，它创建的验证文件名示例：
        <pre class="pre codeblock">gpcheckcat.verify.mydb.pg_type.missing_extraneous.20150420102715.sql</pre>

      </div>

      <p class="p">这是验证文件中查询的一个示例：
      </p>
<pre class="pre">SELECT *
  FROM (
       SELECT relname, oid FROM pg_class WHERE reltype 
         IN (1305822,1301043,1301069,1301095)
       UNION ALL
       SELECT relname, oid FROM gp_dist_random('pg_class') WHERE reltype 
         IN (1305822,1301043,1301069,1301095)
       ) alltyprelids
  GROUP BY relname, oid ORDER BY count(*) desc ;</pre>
</div>

  </div>



        

      </main>
    </div>
  </div>
</div>

<div id="scrim"></div>

<div class="container">
  <footer class="site-footer-links">
    
  </footer>
</div><!--end of container-->

</body>
</html>
