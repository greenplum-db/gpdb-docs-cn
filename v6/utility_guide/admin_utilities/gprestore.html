<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  
  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300italic,400italic,400,600' rel='stylesheet' type='text/css'>
  <!-- Use title if it's in the page YAML frontmatter -->
  <title>
      gprestore |
    Greenplum Database Docs
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/gpdb-docs-cn/stylesheets/all.css" rel="stylesheet" media="screen, print" />
  <link href="/gpdb-docs-cn/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href='/gpdb-docs-cn/images/favicon.ico' rel='shortcut icon'>

  <script src="/gpdb-docs-cn/javascripts/all.js"></script>
  
</head>

<body class="x6-0 x6-0_utility_guide x6-0_utility_guide_admin_utilities x6-0_utility_guide_admin_utilities_gprestore has-subnav">

<div class="viewport">
  <div class='wrap'>
    <script type="text/javascript">
      document.domain = "greenplum.org";
    </script>

     
  <header class="header header-layout">
    <h1 class="logo">
      <a href="/">Greenplum Database Documentation</a>
    </h1>
    
    <div class="header-links js-bar-links">
      <div class="btn-menu" data-behavior="MenuMobile"></div>
      <div class="header-item"><a href="https://greenplum.org">Back to Greenplum Database</a></div>
      <div class="header-item">
        <a href="https://github.com/greenplum-db/gpdb/wiki">Wiki</a>
      </div>
      
    </div>
  </header>


    <div class="container">

      <!--googleoff: index-->
      <div id="sub-nav" class="nav-container js-sidenav" role="navigation" >
  <a class="sidenav-title" data-behavior="SubMenuMobile">
    Doc Index
  </a>
  <div class="nav-content">
    
  <ul>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/../../gpdb-docs-cn/v6/homenav.html">Greenplum数据库® 6.0文档</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/gpdb-docs-cn/v6/utility_guide/utility_guide.html">工具指南</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/util_ref.html">管理工具参考</a>
        
  <ul>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/analyzedb.html">analyzedb</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpactivatestandby.html">gpactivatestandby</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpaddmirrors.html">gpaddmirrors</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpbackup.html">gpbackup</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpcheck.html">gpcheck</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpcheckcat.html">gpcheckcat</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpcheckperf.html">gpcheckperf</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpconfig.html">gpconfig</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpdeletesystem.html">gpdeletesystem</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpexpand.html">gpexpand</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpfdist.html">gpfdist</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpinitstandby.html">gpinitstandby</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpinitsystem.html">gpinitsystem</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpload.html">gpload</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gplogfilter.html">gplogfilter</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpmapreduce.html">gpmapreduce</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpmovemirrors.html">gpmovemirrors</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpperfmon_install.html">gpperfmon_install</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gppkg.html">gppkg</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gprecoverseg.html">gprecoverseg</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpreload.html">gpreload</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gprestore.html">gprestore</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpscp.html">gpscp</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpseginstall.html">gpseginstall</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpssh.html">gpssh</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpssh-exkeys.html">gpssh-exkeys</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpstart.html">gpstart</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpstate.html">gpstate</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpstop.html">gpstop</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/gpsys.html">gpsys1</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/pgbouncer.html">pgbouncer</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/pgbouncer-ini.html">pgbouncer.ini</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/admin_utilities/pgbouncer-admin.html">pgbouncer-admin</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/../pxf/ref/pxf.html">pxf</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/../pxf/ref/pxf-cluster.html">pxf cluster</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/gpdb-docs-cn/v6/utility_guide/cli_ref.html">客户端工具参考</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/gpdb-docs-cn/v6/utility_guide/client_utilities/ClientUtilitySummary.html">客户端工具摘要</a>
        
  <ul>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/client_utilities/clusterdb.html">clusterdb</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/client_utilities/createdb.html">createdb</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/client_utilities/createlang.html">createlang</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/client_utilities/createuser.html">createuser</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/client_utilities/dropdb.html">dropdb</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/client_utilities/droplang.html">droplang</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/client_utilities/dropuser.html">dropuser</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/client_utilities/pg_config.html">pg_config</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/client_utilities/pg_dump.html">pg_dump</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/client_utilities/pg_dumpall.html">pg_dumpall</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/client_utilities/pg_restore.html">pg_restore</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/client_utilities/psql.html">psql</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/client_utilities/reindexdb.html">reindexdb</a>
        

      </li>
    
      <li class="">
        <a href="/gpdb-docs-cn/v6/utility_guide/client_utilities/vacuumdb.html">vacuumdb</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/gpdb-docs-cn/v6/utility_guide/contrib-programs.html">附加程序</a>
        
  <ul>
    
      <li class="">
        <a href="https://www.postgresql.org/docs/9.4/pgupgrade.html">pg_upgrade</a>
        

      </li>
    
      <li class="">
        <a href="https://www.postgresql.org/docs/9.4/pgxlogdump.html">pg_xlogdump</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
  </ul>


  </div>
</div>

      <!--googleon: index-->

      <main class="content content-layout" id="js-content" role="main">
        <a id="top"></a>
        
          <h1 class="title-container" style="display: none;">
    gprestore
  </h1>

          <div id="js-quick-links" >
            
          </div>
        <div class="to-top" id="js-to-top">
          <a href="#top" title="back to top"></a>
        </div>
        

  <h1 class="title topictitle1">gprestore</h1>

  <div class="body">
    <p class="p">恢复由<samp class="ph codeph">gpbackup</samp>创建的Greenplum数据库备份。默认<samp class="ph codeph">gprestore</samp>
      使用位于Greenplum Master主机数据目录下的元数据文件和DDL文件，使用存储于Segment主机上的表数据CSV
      文件。</p>

    <div class="section">
<h2 class="title sectiontitle">概要</h2>
      
      <pre class="pre codeblock"><strong class="ph b">gprestore --timestamp</strong> <var class="keyword varname">YYYYMMDDHHMMSS</var>
   [<strong class="ph b">--backup-dir</strong> <var class="keyword varname">directory</var>]
   [<strong class="ph b">--create-db</strong>]
   [<strong class="ph b">--debug</strong>]
   [<strong class="ph b">--exclude-schema</strong> <var class="keyword varname">schema_name</var>]
   [<strong class="ph b">--exclude-table</strong> <var class="keyword varname">schema.table</var>]
   [<strong class="ph b">--exclude-table-file</strong> <var class="keyword varname">file_name</var>]
   [<strong class="ph b">--include-schema</strong> <var class="keyword varname">schema_name</var>]
   [<strong class="ph b">--include-table</strong> <var class="keyword varname">schema.table</var>]
   [<strong class="ph b">--include-table-file</strong> <var class="keyword varname">file_name</var>]
   [<strong class="ph b">--data-only</strong> | <strong class="ph b">--metadata-only</strong>]
   [<strong class="ph b">--jobs</strong> <var class="keyword varname">int</var>]
   [<strong class="ph b">--on-error-continue</strong>]
   [<strong class="ph b">--plugin-config</strong> <var class="keyword varname">config_file_location</var>]
   [<strong class="ph b">--quiet</strong>]
   [<strong class="ph b">--redirect-db</strong> <var class="keyword varname">database_name</var>]
   [<strong class="ph b">--verbose</strong>]
   [<strong class="ph b">--version</strong>]
   [<strong class="ph b">--with-globals</strong>]
   [<strong class="ph b">--with-stats</strong>]

<strong class="ph b">gprestore --help</strong></pre>

    </div>

    <div class="section">
<h2 class="title sectiontitle">描述</h2>
      
      <p class="p">使用<samp class="ph codeph">gprestore</samp>从备份集恢复时，必须包含<samp class="ph codeph">--timestamp</samp>选项来指定
        确切一个来自备份集的恢复时间值（<samp class="ph codeph">YYYYMMDDHHMMSS</samp>）。如果在备份时指定了<samp class="ph codeph">--backup-dir</samp>，
        那么<samp class="ph codeph">gprestore</samp>同样要指定<samp class="ph codeph">--backup-dir</samp>来获取备份文件。</p>

      <div class="p">如果指定的是增量备份，那么还需要一个完全备份的文件集合（一个全备和所有需要的增量备份）。
        <samp class="ph codeph">gprestore</samp>会在开始恢复之前验证备份集合是可用的。
        <div class="note important">
<span class="importanttitle">Important:</span> 对于增量备份集，备份必须在单独设备上。例如，备份集的所有文件必须全部在
          Data Domain系统。</div>
</div>

      <p class="p">有关增量备份的详细信息，请见<a class="xref" href="../../admin_guide/managing/backup-gpbackup-incremental.html">使用gpbackup和gprestore创建增量备份</a>。</p>

      <p class="p">当从备份集恢复时，<samp class="ph codeph">gprestore</samp>会将数据恢复到创建备份时指定的数据库。
        如果目标数据库存在，并且数据库中存在该表，恢复操作会失败。如果目标数据库不存在，可以通过指定
        <samp class="ph codeph">--create-db</samp>选项来创建数据库。也可以通过指定<samp class="ph codeph">--redirect-db</samp>
        选项来将数据恢复到不同的数据库。</p>

      <p class="p">当恢复分区表的子分区时，分区表和数据会一同被恢复。例如，使用<samp class="ph codeph">gpbackup</samp>的
        <samp class="ph codeph">--include-table-file</samp>选项创建了一个备份。恢复数据时会恢复创建分区表并
        只将数据恢复到列表文件中指定的分区。</p>

      <p class="p">Greenplum数据库系统对象会自动包含在<samp class="ph codeph">gpbackup</samp>备份集中，但是只有在用
        <samp class="ph codeph">gprestore</samp>进行恢复时指定<samp class="ph codeph">--with-globals</samp>选项才会
        进行恢复。相似的情况还有，如果备份时使用<samp class="ph codeph">--with-stats</samp>选项备份了查询计划
        统计信息，那么在使用<samp class="ph codeph">gprestore</samp>进行恢复时必须指定<samp class="ph codeph">--with-stats</samp>
        才能对这部分数据进行恢复。默认情况下，只有备份集中的数据库对象会被恢复。</p>

      <p class="p">恢复操作的性能可以通过提高创建多个并行连接的方式来同时恢复多个表和元数据。默认<samp class="ph codeph">gprestore</samp>
        使用1个连接，但是我们可以通过<samp class="ph codeph">--jobs</samp>选项来为大的恢复过程增加处理进程数。
      </p>

      <p class="p">当一个操作完成后，<samp class="ph codeph">gprestore</samp>会返回一个状态码。详见
          <a class="xref" href="#topic1__return_codes">Return Codes</a>。</p>

      <p class="p"><samp class="ph codeph">gprestore</samp>在恢复操作完成后可以发送邮件通知。可以指定发送邮件和接收邮件的
        配置文件。详见<a class="xref" href="../../admin_guide/managing/backup-gpbackup.html#topic_qwd_d5d_tbb">配置邮件通知</a>。</p>

    </div>

    <div class="note note">
<span class="notetitle">Note:</span> 该工具在系统内部采用SSH连接执行各项操作任务。在大型Greenplum集群、云部署或每台主机部署了大量的
      segment实例时，可能会遇到超过主机最大授权连接数限制的情况。此时需要考虑更新SSH配置参数<samp class="ph codeph">MaxStartups</samp>
      以提高该限制。更多关于SSH配置的选项，请参考您的Linux分发版的SSH文档。</div>

    <div class="section">
<h2 class="title sectiontitle">选项</h2>
      
      <dl class="dl parml">
        
          <dt class="dt pt dlterm">
<strong class="ph b">--timestamp</strong>
            <var class="keyword varname">YYYYMMDDHHMMSS</var>
</dt>

          <dd class="dd pd">必须。指定一个用来恢复<samp class="ph codeph">gpbackup</samp>备份集的时间戳。默认<samp class="ph codeph">gprestore</samp>
            会尝试从Master主机的<span class="ph filepath">$MASTER_DATA_DIRECTORY/backups/YYYYMMDD/YYYYMMDDhhmmss/</span>
            路径下定位时间戳对应的元数据文件，从每个Segment主机的<span class="ph filepath">&lt;seg_dir&gt;/backups/YYYYMMDD/YYYYMMDDhhmmss/</span>
            路径下定位CSV数据文件。</dd>

        
        
          <dt class="dt pt dlterm">
<strong class="ph b">--backup-dir</strong>
            <var class="keyword varname">directory</var>
</dt>

          <dd class="dd pd">可选。从指定的路径下找所有备份文件（元数据文件和数据文件）。必须指定<var class="keyword varname">directory</var>
            为一个绝对路径（不能是相对路径）。如果没有指定该选项，<samp class="ph codeph">gprestore</samp>会尝试从Master主机的
            <span class="ph filepath">$MASTER_DATA_DIRECTORY/backups/YYYYMMDD/YYYYMMDDhhmmss/</span>
            路径下定位时间戳对应的元数据文件，从每个Segment主机的<span class="ph filepath">&lt;seg_dir&gt;/backups/YYYYMMDD/YYYYMMDDhhmmss/</span>
            路径下定位CSV数据文件。如果<samp class="ph codeph">gpbackup</samp>操作指定了该选项，那么恢复时请同时指定该选项。
          </dd>

          <dd class="dd pd">该选项不能和<samp class="ph codeph">--plugin-config</samp>选项一起使用。</dd>

        
        
          <dt class="dt pt dlterm"><strong class="ph b">--create-db</strong></dt>

          <dd class="dd pd">可选。在恢复数据库对象元数据之前先创建数据库。</dd>

          <dd class="dd pd">通过复制空的系统标准数据库<samp class="ph codeph">template0</samp>来创建指定的数据库。</dd>

        
        
          <dt class="dt pt dlterm">
<a name="topic1__data_only"><!-- --></a><strong class="ph b">--data-only</strong>
</dt>

          <dd class="dd pd">可选。仅恢复<samp class="ph codeph">gpbackup</samp>创建的表数据，不恢复创建数据库表的操作。该选项假定
            数据库中已经存在对应的表。如果要恢复指定的集合，可以通过指定选项来包含表/模式或排除表/模式。
            指定<samp class="ph codeph">--with-stats</samp>选项来从备份集恢复表的统计信息。</dd>

          <dd class="dd pd">备份集必须包含要被恢复的表数据。例如，<samp class="ph codeph">gpbackup</samp>采用选项
            <samp class="ph codeph">--metadata-only</samp>备份的备份集不包含表数据，不能用来恢复数据。
          </dd>

          <dd class="dd pd">如果要仅恢复数据库表，不恢复表里的数据，参见选项
                <samp class="ph codeph"><a class="xref" href="#topic1__metadata_only">--metadata-only</a></samp>。</dd>

        
        
          <dt class="dt pt dlterm"><strong class="ph b">--debug</strong></dt>

          <dd class="dd pd">可选。显示操作期间的详细信息和调试日志。</dd>

        
        
          <dt class="dt pt dlterm">
<strong class="ph b">--exclude-schema</strong>
            <var class="keyword varname">schema_name</var>
</dt>

          <dd class="dd pd">可选。指定恢复操作期间要排除的数据库模式。可以多次指定以排除多个模式。该选项不能和
            <samp class="ph codeph">--include-schema</samp>或表过滤选项（例如：<samp class="ph codeph">--include-table</samp>）
            一起使用。</dd>

        
        
          <dt class="dt pt dlterm">
<strong class="ph b">--exclude-table</strong>
            <var class="keyword varname">schema.table</var>
</dt>

          <dd class="dd pd">可选。指定恢复操作期间要排除的表。指定的格式必须为<samp class="ph codeph">&lt;schema-name&gt;.&lt;table-name&gt;</samp>。
           如果表名或模式名使用了非小写字母、数字或下划线，那改名字可以用双引号包裹。客户可以多次指定该选项。
           如果表不在备份集中，恢复操作会失败。不能指定分区表的子分区。</dd>

          <dd class="dd pd">该选项不能与<samp class="ph codeph">--exclude-schema</samp>或表过滤选项（例如：<samp class="ph codeph">--include-table</samp>）
            一起使用。</dd>

        
        
          <dt class="dt pt dlterm">
<strong class="ph b">--exclude-table-file</strong>
            <var class="keyword varname">file_name</var>
</dt>

          <dd class="dd pd">可选。指定恢复期间要排除的表的列表文件。文件为text格式，并且每行都必须定义一个单独的表，格式为
            <samp class="ph codeph">&lt;schema-name&gt;.&lt;table-name&gt;</samp>。文件不能包含多余的行。
            如果表名或模式名使用了非小写字母、数字或下划线，那改名字可以用双引号包裹。客户可以多次指定该选项。
            如果表不在备份集中，恢复操作会失败。不能指定分区表的子分区。</dd>

          <dd class="dd pd">该选项不能与<samp class="ph codeph">--exclude-schema</samp>或表过滤选项（例如：<samp class="ph codeph">--include-table</samp>）
            一起使用。</dd>

        
        
          <dt class="dt pt dlterm">
<strong class="ph b">--include-schema</strong>
            <var class="keyword varname">schema_name</var>
</dt>

          <dd class="dd pd">可选。指定要恢复的数据库模式。可以多次指定该选项以包含多个模式。如果指定了该选项，那定义的任何
            模式都必须在备份集中。没在<samp class="ph codeph">--include-schema</samp>选项中指定的所有模式都会被忽略。
          </dd>

          <dd class="dd pd">如果指定的模式在目标数据库中存在，该工具会产生一个错误然后继续操作。如果被恢复的表在数据库中存在，
            该工具会失败。
          </dd>

          <dd class="dd pd">如果备份集在多个模式下存在依赖关系，那不能使用该选项。</dd>

          <dd class="dd pd">更多信息请见<a class="xref" href="../../admin_guide/managing/backup-gpbackup.html#topic_et4_b5d_tbb">过滤备份和恢复的内容</a>。</dd>

        
        
          <dt class="dt pt dlterm">
<strong class="ph b">--include-table</strong>
            <var class="keyword varname">schema.table</var>
</dt>

          <dd class="dd pd">可选。指定一个要恢复的表。格式必须为<samp class="ph codeph">&lt;schema-name&gt;.&lt;table-name&gt;</samp>。
            如果任何表名或模式名使用非小写字母、数字或下划线，那么可以用双引号包裹名字。该选项可以多次指定。
            不能指定分区表的子分区。</dd>

          <dd class="dd pd">也可以指定一个有效的模式或视图。</dd>

          <dd class="dd pd">如果指定了该选项，工具不会自动恢复依赖对象。必须指定需要的依赖对象。例如，如果恢复一个视图，
            那么必须也恢复它对应的表。如果恢复的表使用到了一个序列，那么也必须恢复该序列。这些对应的对象
            也必须都在备份集中存在。</dd>

          <dd class="dd pd">不能将该选项与<samp class="ph codeph">--include-schema</samp>或表过滤选项
            （例如<samp class="ph codeph">--exclude-table-file</samp>）一起使用。
              </dd>

        
        
          <dt class="dt pt dlterm">
<strong class="ph b">--include-table-file</strong>
            <var class="keyword varname">file_name</var>
</dt>

          <dd class="dd pd">可选。指定一个包含恢复表名的列表文件。每行代表一张单独的表，格式必须为
              <samp class="ph codeph">&lt;schema-name&gt;.&lt;table-name&gt;</samp>。该文件不能包含多余的行。
            如果表名或模式名使用了非小写字母、数字或下划线，那改名字可以用双引号包裹。客户可以多次指定该选项。
            如果表不在备份集中，恢复操作会失败。不能指定分区表的子分区。
            </dd>

          <dd class="dd pd">也可以指定一个有效的模式或视图。</dd>

          <dd class="dd pd">如果指定了该选项，工具不会自动恢复依赖对象。必须指定需要的依赖对象。例如，如果恢复一个视图，
            那么必须也恢复它对应的表。如果恢复的表使用到了一个序列，那么也必须恢复该序列。这些对应的对象
            也必须都在备份集中存在。</dd>

          <dd class="dd pd">如果使用<samp class="ph codeph">--include-table-file</samp>选项，<samp class="ph codeph">gprestore</samp>
            不会创建表的角色或用户集合。工具会恢复表的索引和规则。触发器也会被恢复，但是Greenplum
            目前不支持触发器。</dd>

          <dd class="dd pd">更多信息请见<a class="xref" href="../../admin_guide/managing/backup-gpbackup.html#topic_et4_b5d_tbb">过滤备份或恢复的内容</a>
            。</dd>

        
        
          <dt class="dt pt dlterm">
<strong class="ph b">--jobs</strong>
            <var class="keyword varname">int</var>
</dt>

          <dd class="dd pd">可选。指定恢复表数据和元数据的并行连接的数量。默认<samp class="ph codeph">gprestore</samp>使用1个连接。
            增加该参数会提高数据恢复的速度。
            <div class="note note">
<span class="notetitle">Note:</span> 如果使用<samp class="ph codeph">gpbackup --single-data-file</samp>选项合并表备份为每个Segment
              节点1个单独的文件，那么不能在恢复过程中指定<samp class="ph codeph">--jobs</samp>超过1来进行并行恢复。
            </div>
</dd>

        
        
          <dt class="dt pt dlterm">
<a name="topic1__metadata_only"><!-- --></a><strong class="ph b">--metadata-only</strong>
</dt>

          <dd class="dd pd">可选。从一个<samp class="ph codeph">gpbackup</samp>创建的备份集中创建数据库表，不恢复数据。该选项
            假设目标数据库中不存在这些表。要从备份集创建指定的表集合，可以通过指定对应的选项来选择或
            排除相应的表或模式。指定选项<samp class="ph codeph">--with-globals</samp>来恢复Greenplum数据库
            系统对象。</dd>

          <dd class="dd pd">备份集必须包含要恢复的表的DDL数据。例如，<samp class="ph codeph">gpbackup</samp>选项<samp class="ph codeph">--data-only</samp> 
            生成的备份集就不包含表的DDL信息。</dd>

          <dd class="dd pd">创建完数据库表后再恢复表数据，请见选项
                <samp class="ph codeph"><a class="xref" href="#topic1__data_only">--data-only</a></samp>。</dd>

        
        
          <dt class="dt pt dlterm"><strong class="ph b">--on-error-continue</strong></dt>

          <dd class="dd pd">可选。指定该选项以在创建数据库元数据（例如表、对象或函数）或恢复数据过程中出现SQL错误时，
            忽略错误继续执行。如果有其他类型错误出现，工具会退出。工具会显示错误信息汇总并将错误信息写入到
            <samp class="ph codeph">gprestore</samp>日志文件，并继续恢复操作。</dd>

          <dd class="dd pd">默认为第一次出现错误即退出。</dd>

        
        
          <dt class="dt pt dlterm">
<strong class="ph b">--plugin-config</strong>
            <var class="keyword varname">config-file_location</var>
</dt>

          <dd class="dd pd">指定<samp class="ph codeph">gpbackup</samp>插件配置文件位置，它是一个YAML格式的文本文件。该文件包含
            <samp class="ph codeph">gprestore</samp>在恢复操作期间使用的插件的配置信息。</dd>

          <dd class="dd pd">如果备份数据库时指定了<samp class="ph codeph">--plugin-config</samp>选项，那么在从该备份集恢复
            数据时也必须指定该配置文件。</dd>

          <dd class="dd pd">该选项不能与<samp class="ph codeph">--backup-dir</samp>同时使用。</dd>

          <dd class="dd pd">有关存储插件应用的详细信息，请见
            <a class="xref" href="../../admin_guide/managing/backup-plugins.html">使用gpbackup存储插件</a>。</dd>

        
        
          <dt class="dt pt dlterm"><strong class="ph b">--quiet</strong></dt>

          <dd class="dd pd">可选。禁止任何非告警、非错误日志输出。</dd>

        
        
          <dt class="dt pt dlterm">
<strong class="ph b">--redirect-db</strong>
            <var class="keyword varname">database_name</var>
</dt>

          <dd class="dd pd">可选。恢复到指定的<var class="keyword varname">database_name</var>，而不是备份时的默认数据库名。</dd>

        
        
          <dt class="dt pt dlterm"><strong class="ph b">--verbose</strong></dt>

          <dd class="dd pd">可选。显示恢复操作期间的详细日志信息。</dd>

        
        
          <dt class="dt pt dlterm"><strong class="ph b">--version</strong></dt>

          <dd class="dd pd">可选。打印版本号并退出。</dd>

        
        
          <dt class="dt pt dlterm"><strong class="ph b">--with-globals</strong></dt>

          <dd class="dd pd">可选。恢复备份集合中的Greenplum数据库系统对象，和其余数据库对象。详见<a class="xref" href="../../admin_guide/managing/backup-gpbackup.html#topic_x3s_lqj_tbb">备份或还原中包含的对象</a>。</dd>

        
        
          <dt class="dt pt dlterm"><strong class="ph b">--with-stats</strong></dt>

          <dd class="dd pd">可选。从备份集合恢复查询计划统计信息。</dd>

        
        
          <dt class="dt pt dlterm">--help</dt>

          <dd class="dd pd">显示在线帮助信息。</dd>

        
      </dl>

    </div>

    <div class="section" id="topic1__return_codes">
<h2 class="title sectiontitle">Return Codes</h2>
      
      <div class="p">
<samp class="ph codeph">gprestore</samp>完成后会返回如下返回码之一<ul class="ul" id="topic1__ul_hhb_sqp_n4">
        <li class="li">
<strong class="ph b">0</strong> – 成功完成恢复。</li>

        <li class="li">
<strong class="ph b">1</strong> – 恢复完成，没有严重错误。具体信息见日志文件。</li>

        <li class="li">
<strong class="ph b">2</strong> – 恢复失败，有严重错误。具体信息见日志文件。</li>

        </ul>
</div>

    </div>

    <div class="section">
<h2 class="title sectiontitle">示例</h2>
      
      <div class="p">创建demo数据库并恢复备份集合中指定时间的所有表名和模式名：<pre class="pre codeblock">$ dropdb demo
$ gprestore --timestamp 20171103152558 --create-db</pre>
</div>

      <div class="p">恢复备份集到"demo2"数据库而不是默认备份的"demo"数据库：
        <pre class="pre codeblock">$ createdb demo2
$ gprestore --timestamp 20171103152558 --redirect-db demo2</pre>
</div>

      <div class="p">恢复数据库全局对象和查询计划统计信息，而不是默认的全部数据：
        <pre class="pre codeblock">$ gprestore --timestamp 20171103152558 --create-db --with-globals --with-stats</pre>
</div>

      <div class="p">使用创建在<span class="ph filepath">/home/gpadmin/backup</span>下的文件恢复数据，创建8个并行连接：
        <pre class="pre codeblock">$ gprestore --backup-dir /home/gpadmin/backups/ --timestamp 20171103153156 --create-db --jobs 8</pre>
</div>

      <div class="p">仅恢复备份集中的"wikipedia"模式：
        <pre class="pre codeblock">$ dropdb demo
$ gprestore --include-schema wikipedia --backup-dir /home/gpadmin/backups/ --timestamp 20171103153156 --create-db</pre>
</div>

      <p class="p">如果从增量备份集中恢复，所有需要的备份文件都必须对<samp class="ph codeph">gprestore</samp>可用。例如，
        以下时间戳指定增量备份集。20170514054532时增量备份集合的全备份。</p>

      <pre class="pre">20170514054532 (full backup)
20170714095512 
20170914081205 
20171114064330 
20180114051246</pre>

      <p class="p">以下<samp class="ph codeph">gprestore</samp>命令指定时间戳20121114064330。时间戳为20120714095512和
        20120914081205的增量备份和全量备份必须都能被恢复程序访问。</p>

      <pre class="pre codeblock">gprestore --timestamp 20121114064330 --redirect-db mystest --create-db</pre>

    </div>

    <div class="section" id="topic1__section9">
<h2 class="title sectiontitle">另见</h2>
      
      <p class="p">
        <samp class="ph codeph"><a class="xref" href="gpbackup.html">gpbackup</a></samp>、<a class="xref" href="../../admin_guide/managing/backup-gpbackup.html">使用gpbackup和gprestore并行备份</a>和<a class="xref" href="../../admin_guide/managing/backup-s3-plugin.html">使用带有gpbackup和gprestore的S3存储插件</a></p>

    </div>

  </div>



        

      </main>
    </div>
  </div>
</div>

<div id="scrim"></div>

<div class="container">
  <footer class="site-footer-links">
    
  </footer>
</div><!--end of container-->

</body>
</html>
