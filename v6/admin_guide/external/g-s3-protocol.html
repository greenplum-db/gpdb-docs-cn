<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  
  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300italic,400italic,400,600' rel='stylesheet' type='text/css'>
  <!-- Use title if it's in the page YAML frontmatter -->
  <title>
      s3:// 协议 |
    Greenplum Database Docs
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/stylesheets/all.css" rel="stylesheet" media="screen, print" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href='/images/favicon.ico' rel='shortcut icon'>

  <script src="/javascripts/all.js"></script>
  
</head>

<body class="x6-0 x6-0_admin_guide x6-0_admin_guide_external x6-0_admin_guide_external_g-s3-protocol has-subnav">

<div class="viewport">
  <div class='wrap'>
    <script type="text/javascript">
      document.domain = "greenplum.org";
    </script>

     
  <header class="header header-layout">
    <h1 class="logo">
      <a href="/">Greenplum Database Documentation</a>
    </h1>
    
    <div class="header-links js-bar-links">
      <div class="btn-menu" data-behavior="MenuMobile"></div>
      <div class="header-item"><a href="https://greenplum.org">Back to Greenplum Database</a></div>
      <div class="header-item">
        <a href="https://github.com/greenplum-db/gpdb/wiki">Wiki</a>
      </div>
      
    </div>
  </header>


    <div class="container">

      <!--googleoff: index-->
      <div id="sub-nav" class="nav-container js-sidenav" role="navigation" >
  <a class="sidenav-title" data-behavior="SubMenuMobile">
    Doc Index
  </a>
  <div class="nav-content">
    
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/../../v6/homenav.html">Greenplum数据库® 6.0文档</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/admin_guide.html">管理员指南</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/intro/partI.html">Greenplum数据库概念</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/intro/arch_overview.html">关于Greenplum的架构</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/intro/about_utilities.html">关于管理和监控工具</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/intro/about_mvcc.html">关于Greenplum数据库中的并发控制</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/intro/mvcc_example.html">管理事务ID的例子</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/intro/about_loading.html">关于并行数据装载</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/intro/about_ha.html">关于Greenplum数据库中的冗余和故障切换</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/intro/about_statistics.html">关于Greenplum数据库中的数据库统计信息</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/managing/partII.html">管理一个Greenplum系统</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/managing/versioning.html">关于Greenplum数据库发布版本号</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/startstop.html">启动和停止Greenplum数据库</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/access_db/topics/g-accessing-the-database.html">访问数据库</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/access_db/topics/g-establishing-a-database-session.html">建立一个数据库会话</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/access_db/topics/g-supported-client-applications.html">支持的客户端应用</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/access_db/topics/g-greenplum-database-client-applications.html">Greenplum数据库客户端应用</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/access_db/topics/g-connecting-with-psql.html">用psql连接</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/access_db/topics/pgbouncer.html">使用PgBouncer连接池</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/access_db/topics/g-database-application-interfaces.html">数据库应用接口</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/access_db/topics/g-troubleshooting-connection-problems.html">连接问题的发现及解决</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/topics/g-configuring-the-greenplum-system.html">配置Greenplum数据库系统</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/topics/g-about-greenplum-master-and-local-parameters.html">关于Greenplum数据库的Master参数和本地参数</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/topics/g-setting-configuration-parameters.html">设置配置参数</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/topics/g-setting-a-local-configuration-parameter.html">设置本地配置参数</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/topics/g-setting-a-master-configuration-parameter.html">设置Master配置参数</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/topics/g-setting-parameters-at-the-system-level.html">设置系统级别参数</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/topics/g-setting-parameters-at-the-database-level.html">设置数据库级别参数</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/topics/g-setting-parameters-at-the-role-level.html">设置角色级别参数</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/topics/g-setting-parameters-in-a-session.html">设置会话级别参数</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/topics/g-viewing-server-configuration-parameter-settings.html">查看服务器配置参数设置</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/topics/g-configuration-parameter-categories.html">配置参数种类</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/compression.html">启用压缩</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/highavail/topics/g-enabling-high-availability-features.html">启用高可用和数据持久化特征</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/highavail/topics/g-overview-of-high-availability-in-greenplum-database.html">Greenplum数据库高可用性概述</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/highavail/topics/g-overview-of-segment-mirroring.html">Segment镜像概述</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/highavail/topics/g-overview-of-master-mirroring.html">Master镜像概述</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/highavail/topics/g-enabling-mirroring-in-greenplum-database.html">在Greenplum数据库中启用镜像</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/highavail/topics/g-enabling-segment-mirroring.html">启用Segment镜像</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/highavail/topics/g-enabling-master-mirroring.html">启用Master镜像</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/highavail/topics/g-detecting-a-failed-segment.html">检测故障的Segment</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/highavail/topics/g-checking-for-failed-segments.html">检测故障Segment</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/highavail/topics/g-checking-the-log-files.html">检查日志文件</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/highavail/topics/g-recovering-a-failed-segment.html">恢复故障Segment</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/highavail/topics/g-recovering-from-segment-failures.html">从Segment故障中恢复</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/highavail/topics/g-when-a-segment-host-is-not-recoverable.html">当一台Segment主机不可恢复时</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/highavail/topics/g-recovering-a-failed-master.html">恢复故障的Master</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/highavail/topics/g-restoring-master-mirroring-after-a-recovery.html">在恢复后还原Master镜像</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/managing/backup-main.html">备份和恢复数据库</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-overview.html">备份和恢复概述</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/managing/backup-gpbackup.html">使用gpbackup和gprestore并行备份</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-gpbackup.html#topic_vh5_1hd_tbb">需求和限制</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-gpbackup.html#topic_x3s_lqj_tbb">备份或还原中包含的对象</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-gpbackup.html#topic_qgj_b3d_tbb">执行基本备份和还原操作</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-gpbackup.html#topic_et4_b5d_tbb">过滤备份或恢复的内容</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-gpbackup.html#topic_qwd_d5d_tbb">配置邮件通知</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-gpbackup.html#topic_xnj_b4c_tbb">理解备份文件</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/managing/backup-gpbackup-incremental.html">使用gpbackup和gprestore创建增量备份</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-gpbackup-incremental.html#topic_kvf_mkr_t2b">关于增量备份集</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-gpbackup-incremental.html#topic_btr_xfr_t2b">使用增量备份</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/managing/backup-boostfs.html">将gpbackup和gprestore与BoostFS一起使用</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-boostfs.html#topic_zp4_mvv_bdb">安装BoostFS</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-boostfs.html#topic_t4z_tvv_bdb">使用BoostFS备份和恢复</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/managing/backup-plugins.html">使用gpbackup存储插件</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-s3-plugin.html">使用带有gpbackup和gprestore的S3存储插件</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/managing/backup-plugin-api.html">备份&#x2F;恢复存储插件API（Beta版）</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/managing/plugin_api/backup_data.html">backup_data</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/plugin_api/backup_file.html">backup_file</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/plugin_api/cleanup_plugin_for_backup.html">cleanup_plugin_for_backup</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/plugin_api/cleanup_plugin_for_restore.html">cleanup_plugin_for_restore</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/plugin_api/plugin_api_version.html">plugin_api_version</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/plugin_api/restore_data.html">restore_data</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/plugin_api/restore_file.html">restore_file</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/plugin_api/setup_plugin_for_backup.html">setup_plugin_for_backup</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/plugin_api/setup_plugin_for_restore.html">setup_plugin_for_restore</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/expand/expand-main.html">扩容Greenplum系统</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/expand/expand-overview.html">系统扩容概述</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/expand/expand-planning.html">规划Greenplum系统扩容</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/expand/expand-nodes.html">准备并增加节点</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/expand/expand-initialize.html">初始化新节点</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/expand/expand-redistribute.html">重分布表</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/expand/expand-rm-schema.html">移除扩容Schema</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/monitor.html">监控Greenplum系统</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/maintain.html">日常系统维护任务</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/monitoring/monitoring.html">Recommended Monitoring and Maintenance Tasks</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/partIII.html">管理Greenplum数据库访问</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/client_auth.html">配置客户端认证</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/ldap.html">使用带TLS&#x2F;SSL的LDAP认证</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/kerberos.html">使用Kerberos认证</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/kerberos-lin-client.html">为Linux客户端进行Kerberos配置</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/kerberos-win-client.html">为Windows客户端进行Kerberos配置</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/roles_privs.html">管理角色与权限</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/ddl/ddl.html">定义数据库对象</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/ddl/ddl-database.html">创建和管理数据库</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/ddl/ddl-tablespace.html">创建和管理表空间</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/ddl/ddl-schema.html">创建和管理SCHEMA</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/ddl/ddl-table.html">创建和管理表</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/ddl/ddl-storage.html">选择表存储模型</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/ddl/ddl-partition.html">对大型表分区</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/ddl/ddl-sequence.html">创建和使用序列</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/ddl/ddl-index.html">在Greenplum数据库中使用索引</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/ddl/ddl-view.html">创建和管理视图</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/distribution.html">分布与倾斜</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/dml.html">插入, 更新, 和删除数据 </a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/query/topics/query.html">查询数据</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/parallel-proc.html">关于Greenplum的查询处理</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/query/topics/query-piv-optimizer.html">关于GPORCA</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-piv-opt-overview.html">GPORCA概述</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-piv-opt-enable.html">启用和禁用GPORCA</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-piv-opt-root-partition.html">收集根分区统计信息</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-piv-opt-notes.html">使用GPORCA时的考虑</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-piv-opt-features.html">GPORCA特性和增强</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-piv-opt-changed.html">GPORCA改变的行为</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-piv-opt-limitations.html">GPORCA的限制</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-piv-opt-fallback.html">判断被使用的查询优化器</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-piv-uniform-part-tbl.html">关于统一多级分区表</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/defining-queries.html">定义查询</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/CTE-query.html">WITH查询（公用表表达式）</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/functions-operators.html">使用函数和操作符</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/json-data.html">使用JSON数据</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/xml-data.html">使用XML数据</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/textsearch/full-text-search.html">使用全文搜索</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/intro.html">关于全文搜索</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/tables-indexes.html">在数据库表中搜索文本</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/controlling.html">控制文本搜索</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/features.html">文本搜索附加功能</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/parsers.html">文本搜索解析器</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/dictionaries.html">文本搜索词典</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/configuration.html">文本搜索配置示例</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/testing.html">测试和调试文本搜索</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/gist-gin.html">文本搜索的GiST和GIN索引</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/psql-support.html">psql支持</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/limitations.html">限制</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-performance.html">查询性能</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/spill-files.html">管理查询生成的溢出文件</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-profiling.html">查询分析</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/external/g-working-with-file-based-ext-tables.html">使用外部数据</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/external/g-external-tables.html">定义外部表</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-file-protocol.html">file:&#x2F;&#x2F;协议</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-gpfdist-protocol.html">gpfdist:&#x2F;&#x2F;协议</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-gpfdists-protocol.html">gpfdists:&#x2F;&#x2F; 协议</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-pxf-protocol.html">pxf:&#x2F;&#x2F; 协议</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-s3-protocol.html">s3:&#x2F;&#x2F; 协议</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-accessing-ext-files-custom-protocol.html">使用自定义协议</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-handling-errors-ext-table-data.html">处理外部表数据中的错误</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-creating-and-using-web-external-tables.html">创建和使用外部Web表</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/external/g-creating-external-tables---examples.html">Examples for Creating External Tables</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-example-1-single-gpfdist-instance-on-single-nic-machine.html">Example 1—Single gpfdist instance on single-NIC machine</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-example-2-multiple-gpfdist-instances.html">Example 2—Multiple gpfdist instances </a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-example-3-multiple-gpfdists-instances.html">Example 3—Multiple gpfdists instances </a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-example-4-single-gpfdist-instance-with-error-logging.html">Example 4—Single gpfdist instance with error logging</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-example-5-text-format-on-a-hadoop-distributed-file-server.html">Example 5—TEXT Format on a Hadoop Distributed File Server</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-example-6-multiple-files-in-csv-format-with-header-rows.html">Example 6—Multiple files in CSV format with header rows</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-example-7-readable-web-external-table-with-script.html">Example 7—Readable External Web Table with Script</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-example-8-writable-external-table-with-gpfdist.html">Example 8—Writable External Table with gpfdist</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-example-9-writable-external-web-table-with-script.html">Example 9—Writable External Web Table with Script</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-example-10-readable-and-writable-external-tables-with-xml-transformations.html">Example 10—Readable and Writable External Tables with XML Transformations</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/pxf-overview.html">使用PXF访问外部数据</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/external/g-foreign.html">使用外部表访问外部数据</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-devel-fdw.html">写一个外部数据的包装器</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-using-the-greenplum-parallel-file-server--gpfdist-.html">使用Greenplum的并行文件服务器（gpfdist）</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-loading-and-unloading-data.html">装载和卸载数据</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-loading-data-using-an-external-table.html">使用外部表装载数据</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-loading-and-writing-non-hdfs-custom-data.html">装载和写入非HDFS自定义数据</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-using-a-custom-format.html">使用一种自定义格式</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-importing-and-exporting-fixed-width-data.html">导入和导出固定宽度的数据</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-examples-read-fixed-width-data.html">例子：读取宽度固定的数据</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-using-a-custom-protocol.html">使用一种自定协议</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-handling-load-errors.html">处理装载错误</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-define-an-external-table-with-single-row-error-isolation.html">定义一个带有单行错误隔离的外部表</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-create-an-error-table-and-declare-a-reject-limit.html">捕捉行格式化错误并且声明拒绝极限 </a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-viewing-bad-rows-in-the-error-table-or-error-log.html">在错误日志中查看不正确的行</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-moving-data-between-tables.html">在表之间移动数据</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-loading-data-with-gpload.html">用gpload装载数据</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/pxf-overview.html">使用PXF访问外部数据</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/transforming-xml-data.html">使用gpfdist和gpload转换外部数据</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-loading-data-with-copy.html">用COPY装载数据</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-running-copy-in-single-row-error-isolation-mode.html">在单行错误隔离模式中运行COPY</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-optimizing-data-load-and-query-performance.html">优化数据装载和查询性能</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-unloading-data-from-greenplum-database.html">从Greenplum数据库卸载数据</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-defining-a-file-based-writable-external-table.html">定义基于文件的可写外部表</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-example-1-greenplum-file-server-gpfdist.html">例 1—Greenplum文件服务器（gpfdist）</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-example-2-hadoop-file-server.html">例 2—Hadoop文件系统(pxf)</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-defining-a-command-based-writable-external-web-table.html">定义基于命令的可写外部Web表</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-disabling-execute-for-web-or-writable-external-tables.html">为Web或者可写外部表禁用EXECUTE</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-unloading-data-using-a-writable-external-table.html">使用可写外部表卸载数据</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-unloading-data-using-copy.html">使用COPY卸载数据</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-formatting-data-files.html">格式化数据文件</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-formatting-rows.html">格式化行</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-formatting-columns.html">格式化列</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-representing-null-values.html">表示NULL值</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-escaping.html">转义</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-escaping-in-text-formatted-files.html">在文本格式的文件中转义</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-escaping-in-csv-formatted-files.html">在CSV格式的文件中转义</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-character-encoding.html">字符编码</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-example-custom-data-access-protocol.html">自定义数据访问协议实例 </a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-installing-the-external-table-protocol.html">安装外部表协议</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-gpextprotocal.c.html">gpextprotocal.c</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/partV.html">性能管理</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/perf_intro.html">管理性能</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/perf_issues.html">性能问题的常见原因</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/wlmgmt_intro.html">Greenplum数据库内存总览</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/wlmgmt.html">管理资源</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/workload_mgmt_resgroups.html">用资源组进行工作负载管理</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/workload_mgmt.html">使用资源队列</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/perf_troubleshoot.html">检修性能问题</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
  </ul>


  </div>
</div>

      <!--googleon: index-->

      <main class="content content-layout" id="js-content" role="main">
        <a id="top"></a>
        
          <h1 class="title-container" style="display: none;">
    s3:// 协议
  </h1>

          <div id="js-quick-links" >
            
          </div>
        <div class="to-top" id="js-to-top">
          <a href="#top" title="back to top"></a>
        </div>
        

   <h1 class="title topictitle1">s3:// 协议</h1>

   
   <div class="body">
<p class="shortdesc"><samp class="ph codeph">s3</samp>协议使用一个URL指定Amazon S3桶的位置和一个用来在桶里读写文件的前缀。</p>

      <p class="p">Amazon简单存储服务（Amazon S3）提供了安全、持久、高可扩展的对象存储。有关Amazon S3的信息请见
      <a class="xref" href="https://aws.amazon.com/s3/" target="_blank">Amazon S3</a>。 </p>

      <p class="p">用户可以定义只读外部表使用S3桶中现有的数据文件作为表数据，或者创建可写外部表将来自于INSERT操作的数据存储到S3桶中的文件。Greenplum数据库使用协议URL中指定的S3 URL以及前缀来为一个只读表选择一个或更多文件，还可以在为
      <samp class="ph codeph">INSERT</samp>操作上传S3文件到可写表中时定义文件位置和文件名格式。</p>

      <p class="p"><samp class="ph codeph">s3</samp>协议也支持<a class="xref" href="https://www.emc.com/en-us/storage/ecs/index.htm" target="_blank">Dell EMC Elastic Cloud Storage</a>（ECS），这是一种与Amazon S3兼容的服务。</p>

      <div class="p">这一主题包含下列小节：<ul class="ul" id="amazon-emr__ul_o15_22r_kx">
            <li class="li"><a class="xref" href="#amazon-emr__s3_prereq">配置和使用S3外部表</a></li>

            <li class="li"><a class="xref" href="#amazon-emr__section_stk_c2r_kx">关于S3协议URL</a></li>

            <li class="li"><a class="xref" href="#amazon-emr__section_c2f_zvs_3x">关于S3数据文件</a></li>

            <li class="li"><a class="xref" href="#amazon-emr__s3_serversideencrypt">s3协议的AWS服务端加密支持</a></li>

            <li class="li"><a class="xref" href="#amazon-emr__s3_proxy">s3协议代理支持</a></li>

            <li class="li"><a class="xref" href="#amazon-emr__s3_config_param">关于S3协议的配置参数</a></li>

            <li class="li"><a class="xref" href="#amazon-emr__s3_config_file">S3协议的配置文件</a></li>

            <li class="li"><a class="xref" href="#amazon-emr__section_tsq_n3t_3x">S3协议的限制</a></li>

            <li class="li"><a class="xref" href="#amazon-emr__s3chkcfg_utility">使用gpcheckcloud工具</a></li>

         </ul>
</div>

      <div class="section" id="amazon-emr__s3_prereq">
<h2 class="title sectiontitle">配置和使用S3外部表</h2>
         
         <div class="p">按照下面这些基本步骤来配置S3协议和使用S3外部表，更多的信息请使用相应的链接。另见<a class="xref" href="#amazon-emr__section_tsq_n3t_3x">S3协议的限制</a>来更好地理解S3外部表的能力和限制：<ol class="ol" id="amazon-emr__ol_pbb_rmq_kx">
               <li class="li">配置每一个数据库支持<samp class="ph codeph">s3</samp>协议：<ol class="ol" type="a" id="amazon-emr__ol_w3z_dpq_kx">
                     <li class="li">在每一个将通过<samp class="ph codeph">s3</samp>协议访问S3桶的数据库中，为
                        <samp class="ph codeph">s3</samp>协议库创建读写函数：
                        <pre class="pre codeblock">CREATE OR REPLACE FUNCTION write_to_s3() RETURNS integer AS
   '$libdir/gps3ext.so', 's3_export' LANGUAGE C STABLE;</pre>
<pre class="pre codeblock">CREATE OR REPLACE FUNCTION read_from_s3() RETURNS integer AS
   '$libdir/gps3ext.so', 's3_import' LANGUAGE C STABLE;</pre>
</li>

                     <li class="li">在每一个将要访问S3桶的数据库中，声明
                           <samp class="ph codeph">s3</samp>协议并且指定前一步中创建的读写函数：<pre class="pre codeblock">CREATE PROTOCOL s3 (writefunc = write_to_s3, readfunc = read_from_s3);</pre>
<div class="note note">
<span class="notetitle">Note:</span> 协议名称<samp class="ph codeph">s3</samp>必须和创建用来访问S3资源的外部表中指定的协议一样。
                              <p class="p">相应的函数会被Greenplum数据库的每一个Segment实例调用。所有的Segment主机必须能够访问该S3桶。</p>
</div>
</li>

                  </ol>
</li>

               <li class="li">在每一个Greenplum数据库的Segment上，创建并且安装<samp class="ph codeph">s3</samp>
                  协议的配置文件：<ol class="ol" type="a" id="amazon-emr__ol_mnq_rnq_kx">
                     <li class="li">使用<samp class="ph codeph">gpcheckcloud</samp>工具创建一个s3协议配置文件的模板：
                     <pre class="pre codeblock">gpcheckcloud -t &gt; ./mytest_s3.config</pre>
</li>

                     <li class="li">编辑该模板文件以指定连接S3位置所需的<samp class="ph codeph">accessid</samp> 和
                           <samp class="ph codeph">secret</samp>。有关其他协议参数的配置请见<a class="xref" href="#amazon-emr__s3_config_file">S3协议的配置文件</a><samp class="ph codeph">s3</samp>协议的配置文件。</li>

                     <li class="li">为Greenplum数据库的所有Segment把该文件复制到所有主机上的相同位置。默认的文件位置是
                              <samp class="ph codeph"><var class="keyword varname">gpseg_data_dir</var>/<var class="keyword varname">gpseg_prefix</var><var class="keyword varname">N</var>/s3/s3.conf</samp>.
                           <var class="keyword varname">gpseg_data_dir</var>是Greenplum数据库的Segment的数据目录路径， <var class="keyword varname">gpseg_prefix</var> 是Segment前缀，而<var class="keyword varname">N</var>是Segment的ID。当用户初始化一个Greenplum数据库系统时，Segment的数据目录、前缀和ID就已经被设置好了。<p class="p">如果用户复制该文件到一个不同的位置或者文件名，那么用户必须用<samp class="ph codeph">s3</samp>协议URL的<samp class="ph codeph">config</samp>参数指定该位置。见<a class="xref" href="#amazon-emr__s3_config_param">关于S3协议的配置参数</a>.</p>
</li>

                     <li class="li">使用<samp class="ph codeph">gpcheckcloud</samp>工具验证到该S3桶的连接性：<pre class="pre codeblock">gpcheckcloud -c "s3://&lt;s3-endpoint&gt;/&lt;s3-bucket&gt; config=./mytest_s3.config"</pre>
<div class="p">为用户的系统的配置文件指定正确的路径，还有用户想要检查的S3端点名和桶。
                              <samp class="ph codeph">gpcheckcloud</samp>会尝试连接到该S3端点并且列出S3桶中的任何文件（如果可用）。一次成功的连接将以这样的消息结束：<pre class="pre codeblock">Your configuration works well.</pre>
用户可以有选择地使用<samp class="ph codeph">gpcheckcloud</samp>来验证对该S3桶进行上传和下载。 正如<a class="xref" href="#amazon-emr__s3chkcfg_utility">使用gpcheckcloud工具</a>中所描述的。</div>
</li>

                  </ol>
</li>

               <li class="li">在完成前几个创建和配置<samp class="ph codeph">s3</samp>协议的步骤后，用户可以在<samp class="ph codeph">CREATE EXTERNAL TABLE</samp>命令中指定一个<samp class="ph codeph">s3</samp>协议URL来定义S3外部表。
               对于只读的S3表，该URL定义组成该S3表的现有数据文件的位置和前缀。例如：
                     <pre class="pre codeblock">CREATE READABLE EXTERNAL TABLE S3TBL (date text, time text, amt int)
   LOCATION('s3://s3-us-west-2.amazonaws.com/s3test.example.com/dataset1/normal/ config=/home/gpadmin/aws_s3/s3.conf')
   FORMAT 'csv';</pre>
<div class="p">对于可写的S3表，协议URL定义S3位置，Greenplum数据库会把该表的数据文件存储在其中，
   该URL还定义了一个对表做<samp class="ph codeph">INSERT</samp>操作创建文件时使用的前缀。
   例如：<pre class="pre codeblock">CREATE WRITABLE EXTERNAL TABLE S3WRIT (LIKE S3TBL)
   LOCATION('s3://s3-us-west-2.amazonaws.com/s3test.example.com/dataset1/normal/ config=/home/gpadmin/aws_s3/s3.conf')
   FORMAT 'csv';</pre>
</div>
<p class="p">参考
                        <a class="xref" href="#amazon-emr__section_stk_c2r_kx">关于S3协议URL</a>获取更多信息。</p>
</li>

            </ol>
</div>

      </div>

      <div class="section" id="amazon-emr__section_stk_c2r_kx">
<h2 class="title sectiontitle">关于S3协议URL</h2>
         
         <p class="p">对于<samp class="ph codeph">s3</samp>协议，用户需要在<samp class="ph codeph">CREATE EXTERNAL TABLE</samp>命令的<samp class="ph codeph">LOCATION</samp>子句中指定文件的位置以及一个可选的配置文件位置。下面是语法：</p>

         <pre class="pre codeblock">'s3://<var class="keyword varname">S3_endpoint</var>[:<var class="keyword varname">port</var>]/<var class="keyword varname">bucket_name</var>/[<var class="keyword varname">S3_prefix</var>] [region=<var class="keyword varname">S3_region</var>] [config=<var class="keyword varname">config_file_location</var>]'</pre>

         <p class="p"><samp class="ph codeph">s3</samp>协议要求指定S3端点和S3桶名。Greenplum数据库的每一个Segment实例必须能够访问该S3位置。可选的<var class="keyword varname">S3_prefix</var>值被用来选择只读S3表的文件，或者被用作向S3可写表上传数据时的文件名前缀。</p>

         <div class="note note">
<span class="notetitle">Note:</span> Greenplum数据库的<samp class="ph codeph">s3</samp>协议的URL必须包括S3的端点主机名。</div>

         <p class="p">要在<samp class="ph codeph">LOCATION</samp>子句中指定一个ECS端点（一种Amazon S3的兼容服务），用户必须把<samp class="ph codeph">s3</samp> 配置文件参数<samp class="ph codeph">version</samp>设置为2。<samp class="ph codeph">version</samp> 参数控制
         <samp class="ph codeph">region</samp>参数是否被用在
               <samp class="ph codeph">LOCATION</samp>子句中。当<samp class="ph codeph">version</samp>参数是2的时候，用户还可以指定一个Amazon S3位置。有关
               <samp class="ph codeph">version</samp>参数更多信息, 参考<a class="xref" href="#amazon-emr__s3_config_file">S3协议的配置文件</a>。</p>

         <div class="note note" id="amazon-emr__s3-prefix-note">
<span class="notetitle">Note:</span> 尽管<var class="keyword varname">S3_prefix</var>是这种语法中一个可选的部分，用户应该总是为可写和只读S3表包括一个S3前缀，它被用来分隔作为<samp class="ph codeph"><a class="xref" href="../../ref_guide/sql_commands/CREATE_EXTERNAL_TABLE.html#topic1">CREATE
                  EXTERNAL TABLE</a></samp>语法一部分的数据集。</div>

         <p class="p">对于可写的S3表，<samp class="ph codeph">s3</samp>协议的URL指定Greenplum数据库为该表上传数据文件的端点和桶名。对于上传文件的S3用户ID，该S3桶的权限必须是<samp class="ph codeph">Upload/Delete</samp>。对于每一个由于向表中插入数据形成的新的上传文件，都会使用这个S3文件前缀。见<a class="xref" href="#amazon-emr__section_c2f_zvs_3x">关于S3数据文件</a>。</p>

         <p class="p">对于只读的S3表，S3文件前缀是可选的。如果用户指定了一个
               <var class="keyword varname">S3_prefix</var>，那么<samp class="ph codeph">s3</samp>协议会选择所有以该前缀开始的文件作为该外部表的数据文件。
               <samp class="ph codeph">s3</samp>协议不使用斜线字符 (<samp class="ph codeph">/</samp>) 作为定界符，因此跟在前缀后面的一个斜线字符会被当做该前缀本身的一部分。</p>

         <p class="p">例如，考虑下面的5个文件，其中的每一个都有名为<samp class="ph codeph">s3-us-west-2.amazonaws.com</samp>的
               <var class="keyword varname">S3_endpoint</var>以及<var class="keyword varname">bucket_name</var>。
            <samp class="ph codeph">test1</samp>:</p>

         <pre class="pre codeblock">s3://s3-us-west-2.amazonaws.com/test1/abc
s3://s3-us-west-2.amazonaws.com/test1/abc/
s3://s3-us-west-2.amazonaws.com/test1/abc/xx
s3://s3-us-west-2.amazonaws.com/test1/abcdef
s3://s3-us-west-2.amazonaws.com/test1/abcdefff</pre>

         <ul class="ul" id="amazon-emr__ul_yll_xjm_qv">
            <li class="li">如果提供的S3 URL是
                  <samp class="ph codeph">s3://s3-us-west-2.amazonaws.com/test1/abc</samp>，那么
                  <samp class="ph codeph">abc</samp>前缀会选择全部的5个文件。</li>

            <li class="li">如果提供的S3 URL是
                  <samp class="ph codeph">s3://s3-us-west-2.amazonaws.com/test1/abc/</samp>，那么
                  <samp class="ph codeph">abc/</samp>前缀选择文件
                  <samp class="ph codeph">s3://s3-us-west-2.amazonaws.com/test1/abc/</samp> 以及
                  <samp class="ph codeph">s3://s3-us-west-2.amazonaws.com/test1/abc/xx</samp>。</li>

            <li class="li">如果提供的S3 URL是
                  <samp class="ph codeph">s3://s3-us-west-2.amazonaws.com/test1/abcd</samp>，那么
                  <samp class="ph codeph">abcd</samp>前缀选择文件
                  <samp class="ph codeph">s3://s3-us-west-2.amazonaws.com/test1/abcdef</samp> 以及
                  <samp class="ph codeph">s3://s3-us-west-2.amazonaws.com/test1/abcdefff</samp>
</li>

         </ul>

         <p class="p"><var class="keyword varname">S3_prefix</var>中不支持通配符字符。不过，S3前缀本来的功能就好像其后有一个通配符一样。</p>

         <p class="p">被S3 URL
               (<var class="keyword varname">S3_endpoint</var>/<var class="keyword varname">bucket_name</var>/<var class="keyword varname">S3_prefix</var>)选中的所有文件都会被用作外部表的来源，因此它们必须有同样的格式。每个文件还必须包含有完整的数据行。一个数据行不能跨文件存在。对于访问这些S3文件的S3用户ID，文件的权限必须是
            <samp class="ph codeph">Open/Download</samp>和<samp class="ph codeph">View</samp>。</p>

         <p class="p">有关Amazon S3端点的信息请见<a class="xref" href="http://docs.aws.amazon.com/general/latest/gr/rande.html#s3_region" target="_blank">http://docs.aws.amazon.com/general/latest/gr/rande.html#s3_region</a>。有关S3桶和文件夹的信息请见Amazon S3的文档<a class="xref" href="https://aws.amazon.com/documentation/s3/" target="_blank">https://aws.amazon.com/documentation/s3/</a>。有关S3文件前缀的信息请见Amazon S3的文档<a class="xref" href="http://docs.aws.amazon.com/AmazonS3/latest/dev/ListingKeysHierarchy.html" target="_blank">Listing Keys Hierarchically Using a Prefix and
               Delimiter</a>.</p>

         <p class="p"><samp class="ph codeph">config</samp>参数指定所需的
               <samp class="ph codeph">s3</samp>协议配置文件的位置，该文件包含AWS连接证书和通信参数。见 <a class="xref" href="#amazon-emr__s3_config_param">关于S3协议的配置参数</a>.</p>

      </div>

      <div class="section" id="amazon-emr__section_c2f_zvs_3x">
<h2 class="title sectiontitle">关于S3数据文件</h2>
         
         <div class="p">对于可写S3表上的每个<samp class="ph codeph">INSERT</samp>操作，Greenplum数据库的每个Segment会使用文件名格式
          <samp class="ph codeph"> &lt;prefix&gt;&lt;segment_id&gt;&lt;random&gt;.&lt;extension&gt;[.gz]</samp>
               其中：<ul class="ul" id="amazon-emr__ul_sw1_qvs_3x">
               <li class="li">
<samp class="ph codeph">&lt;prefix&gt;</samp>是在S3 URL中指定的前缀。</li>

               <li class="li">
<samp class="ph codeph">&lt;segment_id&gt;</samp>是Greenplum数据库的Segment的ID。</li>

               <li class="li">
<samp class="ph codeph">&lt;random&gt;</samp>是一个用来确保文件名唯一的随机数。</li>

               <li class="li">
<samp class="ph codeph">&lt;extension&gt;</samp>描述文件类型（<samp class="ph codeph">.txt</samp> 或
                     <span class="ph filepath">.csv</span>，取决于用户在<samp class="ph codeph">CREATE WRITABLE EXTERNAL
                     TABLE</samp>的<samp class="ph codeph">FORMAT</samp>子句中提供的值）。
                     <samp class="ph codeph">gpcheckcloud</samp>工具创建的文件总是使用扩展名<span class="ph filepath">.data</span>。</li>

               <li class="li">如果为S3可写表启用了压缩（默认启用），会在文件名后追加<span class="ph filepath">.gz</span>。</li>

            </ul>
</div>

         <p class="p">对于可写的S3表，用户可以配置Segment上传文件用的缓冲区尺寸以及线程数量。见<a class="xref" href="#amazon-emr__s3_config_file">S3协议的配置文件</a>。</p>

         <p class="p">对于只读的S3表，所有通过S3的文件位置（<var class="keyword varname">S3_endpoint</var>/<var class="keyword varname">bucket_name</var>/<var class="keyword varname">S3_prefix</var>）指定的文件都被用作该外部表的来源并且都必须具有相同的格式。每个文件还必须包含有完整的数据行。如果这些文件含有一个可选的头部行，头部行中的列名不能包含新行字符（<samp class="ph codeph">\n</samp>)
            以及回车（<samp class="ph codeph">\r</samp>)。 另外，列定界符也不能是新行字符(<samp class="ph codeph">\n</samp>) 或回车
               (<samp class="ph codeph">\r</samp>)。 </p>

         <p class="p"><samp class="ph codeph">s3</samp>协议可以识别gzip格式并且解压这类文件。只支持gzip压缩格式。</p>

         <p class="p">对于访问这些S3文件的S3用户ID，文件的权限必须是<samp class="ph codeph">Open/Download</samp>和<samp class="ph codeph">View</samp>
            。可写的S3表要求该S3用户ID具有<samp class="ph codeph">Upload/Delete</samp>权限。</p>

         <p class="p">对于只读的S3表，每一个Segment一次可以从S3位置使用几个线程下载一个文件。为了利用Greenplum数据库的Segment所执行的并行处理，S3位置中的文件应该在尺寸上相似并且文件的数量应该允许多个Segment从S3位置下载数据。例如，如果Greenplum数据库系统由16个Segment组成并且有充足的网络带宽，在S3位置中创建16个文件允许每个Segment从该S3位置下载一个文件。相反，如果如果该位置只包含1个或者2个文件，就只有1个或者2个Segment能下载数据。</p>

      </div>

      <div class="section" id="amazon-emr__s3_serversideencrypt">
<h2 class="title sectiontitle">s3协议的AWS服务端加密支持</h2>
         
         <p class="p">Greenplum数据库支持用可读和可写外部表（用<samp class="ph codeph">s3</samp>协议创建）访问的AWS S3文件进行服务端加密，服务端加密使用Amazon的S3-managed密钥（SSE-S3）。SSE-S3在用户的对象数据被写入到磁盘时对它们加密，并且在用户访问它们时透明地解密。</p>

         <div class="note note">
<span class="notetitle">Note:</span> <samp class="ph codeph">s3</samp>协议只对Amazon Web Services的S3文件支持SSE-S3。在访问S3兼容服务上的文件时不支持SSE-S3。</div>

         <p class="p">用户的S3 <samp class="ph codeph">accessid</samp> 和 <samp class="ph codeph">secret</samp>权限掌管着用户对所有S3桶对象的访问，不管该数据是否被加密。但是，为了访问加密数据，用户必须配置用户的客户端使用S3-managed密钥。</p>

         <p class="p">有关AWS服务端加密的额外信息，请参考AWS文档中的<a class="xref" href="http://docs.aws.amazon.com/AmazonS3/latest/dev/serv-side-encryption.html" target="_blank">使用服务端加密保护数据</a>。</p>

         <div class="sectiondiv">
            <p class="p"><strong class="ph b">配置S3服务端加密</strong></p>

            <p class="p"><samp class="ph codeph">s3</samp>协议的服务端加密默认被禁用。要在使用Greenplum数据库的<samp class="ph codeph">s3</samp> 协议写入的AWS S3对象上利用服务端加密，用户必须在用户的<samp class="ph codeph">s3</samp>配置文件中把配置参数<samp class="ph codeph">server_side_encryption</samp>设置为值<samp class="ph codeph">sse-s3</samp>：</p>

            <div class="p">
               <pre class="pre codeblock">
server_side_encryption = sse-s3
</pre>

            </div>

            <p class="p">当用户把一个包括了<samp class="ph codeph">server_side_encryption = sse-s3</samp>
            设置的配置文件提供给使用<samp class="ph codeph">s3</samp>的<samp class="ph codeph">CREATE WRITABLE EXTERNAL
                  TABLE</samp>调用时，Greenplum数据库会在该外部表上进行<samp class="ph codeph">INSERT</samp>
            操作时应用加密头部。然后S3会在写<samp class="ph codeph">LOCATION</samp>子句中提供的URI所标识的对象时进行加密。
            </p>

            <p class="p">在通过用<samp class="ph codeph">s3</samp>协议创建的可读外部表访问加密文件时，S3会透明地解密数据。不需要做额外的配置。</p>

            <p class="p">对于更细粒度的加密配置，用户可以考虑创建Amazon
                    Web Services S3的<em class="ph i">桶策略</em>，按照AWS文档的<a class="xref" href="http://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html" target="_blank">Protecting Data Using Server-Side Encryption with
                  Amazon S3-Managed Encryption Keys (SSE-S3)</a>部分标识用户想要加密的对象以及在那些对象上的写动作。</p>

         </div>
      </div>

      <div class="section" id="amazon-emr__s3_proxy">
<h2 class="title sectiontitle">s3协议代理支持</h2>
         
         <p class="p">您可以指定一个URL，该URL是S3用于连接数据源的代理。 S3支持以下协议：HTTP和HTTPS。
         您可以使用<samp class="ph codeph">s3</samp>协议配置参数代理或环境变量指定代理。 如果设置了配置参数，则忽略环境变量。
        </p>

         <div class="p">要使用环境变量指定代理，请根据协议设置环境变量：<samp class="ph codeph">http_proxy</samp>或<samp class="ph codeph">https_proxy</samp>。 您可以通过设置适当的环境变量为每个协议指定不同的URL。 S3支持这些环境变量。
         <ul class="ul" id="amazon-emr__ul_cy3_km2_r1b">
               <li class="li">
<samp class="ph codeph">all_proxy</samp>指定了当特定协议的环境变量没有被设置时的代理URL。</li>

               <li class="li">
<samp class="ph codeph">no_proxy</samp>指定了一个通过环境变量设定的，不使用代理的逗号分割的机器名列表。</li>

            </ul>
</div>

         <p class="p">必须设置环境变量，并且必须可以在所有Greenplum数据库主机上访问Greenplum数据库。</p>

         <p class="p">有关配置参数<samp class="ph codeph">proxy</samp>的更多信息，请参考s3协议配置文件<a class="xref" href="#amazon-emr__s3_config_file">S3协议的配置文件</a>。</p>

      </div>

      <div class="section" id="amazon-emr__s3_config_param">
<h2 class="title sectiontitle">关于S3协议的配置参数</h2>
         
         <p class="p">可选的<samp class="ph codeph">config</samp>参数指定所需的
               <samp class="ph codeph">s3</samp>协议配置文件的位置。该文件包含Amazon Web Services (AWS) 的连接证书和通信参数。有关该文件的信息请见<a class="xref" href="#amazon-emr__s3_config_file">S3协议的配置文件</a>。</p>

         <div class="p">在Greenplum数据库的所有Segment主机上都要求这个配置文件。其默认位置是Greenplum数据库每一个Segment实例的数据目录下的一个位置。<pre class="pre codeblock"><var class="keyword varname">gpseg_data_dir</var>/<var class="keyword varname">gpseg_prefix</var><var class="keyword varname">N</var>/s3/s3.conf</pre>
</div>

         <p class="p"><var class="keyword varname">gpseg_data_dir</var>是该Greenplum数据库Segment的数据目录路径，<var class="keyword varname">gpseg_prefix</var>是该Segment的前缀，而
               <var class="keyword varname">N</var>是该Segment的ID。Segment的数据目录、前缀还有ID都是在初始化一个Greenplum数据库系统时被设置好的。</p>

         <p class="p">如果在Segment主机上有多个Segment实例，用户可以通过在每个Segment主机上创建一个位置来简化配置。
         然后用户可以在<samp class="ph codeph">s3</samp>协议的<samp class="ph codeph">LOCATION</samp>子句中的<samp class="ph codeph">config</samp>参数中指定该位置的绝对路径。这个例子指定了一个位于<samp class="ph codeph">gpadmin</samp>主目录中的位置。</p>

         <pre class="pre codeblock">LOCATION ('s3://s3-us-west-2.amazonaws.com/test/my_data config=/home/gpadmin/s3.conf')</pre>

         <p class="p">该主机上的所有Segment实例都会使用文件
            <samp class="ph codeph">/home/gpadmin/s3.conf</samp>。</p>

      </div>

      <div class="section" id="amazon-emr__s3_config_file">
<h2 class="title sectiontitle">S3协议的配置文件</h2>
         
         <div class="p">当使用<samp class="ph codeph">s3</samp>协议时，Greenplum数据库的所有Segment都要求一个<samp class="ph codeph">s3</samp>协议配置文件。默认位置是：<pre class="pre codeblock"><var class="keyword varname">gpseg_data_dir</var>/<var class="keyword varname">gpseg-prefix</var><var class="keyword varname">N</var>/s3/s3.conf</pre>
</div>

         <p class="p"><var class="keyword varname">gpseg_data_dir</var>是该Greenplum数据库Segment的数据目录路径，<var class="keyword varname">gpseg-prefix</var> 是该Segment的前缀，而
               <var class="keyword varname">N</var>是该Segment的ID。Segment的数据目录、前缀还有ID都是在初始化一个Greenplum数据库系统时被设置好的。</p>

         <p class="p">如果在Segment主机上有多个Segment实例，用户可以通过在每个Segment主机上创建一个位置来简化配置。
         然后用户可以在<samp class="ph codeph">s3</samp>协议的<samp class="ph codeph">LOCATION</samp>子句中的<samp class="ph codeph">config</samp>
         参数中指定该位置的绝对路径。不过，注意只读和可写S3外部表使用相同的参数进行连接。如果用户想为只读和可写S3表配置不同的协议参数，那么用户必须使用两个不同的<samp class="ph codeph">s3</samp>协议配置文件并且在创建每个表时在<samp class="ph codeph">CREATE EXTERNAL TABLE</samp>语句中指定正确的文件。</p>

         <p class="p">这个例子指定一个单一文件位置，它位于<samp class="ph codeph">gpadmin</samp>主目录的的<samp class="ph codeph">s3</samp> 目录中：</p>

         <pre class="pre codeblock">config=/home/gpadmin/s3/s3.conf</pre>

         <p class="p">主机上的所有Segment实例都使用文件
               <samp class="ph codeph">/home/gpadmin/s3/s3.conf</samp>。</p>

         <div class="p">
<samp class="ph codeph">s3</samp>协议配置文件是一个文本文件，它由一个
               <samp class="ph codeph">[default]</samp>小节和参数构成。这里是一个配置文件的例子：<pre class="pre codeblock">[default]
secret = "secret"
accessid = "user access id"
threadnum = 3
chunksize = 67108864</pre>
</div>

         <p class="p">可以使用Greenplum数据库的<samp class="ph codeph">gpcheckcloud</samp>工具来测试S3配置文件。见<a class="xref" href="#amazon-emr__s3chkcfg_utility">使用gpcheckcloud工具</a>.</p>

         <div class="sectiondiv">
            <p class="p"><strong class="ph b">s3配置文件参数</strong></p>

            <dl class="dl parml">
               
                  <dt class="dt pt dlterm">accessid</dt>

                  <dd class="dd pd">必需。访问S3桶的AWS S3 ID。</dd>

               
               
                  <dt class="dt pt dlterm">secret</dt>

                  <dd class="dd pd">必需。访问S3桶的AWS S3 ID的密码。</dd>

               
               
                  <dt class="dt pt dlterm">autocompress</dt>

                  <dd class="dd pd">对于可写的S3外部表，这个参数指定是否在上传到S3之前（使用gzip）压缩文件。如果没有指定这个参数，文件会默认被压缩。</dd>

               
               
                  <dt class="dt pt dlterm">chunksize</dt>

                  <dd class="dd pd">每个Segment线程用来读写S3服务器的缓冲区尺寸。默认是64MB。最小是8MB而最大是128MB。
                  <p class="p">在插入数据到可写S3表时，Greenplum数据库的每个Segment把数据写入到其缓冲区（使用最多<samp class="ph codeph">threadnum</samp>个线程）中直到缓冲区被填满，之后它会把该缓冲区写入到S3桶中的一个文件里。根据需要这一处理会在每个Segment上反复执行直到插入操作完成。</p>

                  <p class="p">因为Amazon S3允许最多10,000个部分的多部分上传，最小8MB的<samp class="ph codeph">chunksize</samp> 值就支持在Greenplum数据库的每个Segment上最大80GB的插入量。最大128MB的<samp class="ph codeph">chunksize</samp> 值支持每个Segment最大1.28TB的插入量。对于可写的S3表，用户必须确保<samp class="ph codeph">chunksize</samp> 的设置能支持表预期的大小。更多有关上传到S3的信息请见S3文档中的<a class="xref" href="http://docs.aws.amazon.com/AmazonS3/latest/dev/mpuoverview.html" target="_blank">Multipart Upload Overview</a>。</p>
</dd>

               
               
                  <dt class="dt pt dlterm">encryption</dt>

                  <dd class="dd pd">使用被安全套接字层（SSL）保护的连接。默认值是<samp class="ph codeph">true</samp>。值<samp class="ph codeph">true</samp>，
                        <samp class="ph codeph">t</samp>，<samp class="ph codeph">on</samp>， <samp class="ph codeph">yes</samp>， 以及
                        <samp class="ph codeph">y</samp> (大小写无关)都被当作是 <samp class="ph codeph">true</samp>。
                     任何其他值都被当成是<samp class="ph codeph">false</samp>。<p class="p">如果在<samp class="ph codeph">CREATE EXTERNAL TABLE</samp>命令的<samp class="ph codeph">LOCATION</samp>子句中的URL没有指定端口，配置文件的
                     <samp class="ph codeph">encryption</samp>参数会影响<samp class="ph codeph">s3</samp>协议使用的端口（HTTP是端口80，HTTPS是端口443）。如果指定了端口，不管encryption设置是什么都会使用那个端口。</p>
</dd>

               
               
                  <dt class="dt pt dlterm">gpcheckcloud_newline</dt>

                  <dd class="dd pd">从S3位置下载文件时，如果文件的最后一行没有EOL（行尾）字符，则<samp class="ph codeph">gpcheckcloud</samp>实用程序会将新行字符附加到文件的最后一行。 默认字符是<samp class="ph codeph">\ n</samp>（换行符）。 值可以是<samp class="ph codeph">\ n</samp>，<samp class="ph codeph">\ r</samp> <samp class="ph codeph">\ n</samp>（回车）或<samp class="ph codeph">\ n \ r</samp>（换行符/回车符）。
                  <p class="p">添加EOL字符可防止一个文件的最后一行与下一个文件的第一行连在一起。</p>
</dd>

               
               
                  <dt class="dt pt dlterm">low_speed_limit</dt>

                  <dd class="dd pd">上传/下载速度下限，以字节每秒为单位。默认速度是10240（10K）。
                  如果上传或者下载速度低于该限制超过<samp class="ph codeph">low_speed_time</samp>所指定的时间，
                  那么该连接会被中止并且重试。在3次重试后，<samp class="ph codeph">s3</samp>协议会返回一个错误。指定值为0表示没有下限。</dd>

               
               
                  <dt class="dt pt dlterm">low_speed_time</dt>

                  <dd class="dd pd">当连接速度低于<samp class="ph codeph">low_speed_limit</samp>时，这个参数指定在中止对S3桶上传或者下载之前应等待的总时间（以秒为单位）。默认值是60秒。指定值为0表示没有时间限制。</dd>

               
               
                  <dt class="dt pt dlterm">proxy</dt>

                  <dd class="dd pd">指定一个URL，该URL是S3用于连接数据源的代理。 S3支持以下协议：HTTP和HTTPS。 这是参数的格式。<pre class="pre codeblock">proxy = <var class="keyword varname">protocol</var>://[<var class="keyword varname">user</var>:<var class="keyword varname">password</var>@]<var class="keyword varname">proxyhost</var>[:<var class="keyword varname">port</var>]</pre>
</dd>

                  <dd class="dd pd">如果未设置此参数或为空字符串（<samp class="ph codeph">proxy =“”</samp>），则S3使用由环境变量<samp class="ph codeph">http_proxy</samp>或<samp class="ph codeph">https_proxy</samp>（以及环境变量<samp class="ph codeph">all_proxy</samp>和<samp class="ph codeph">no_proxy</samp>）指定的代理。 S3使用的环境变量取决于协议。 有关环境变量的信息，请参阅<cite class="cite">Greenplum数据库管理向导</cite>的
                  <a class="xref" href="g-s3-protocol.html#amazon-emr__s3_proxy">s3协议代理支持</a>。</dd>

                  <dd class="dd pd">配置文件中最多只能有一个<samp class="ph codeph">proxy</samp>参数。参数指定的URL是所有支持的协议的代理。</dd>

               
               
                  <dt class="dt pt dlterm">server_side_encryption</dt>

                  <dd class="dd pd">为桶配置的S3服务端加密方法。
                     Greenplum数据库只支持使用Amazon S3-managed密钥的服务端加密，
                     由配置参数值<samp class="ph codeph">sse-s3</samp>表示。
                     默认情况下服务端加密被禁用（值为<samp class="ph codeph">none</samp>)。</dd>

               
               
                  <dt class="dt pt dlterm">threadnum</dt>

                  <dd class="dd pd">对S3桶上传或者下载数据时，一个Segment能够创建的并发线程的最大数量。默认值是4。最小值是1且最大值是8。</dd>

               
               
                  <dt class="dt pt dlterm">verifycert</dt>

                  <dd class="dd pd">控制在HTTPS上建立客户端和S3数据源之间加密通信时<samp class="ph codeph">s3</samp>协议如何处理认证。
                  其值可以是<samp class="ph codeph">true</samp>或者<samp class="ph codeph">false</samp>。
                  默认值是<samp class="ph codeph">true</samp>。
                  <ul class="ul" id="amazon-emr__ul_hxt_gkl_wy">
                        <li class="li">
<samp class="ph codeph">verifycert=false</samp> - 忽略认证错误并且允许HTTPS之上的加密通信。</li>

                        <li class="li">
<samp class="ph codeph">verifycert=true</samp> - 要求合法的认证（一个正确的证书）用于HTTPS之上的加密通信。</li>

                     </ul>
</dd>

                  <dd class="dd pd">在测试和开发环境中设置这个值为<samp class="ph codeph">false</samp>有助于允许无需更改证书的通信。<div class="note warning">
<span class="warningtitle">Warning:</span> 设置这个值为
                           <samp class="ph codeph">false</samp>会在建立客户端和S3数据存储之间的通信时忽略证书，这会暴露出安全性风险。</div>
</dd>

               
               
                  <dt class="dt pt dlterm">version</dt>

                  <dd class="dd pd">指定在<samp class="ph codeph">CREATE EXTERNAL
                        TABLE</samp>命令的<samp class="ph codeph">LOCATION</samp>子句中指定的信息的版本。值可以是
                        <samp class="ph codeph">1</samp>或<samp class="ph codeph">2</samp>。默认值是<samp class="ph codeph">1</samp>。
                  </dd>

                  <dd class="dd pd">如果值是<samp class="ph codeph">1</samp>，则<samp class="ph codeph">LOCATION</samp>子句支持Amazon S3 URL并且不含<samp class="ph codeph">region</samp>
                     参数。如果值是<samp class="ph codeph">2</samp>，则<samp class="ph codeph">LOCATION</samp>
                     支持S3兼容服务并且必须包括<samp class="ph codeph">region</samp>参数。<samp class="ph codeph">region</samp> 参数指定S3数据源的地区。对于下面这个S3 URL 
                        <samp class="ph codeph">s3://s3-us-west-2.amazonaws.com/s3test.example.com/dataset1/normal/</samp>，其AWS S3地区是<samp class="ph codeph">us-west-2</samp>。 </dd>

                  <dd class="dd pd">如果<samp class="ph codeph">version</samp>是1或者没有指定，下面的<samp class="ph codeph">CREATE EXTERNAL
                        TABLE</samp>中的<samp class="ph codeph">LOCATION</samp>子句例子指定了一个Amazon S3端点。<pre class="pre codeblock">LOCATION ('s3://s3-us-west-2.amazonaws.com/s3test.example.com/dataset1/normal/ config=/home/gpadmin/aws_s3/s3.conf')</pre>
</dd>

                  <dd class="dd pd">如果<samp class="ph codeph">version</samp>是2，下面的带<samp class="ph codeph">region</samp>参数的
                  <samp class="ph codeph">LOCATION</samp>(<samp class="ph codeph">CREATE EXTERNAL TABLE</samp>命令的子句）例子指定了一个AWS S3兼容服务。
                  <pre class="pre codeblock">LOCATION ('s3://test.company.com/s3test.company/test1/normal/ region=local-test config=/home/gpadmin/aws_s3/s3.conf') </pre>
</dd>

                  <dd class="dd pd">如果<samp class="ph codeph">version</samp>是2，<samp class="ph codeph">LOCATION</samp>子句还能指定一个Amazon S3端点。
                  这个例子指定了一个使用<samp class="ph codeph">region</samp>参数的Amazon S3端点。
                  <pre class="pre codeblock">LOCATION ('s3://s3-us-west-2.amazonaws.com/s3test.example.com/dataset1/normal/ region=us-west-2 config=/home/gpadmin/aws_s3/s3.conf') </pre>
</dd>

               
            </dl>

            <div class="note note">
<span class="notetitle">Note:</span> <span class="ph" id="amazon-emr__memory-phrase">在上传或者下载S3文件时，Greenplum数据库在每个Segment主机上可能要求最多<samp class="ph codeph">threadnum *
                     chunksize</samp>的内存。在配置Greenplum数据库的总内存时，请考虑这种<samp class="ph codeph">s3</samp> 协议的内存需求。</span>
            </div>

         </div>
      </div>

      <div class="section" id="amazon-emr__section_tsq_n3t_3x">
<h2 class="title sectiontitle">S3协议的限制</h2>
         
         <div class="p">
<samp class="ph codeph">s3</samp>协议有一些限制：<ul class="ul" id="amazon-emr__ul_qqg_qcz_55">
               <li class="li">只支持S3路径风格的URL。<pre class="pre codeblock">s3://<var class="keyword varname">S3_endpoint</var>/<var class="keyword varname">bucketname</var>/[<var class="keyword varname">S3_prefix</var>]</pre>
</li>

               <li class="li">只支持S3端点。该协议不支持S3桶的虚拟主机（绑定一个域名给一个S3桶）。</li>

               <li class="li">支持版本4的AWS签名的签名处理。 <p class="p">有关每种签名处理支持的S3端点的信息，请见<a class="xref" href="http://docs.aws.amazon.com/general/latest/gr/rande.html#s3_region" target="_blank">http://docs.aws.amazon.com/general/latest/gr/rande.html#s3_region</a>。</p>
</li>

               <li class="li">在<samp class="ph codeph">CREATE EXTERNAL TABLE</samp>命令的<samp class="ph codeph">LOCATION</samp>
               子句中只支持一个单一URL和可选的配置文件。
               </li>

               <li class="li">如果在<samp class="ph codeph">CREATE EXTERNAL TABLE</samp>命令中没有指定<samp class="ph codeph">NEWLINE</samp>参数，
               新行字符在特定前缀的所有数据文件中都必须一样。如果在同一个前缀的某些数据文件中有不一样的新行字符，在这些文件上的读操作可能会失败。
               </li>

               <li class="li">对于可写的S3外部表，只支持<samp class="ph codeph">INSERT</samp>操作。不支持<samp class="ph codeph">UPDATE</samp>, <samp class="ph codeph">DELETE</samp>，和
                     <samp class="ph codeph">TRUNCATE</samp>操作。</li>

               <li class="li">因为Amazon S3允许做多10,000个部分的多部分上传，最大128MB的<samp class="ph codeph">chunksize</samp> 值在Greenplum数据库的每个Segment上支持对可写S3表最大1.28TB的插入量。用户必须确保<samp class="ph codeph">chunksize</samp>的设置能支持表预期的大小。更多有关上传到S3的信息请见S3文档中的<a class="xref" href="http://docs.aws.amazon.com/AmazonS3/latest/dev/mpuoverview.html" target="_blank">Multipart Upload Overview</a>。</li>

               <li class="li">为了利用Greenplum数据库的Segment所执行的并行处理，S3位置中的文件应该在尺寸上相似并且文件的数量应该允许多个Segment从S3位置下载数据。例如，如果Greenplum数据库系统由16个Segment组成并且有充足的网络带宽，在S3位置中创建16个文件允许每个Segment从该S3位置下载一个文件。相反，如果如果该位置只包含1个或者2个文件，就只有1个或者2个Segment能下载数据。</li>

            </ul>
</div>

      </div>

      <div class="section" id="amazon-emr__s3chkcfg_utility">
<h2 class="title sectiontitle">使用gpcheckcloud工具</h2>
<p class="p">Greenplum数据库的工具<samp class="ph codeph">gpcheckcloud</samp>帮助用户创建一个<samp class="ph codeph">s3</samp>
            协议配置文件并且测试一个配置文件。用户可以用指定选项来测试用一个配置文件访问S3桶的能力，并且可以选择对该桶中的文件上传或者下载数据。</p>

            <p class="p">如果不用任何选项运行该工具，它会发送一个模板配置文件到<samp class="ph codeph">STDOUT</samp>。用户可以捕捉该输出并且创建一个连接到Amazon S3的<samp class="ph codeph">s3</samp>配置文件。</p>

            <p class="p">该工具被安装在Greenplum数据库的
               <samp class="ph codeph">$GPHOME/bin</samp>目录中。</p>
<strong class="ph b">语法</strong>
         <pre class="pre codeblock">gpcheckcloud {<strong class="ph b">-c</strong> | <strong class="ph b">-d</strong>} "<strong class="ph b">s3://</strong><var class="keyword varname">S3_endpoint</var>/<var class="keyword varname">bucketname</var>/[<var class="keyword varname">S3_prefix</var>] [config=<var class="keyword varname">path_to_config_file</var>]"

gpcheckcloud <strong class="ph b">-u</strong> &lt;file_to_upload&gt; "<strong class="ph b">s3://</strong><var class="keyword varname">S3_endpoint</var>/<var class="keyword varname">bucketname</var>/[<var class="keyword varname">S3_prefix</var>] [config=<var class="keyword varname">path_to_config_file</var>]"
gpcheckcloud <strong class="ph b">-t</strong>

gpcheckcloud <strong class="ph b">-h</strong></pre>

         <strong class="ph b">选项</strong>
         <dl class="dl parml">
            
               <dt class="dt pt dlterm">-c</dt>

               <dd class="dd pd">
<samp class="ph codeph">s3</samp>协议URL中指定的配置连接到指定的S3位置并且返回其中的文件信息。</dd>

               <dd class="dd pd">如果连接失败，该工具显示关于失败的信息，例如非法的证书、前缀或者服务器地址（DNS错误）或服务器不可用。</dd>

            
            
               <dt class="dt pt dlterm">-d</dt>

               <dd class="dd pd">用<samp class="ph codeph">s3</samp>协议URL中指定的配置从指定的S3位置下载数据并且把输出发送到
                     <samp class="ph codeph">STDOUT</samp>。</dd>

               <dd class="dd pd">如果文件被gzip压缩过，解压后的数据会被发送到
                     <samp class="ph codeph">STDOUT</samp>。</dd>

            
            
               <dt class="dt pt dlterm">-u</dt>

               <dd class="dd pd">使用指定的配置文件（如果有）上传一个文件到<samp class="ph codeph">s3</samp>协议URL中指定的S3桶中。使用这个选项可以测试压缩和配置中的<samp class="ph codeph">chunksize</samp> 和 <samp class="ph codeph">autocompress</samp>
                  设置。</dd>

            
            
               <dt class="dt pt dlterm">-t</dt>

               <dd class="dd pd">发送一个模板配置文件到<samp class="ph codeph">STDOUT</samp>。用户可以捕捉该输出并且创建一个连接到Amazon S3的<samp class="ph codeph">s3</samp>配置文件。</dd>

            
            
               <dt class="dt pt dlterm">-h</dt>

               <dd class="dd pd">显示<samp class="ph codeph">gpcheckcloud</samp>帮助。</dd>

            
         </dl>
<p class="p"><strong class="ph b">例子</strong>
         </p>
<div class="p">这个例子运行不带选项的工具在当前目录下创建一个模板
               <samp class="ph codeph">s3</samp>配置文件<samp class="ph codeph">mytest_s3.config</samp>。
               <pre class="pre codeblock">gpcheckcloud -t &gt; ./mytest_s3.config</pre>
</div>

               <div class="p">这个例子尝试使用<samp class="ph codeph">s3</samp>配置文件<samp class="ph codeph">s3.mytestconf</samp>
               上传一个本地文件<span class="ph filepath">test-data.csv</span>到一个S3桶位置：
               :<pre class="pre codeblock">gpcheckcloud -u ./test-data.csv "s3://s3-us-west-2.amazonaws.com/test1/abc config=s3.mytestconf"</pre>
</div>

               <p class="p">一次成功的上传会导致在S3桶中出现一个或者更多个以文件名格式
               <samp class="ph codeph"> abc&lt;segment_id&gt;&lt;random&gt;.data[.gz]</samp>命名的文件。见<a class="xref" href="#amazon-emr__section_c2f_zvs_3x">关于S3数据文件</a>。</p>

               <div class="p">这个例子尝试使用<samp class="ph codeph">s3</samp>配置文件
               <samp class="ph codeph">s3.mytestconf</samp>连接到一个S3桶位置。<pre class="pre codeblock">gpcheckcloud -c "s3://s3-us-west-2.amazonaws.com/test1/abc config=s3.mytestconf"</pre>
</div>

               <div class="p">从该S3桶位置下载所有文件并且发送输出到<samp class="ph codeph">STDOUT</samp>。
            <pre class="pre codeblock">gpcheckcloud -d "s3://s3-us-west-2.amazonaws.com/test1/abc config=s3.mytestconf"</pre>
</div>
</div>

   </div>

<div class="related-links">
<div class="familylinks">
<div class="parentlink">
<strong>Parent topic:</strong> <a class="link" href="../external/g-external-tables.html" title="E外部表允许把外部文件当作常规数据库表来访问。它们常常被用来把数据移进或者移出Greenplum数据库。">定义外部表</a>
</div>
</div>
</div>


        

      </main>
    </div>
  </div>
</div>

<div id="scrim"></div>

<div class="container">
  <footer class="site-footer-links">
    
  </footer>
</div><!--end of container-->

</body>
</html>
