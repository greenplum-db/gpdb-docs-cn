<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  
  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300italic,400italic,400,600' rel='stylesheet' type='text/css'>
  <!-- Use title if it's in the page YAML frontmatter -->
  <title>
      写一个外部数据的包装器 |
    Greenplum Database Docs
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/stylesheets/all.css" rel="stylesheet" media="screen, print" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href='/images/favicon.ico' rel='shortcut icon'>

  <script src="/javascripts/all.js"></script>
  
</head>

<body class="x6-0 x6-0_admin_guide x6-0_admin_guide_external x6-0_admin_guide_external_g-devel-fdw has-subnav">

<div class="viewport">
  <div class='wrap'>
    <script type="text/javascript">
      document.domain = "greenplum.org";
    </script>

     
  <header class="header header-layout">
    <h1 class="logo">
      <a href="/">Greenplum Database Documentation</a>
    </h1>
    
    <div class="header-links js-bar-links">
      <div class="btn-menu" data-behavior="MenuMobile"></div>
      <div class="header-item"><a href="https://greenplum.org">Back to Greenplum Database</a></div>
      <div class="header-item">
        <a href="https://github.com/greenplum-db/gpdb/wiki">Wiki</a>
      </div>
      
    </div>
  </header>


    <div class="container">

      <!--googleoff: index-->
      <div id="sub-nav" class="nav-container js-sidenav" role="navigation" >
  <a class="sidenav-title" data-behavior="SubMenuMobile">
    Doc Index
  </a>
  <div class="nav-content">
    
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/../../6-0/homenav.html">Greenplum数据库® 6.0文档</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/admin_guide.html">管理员指南</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/intro/partI.html">Greenplum数据库概念</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/intro/arch_overview.html">关于Greenplum的架构</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/intro/about_utilities.html">关于管理和监控工具</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/intro/about_mvcc.html">关于Greenplum数据库中的并发控制</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/intro/mvcc_example.html">管理事务ID的例子</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/intro/about_loading.html">关于并行数据装载</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/intro/about_ha.html">关于Greenplum数据库中的冗余和故障切换</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/intro/about_statistics.html">关于Greenplum数据库中的数据库统计信息</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/managing/partII.html">管理一个Greenplum系统</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/versioning.html">关于Greenplum数据库发布版本号</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/startstop.html">启动和停止Greenplum数据库</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/access_db/topics/g-accessing-the-database.html">访问数据库</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/access_db/topics/g-establishing-a-database-session.html">建立一个数据库会话</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/access_db/topics/g-supported-client-applications.html">支持的客户端应用</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/access_db/topics/g-greenplum-database-client-applications.html">Greenplum数据库客户端应用</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/access_db/topics/g-connecting-with-psql.html">用psql连接</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/access_db/topics/pgbouncer.html">使用PgBouncer连接池</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/access_db/topics/g-database-application-interfaces.html">数据库应用接口</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/access_db/topics/g-troubleshooting-connection-problems.html">连接问题的发现及解决</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/topics/g-configuring-the-greenplum-system.html">配置Greenplum数据库系统</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/topics/g-about-greenplum-master-and-local-parameters.html">关于Greenplum数据库的Master参数和本地参数</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/topics/g-setting-configuration-parameters.html">设置配置参数</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/topics/g-setting-a-local-configuration-parameter.html">设置本地配置参数</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/topics/g-setting-a-master-configuration-parameter.html">设置Master配置参数</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/topics/g-setting-parameters-at-the-system-level.html">设置系统级别参数</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/topics/g-setting-parameters-at-the-database-level.html">设置数据库级别参数</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/topics/g-setting-parameters-at-the-role-level.html">设置角色级别参数</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/topics/g-setting-parameters-in-a-session.html">设置会话级别参数</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/topics/g-viewing-server-configuration-parameter-settings.html">查看服务器配置参数设置</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/topics/g-configuration-parameter-categories.html">配置参数种类</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/compression.html">启用压缩</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/highavail/topics/g-enabling-high-availability-features.html">启用高可用和数据持久化特征</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/highavail/topics/g-overview-of-high-availability-in-greenplum-database.html">Greenplum数据库高可用性概述</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/highavail/topics/g-overview-of-segment-mirroring.html">Segment镜像概述</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/highavail/topics/g-overview-of-master-mirroring.html">Master镜像概述</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/highavail/topics/g-enabling-mirroring-in-greenplum-database.html">在Greenplum数据库中启用镜像</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/highavail/topics/g-enabling-segment-mirroring.html">启用Segment镜像</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/highavail/topics/g-enabling-master-mirroring.html">启用Master镜像</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/highavail/topics/g-detecting-a-failed-segment.html">检测故障的Segment</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/highavail/topics/g-checking-for-failed-segments.html">检测故障Segment</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/highavail/topics/g-checking-the-log-files.html">检查日志文件</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/highavail/topics/g-recovering-a-failed-segment.html">恢复故障Segment</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/highavail/topics/g-recovering-from-segment-failures.html">从Segment故障中恢复</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/highavail/topics/g-when-a-segment-host-is-not-recoverable.html">当一台Segment主机不可恢复时</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/highavail/topics/g-recovering-a-failed-master.html">恢复故障的Master</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/highavail/topics/g-restoring-master-mirroring-after-a-recovery.html">在恢复后还原Master镜像</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/managing/backup-main.html">备份和恢复数据库</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/backup-overview.html">备份和恢复概述</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/managing/backup-gpbackup.html">使用gpbackup和gprestore并行备份</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/backup-gpbackup.html#topic_vh5_1hd_tbb">需求和限制</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/backup-gpbackup.html#topic_x3s_lqj_tbb">备份或还原中包含的对象</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/backup-gpbackup.html#topic_qgj_b3d_tbb">执行基本备份和还原操作</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/backup-gpbackup.html#topic_et4_b5d_tbb">过滤备份或恢复的内容</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/backup-gpbackup.html#topic_qwd_d5d_tbb">配置邮件通知</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/backup-gpbackup.html#topic_xnj_b4c_tbb">理解备份文件</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/managing/backup-gpbackup-incremental.html">使用gpbackup和gprestore创建增量备份</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/backup-gpbackup-incremental.html#topic_kvf_mkr_t2b">关于增量备份集</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/backup-gpbackup-incremental.html#topic_btr_xfr_t2b">使用增量备份</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/managing/backup-boostfs.html">将gpbackup和gprestore与BoostFS一起使用</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/backup-boostfs.html#topic_zp4_mvv_bdb">安装BoostFS</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/backup-boostfs.html#topic_t4z_tvv_bdb">使用BoostFS备份和恢复</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/managing/backup-plugins.html">使用gpbackup存储插件</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/backup-s3-plugin.html">使用带有gpbackup和gprestore的S3存储插件</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/managing/backup-plugin-api.html">备份&#x2F;恢复存储插件API（Beta版）</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/plugin_api/backup_data.html">backup_data</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/plugin_api/backup_file.html">backup_file</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/plugin_api/cleanup_plugin_for_backup.html">cleanup_plugin_for_backup</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/plugin_api/cleanup_plugin_for_restore.html">cleanup_plugin_for_restore</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/plugin_api/plugin_api_version.html">plugin_api_version</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/plugin_api/restore_data.html">restore_data</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/plugin_api/restore_file.html">restore_file</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/plugin_api/setup_plugin_for_backup.html">setup_plugin_for_backup</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/plugin_api/setup_plugin_for_restore.html">setup_plugin_for_restore</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/expand/expand-main.html">扩容Greenplum系统</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/expand/expand-overview.html">系统扩容概述</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/expand/expand-planning.html">规划Greenplum系统扩容</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/expand/expand-nodes.html">准备并增加节点</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/expand/expand-initialize.html">初始化新节点</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/expand/expand-redistribute.html">重分布表</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/expand/expand-rm-schema.html">移除扩容Schema</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/monitor.html">监控Greenplum系统</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/managing/maintain.html">日常系统维护任务</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/monitoring/monitoring.html">Recommended Monitoring and Maintenance Tasks</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/partIII.html">管理Greenplum数据库访问</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/client_auth.html">配置客户端认证</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/ldap.html">使用带TLS&#x2F;SSL的LDAP认证</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/kerberos.html">使用Kerberos认证</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/kerberos-lin-client.html">为Linux客户端进行Kerberos配置</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/kerberos-win-client.html">为Windows客户端进行Kerberos配置</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/roles_privs.html">管理角色与权限</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/ddl/ddl.html">定义数据库对象</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/ddl/ddl-database.html">创建和管理数据库</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/ddl/ddl-tablespace.html">创建和管理表空间</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/ddl/ddl-schema.html">创建和管理SCHEMA</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/ddl/ddl-table.html">创建和管理表</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/ddl/ddl-storage.html">选择表存储模型</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/ddl/ddl-partition.html">对大型表分区</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/ddl/ddl-sequence.html">创建和使用序列</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/ddl/ddl-index.html">在Greenplum数据库中使用索引</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/ddl/ddl-view.html">创建和管理视图</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/distribution.html">分布与倾斜</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/dml.html">插入, 更新, 和删除数据 </a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/query/topics/query.html">查询数据</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/query/topics/parallel-proc.html">关于Greenplum的查询处理</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/query/topics/query-piv-optimizer.html">关于GPORCA</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/query/topics/query-piv-opt-overview.html">GPORCA概述</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/query/topics/query-piv-opt-enable.html">启用和禁用GPORCA</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/query/topics/query-piv-opt-root-partition.html">收集根分区统计信息</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/query/topics/query-piv-opt-notes.html">使用GPORCA时的考虑</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/query/topics/query-piv-opt-features.html">GPORCA特性和增强</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/query/topics/query-piv-opt-changed.html">GPORCA改变的行为</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/query/topics/query-piv-opt-limitations.html">GPORCA的限制</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/query/topics/query-piv-opt-fallback.html">判断被使用的查询优化器</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/query/topics/query-piv-uniform-part-tbl.html">关于统一多级分区表</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/query/topics/defining-queries.html">定义查询</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/query/topics/CTE-query.html">WITH查询（公用表表达式）</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/query/topics/functions-operators.html">使用函数和操作符</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/query/topics/json-data.html">使用JSON数据</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/query/topics/xml-data.html">使用XML数据</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/textsearch/full-text-search.html">使用全文搜索</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/textsearch/intro.html">关于全文搜索</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/textsearch/tables-indexes.html">在数据库表中搜索文本</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/textsearch/controlling.html">控制文本搜索</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/textsearch/features.html">文本搜索附加功能</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/textsearch/parsers.html">文本搜索解析器</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/textsearch/dictionaries.html">文本搜索词典</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/textsearch/configuration.html">文本搜索配置示例</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/textsearch/testing.html">测试和调试文本搜索</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/textsearch/gist-gin.html">文本搜索的GiST和GIN索引</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/textsearch/psql-support.html">psql支持</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/textsearch/limitations.html">限制</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/query/topics/query-performance.html">查询性能</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/query/topics/spill-files.html">管理查询生成的溢出文件</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/query/topics/query-profiling.html">查询分析</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/external/g-working-with-file-based-ext-tables.html">使用外部数据</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/external/g-external-tables.html">定义外部表</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/external/g-file-protocol.html">file:&#x2F;&#x2F;协议</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/external/g-gpfdist-protocol.html">gpfdist:&#x2F;&#x2F;协议</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/external/g-gpfdists-protocol.html">gpfdists:&#x2F;&#x2F; 协议</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/external/g-pxf-protocol.html">pxf:&#x2F;&#x2F; 协议</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/external/g-s3-protocol.html">s3:&#x2F;&#x2F; 协议</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/external/g-accessing-ext-files-custom-protocol.html">使用自定义协议</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/external/g-handling-errors-ext-table-data.html">处理外部表数据中的错误</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/external/g-creating-and-using-web-external-tables.html">创建和使用外部Web表</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/external/g-creating-external-tables---examples.html">Examples for Creating External Tables</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/external/g-example-1-single-gpfdist-instance-on-single-nic-machine.html">Example 1—Single gpfdist instance on single-NIC machine</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/external/g-example-2-multiple-gpfdist-instances.html">Example 2—Multiple gpfdist instances </a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/external/g-example-3-multiple-gpfdists-instances.html">Example 3—Multiple gpfdists instances </a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/external/g-example-4-single-gpfdist-instance-with-error-logging.html">Example 4—Single gpfdist instance with error logging</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/external/g-example-5-text-format-on-a-hadoop-distributed-file-server.html">Example 5—TEXT Format on a Hadoop Distributed File Server</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/external/g-example-6-multiple-files-in-csv-format-with-header-rows.html">Example 6—Multiple files in CSV format with header rows</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/external/g-example-7-readable-web-external-table-with-script.html">Example 7—Readable External Web Table with Script</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/external/g-example-8-writable-external-table-with-gpfdist.html">Example 8—Writable External Table with gpfdist</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/external/g-example-9-writable-external-web-table-with-script.html">Example 9—Writable External Web Table with Script</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/external/g-example-10-readable-and-writable-external-tables-with-xml-transformations.html">Example 10—Readable and Writable External Tables with XML Transformations</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/external/pxf-overview.html">使用PXF访问外部数据</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/external/g-foreign.html">使用外部表访问外部数据</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/external/g-devel-fdw.html">写一个外部数据的包装器</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/external/g-using-the-greenplum-parallel-file-server--gpfdist-.html">使用Greenplum的并行文件服务器（gpfdist）</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/load/topics/g-loading-and-unloading-data.html">装载和卸载数据</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-loading-data-using-an-external-table.html">使用外部表装载数据</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/load/topics/g-loading-and-writing-non-hdfs-custom-data.html">装载和写入非HDFS自定义数据</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/load/topics/g-using-a-custom-format.html">使用一种自定义格式</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-importing-and-exporting-fixed-width-data.html">导入和导出固定宽度的数据</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-examples-read-fixed-width-data.html">例子：读取宽度固定的数据</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-using-a-custom-protocol.html">使用一种自定协议</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/load/topics/g-handling-load-errors.html">处理装载错误</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-define-an-external-table-with-single-row-error-isolation.html">定义一个带有单行错误隔离的外部表</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-create-an-error-table-and-declare-a-reject-limit.html">捕捉行格式化错误并且声明拒绝极限 </a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-viewing-bad-rows-in-the-error-table-or-error-log.html">在错误日志中查看不正确的行</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-moving-data-between-tables.html">在表之间移动数据</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-loading-data-with-gpload.html">用gpload装载数据</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/external/pxf-overview.html">使用PXF访问外部数据</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/transforming-xml-data.html">使用gpfdist和gpload转换外部数据</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-loading-data-with-copy.html">用COPY装载数据</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-running-copy-in-single-row-error-isolation-mode.html">在单行错误隔离模式中运行COPY</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-optimizing-data-load-and-query-performance.html">优化数据装载和查询性能</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/load/topics/g-unloading-data-from-greenplum-database.html">从Greenplum数据库卸载数据</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/load/topics/g-defining-a-file-based-writable-external-table.html">定义基于文件的可写外部表</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-example-1-greenplum-file-server-gpfdist.html">例 1—Greenplum文件服务器（gpfdist）</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-example-2-hadoop-file-server.html">例 2—Hadoop文件系统(pxf)</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/load/topics/g-defining-a-command-based-writable-external-web-table.html">定义基于命令的可写外部Web表</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-disabling-execute-for-web-or-writable-external-tables.html">为Web或者可写外部表禁用EXECUTE</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-unloading-data-using-a-writable-external-table.html">使用可写外部表卸载数据</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-unloading-data-using-copy.html">使用COPY卸载数据</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/load/topics/g-formatting-data-files.html">格式化数据文件</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-formatting-rows.html">格式化行</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-formatting-columns.html">格式化列</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-representing-null-values.html">表示NULL值</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/load/topics/g-escaping.html">转义</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-escaping-in-text-formatted-files.html">在文本格式的文件中转义</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-escaping-in-csv-formatted-files.html">在CSV格式的文件中转义</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-character-encoding.html">字符编码</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/load/topics/g-example-custom-data-access-protocol.html">自定义数据访问协议实例 </a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/load/topics/g-installing-the-external-table-protocol.html">安装外部表协议</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/load/topics/g-gpextprotocal.c.html">gpextprotocal.c</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/partV.html">性能管理</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/perf_intro.html">管理性能</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/perf_issues.html">性能问题的常见原因</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/wlmgmt_intro.html">Greenplum数据库内存总览</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/6-0/admin_guide/wlmgmt.html">管理资源</a>
        
  <ul>
    
      <li class="">
        <a href="/6-0/admin_guide/workload_mgmt_resgroups.html">用资源组进行工作负载管理</a>
        

      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/workload_mgmt.html">使用资源队列</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/6-0/admin_guide/perf_troubleshoot.html">检修性能问题</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
  </ul>


  </div>
</div>

      <!--googleon: index-->

      <main class="content content-layout" id="js-content" role="main">
        <a id="top"></a>
        
          <h1 class="title-container" style="display: none;">
    写一个外部数据的包装器
  </h1>

          <div id="js-quick-links" >
            
          </div>
        <div class="to-top" id="js-to-top">
          <a href="#top" title="back to top"></a>
        </div>
        

  <h1 class="title topictitle1">写一个外部数据的包装器</h1>

  <div class="body">
    <p class="p">本章概述了如何写一个新的外部数据包装器。</p>

    <p class="p">外部表上的所有操作都是通过其外部数据包装器（FDW）处理的，FDW是一个包含了Greenplum数据库服务器核心调用的一组函数组成的库。 外部数据包装器负责从远程数据存储中获取数据并将其递交给Greenplum数据库执行器。 如果外部数据支持更新，则包装器也必须能处理。</p>

    <p class="p">当你准备自己写一个包装器的时候，包含在Greenplum数据库在github上的开源仓库里的外部数据包装器是一个很好的参考。
        你需要查阅一下<samp class="ph codeph">contrib/</samp>目录下的
      <samp class="ph codeph"><a class="xref" href="https://github.com/greenplum-db/gpdb/tree/master/contrib/file_fdw" target="_blank">file_fdw</a></samp>
      和<samp class="ph codeph"><a class="xref" href="https://github.com/greenplum-db/gpdb/tree/master/contrib/postgres_fdw" target="_blank">postgres_fdw</a></samp>
      模块。
       <samp class="ph codeph"><a class="xref" href="../../ref_guide/sql_commands/CREATE_FOREIGN_DATA_WRAPPER.html#topic1">CREATE FOREIGN DATA WRAPPER</a></samp>
        的参考页面也提供了一些有用的信息。</p>

    <div class="note note">
<span class="notetitle">Note:</span> 注意: SQL标准里，定义了一个关于写外部数据包装器的接口。Greenplum数据库没有实现这个API，因为适配该API到Greenplum数据库里的成本太高，并且这个API还没有得到广泛的应用。</div>

    <p class="p">该文章包含如下章节：</p>

    <ul class="ul">
      <li class="li"><a class="xref" href="#reqs">需要准备的东西</a></li>

      <li class="li"><a class="xref" href="#limits">已知问题和限制</a></li>

      <li class="li"><a class="xref" href="#includes">头文件</a></li>

      <li class="li"><a class="xref" href="#topic2">外部数据包装器函数</a></li>

      <li class="li"><a class="xref" href="#topic3">外部数据包装器回调函数</a></li>

      <li class="li"><a class="xref" href="#helper">外部数据包装器帮助函数</a></li>

      <li class="li"><a class="xref" href="#topic5">Greenplum数据库注意事项</a></li>

      <li class="li"><a class="xref" href="#pkg">使用PGXS建立一个外部数据包装器扩展</a></li>

      <li class="li"><a class="xref" href="#deployconsider">部署注意事项</a></li>

    </ul>

  </div>

  <div class="related-links">
<div class="familylinks">
<div class="parentlink">
<strong>Parent topic:</strong> <a class="link" href="../external/g-foreign.html">使用外部表访问外部数据</a>
</div>
</div>
</div>
<div class="topic nested1" id="reqs">
    <h2 class="title topictitle2">需要准备的东西</h2>

    <div class="body">
      <p class="p">当开发Greenplum数据库外部数据包装器API时：</p>

      <ul class="ul">
        <li class="li">必须在一个与Greenplum数据库宿主机相同硬件和软件环境的机器上开发你的代码。</li>

        <li class="li">代码必须用version-1的接口，使用像C一样的编译式语言。想更多了解关于C语言调用规则和动态加载，请参考
          <a class="xref" href="https://www.postgresql.org/docs/9.4/xfunc-c.html" target="_blank">C语言函数文档</a>
          。</li>

        <li class="li">目标文件中的符号名称不能有冲突，也不能和Greenplum数据库里冲突。如果出现了这种错误，必须重命名函数和变量。</li>

        <li class="li">复习<a class="xref" href="g-foreign.html#topic1">访问外部数据表</a>中关于外部表的介绍。</li>

      </ul>

    </div>

  </div>

  <div class="topic nested1" id="limits">
    <h2 class="title topictitle2">已知问题和限制</h2>

    <div class="body">
     <p class="p">Greenplum 6 Beta版的外部数据包装器实现包括如下已知问题和限制：</p>

     <ul class="ul">
       <li class="li">Greenplum 6 Beta版不会安装任何外部数据包装器。</li>

       <li class="li">Greenplum数据库仅对外部表扫描使用<samp class="ph codeph">mpp_execute</samp>选项值。
           当插入或更新一个外部表的时候，Greenplum不遵循<samp class="ph codeph">mpp_execute</samp>设置；所有的写操作都从master进行初始化。
           </li>

     </ul>

    </div>

  </div>

  <div class="topic nested1" id="includes">
    <h2 class="title topictitle2">头文件</h2>

    <div class="body">
      <p class="p">开发外部数据包装器过程中可能使用到的头文件在<samp class="ph codeph">greenplum-db/src/include/</samp>目录里
          （针对Greenplum数据库github开源仓库做开发时），或安装在<samp class="ph codeph">$GPHOME/include/postgresql/server/</samp>目录里（针对Greenplum安装版做开发时）：
          </p>

      <ul class="ul">
        <li class="li">foreign/fdwapi.h - FDW API 相关结构体和回调函数</li>

        <li class="li">foreign/foreign.h - FDW帮助相关的结构体和函数</li>

        <li class="li">catalog/pg_foreign_table.h - 外部表定义</li>

        <li class="li">catalog/pg_foreign_server.h - 外部服务定义</li>

      </ul>

      <p class="p">您的FDW代码也可能依赖于访问远程数据存储所需的头文件和库。</p>

    </div>

  </div>

  <div class="topic nested1" id="topic2">
    <h2 class="title topictitle2">外部数据包装器函数</h2>

    <div class="body">
      <p class="p">开发者必须实现一个SQL可调用的处理函数，和一个可选的验证函数。这两个函数必须使用像C一样的编译语言，都用version-1接口。
          </p>

      <p class="p">处理函数会返回一个被Greenplum数据库优化器，执行器和各个维护命令调用的函数指针结构体。
          处理函数必须在Greenplum数据库中注册为不带参数并且返回特殊的伪类型<samp class="ph codeph">fdw_handler</samp>。
          例如：</p>

      <pre class="pre codeblock">CREATE FUNCTION NEW_fdw_handler()
  RETURNS fdw_handler
  AS 'MODULE_PATHNAME'
LANGUAGE C STRICT;</pre>

      <p class="p">写一个外部数据包装器的大部分工作就是实现这些回调函数。
          对于在SQL级别不可见或不可调用的FDW API回调函数和普通的C函数在
          <a class="xref" href="#topic3">Foreign Data Wrapper Callback Functions</a>里有详细描述。
      </p>

      <p class="p">验证器函数负责验证<samp class="ph codeph">CREATE</samp>和<samp class="ph codeph">ALTER</samp>命令中为其外部数据包装器提供的选项，
          以及使用包装器的外部服务器， 用户映射和外部表。
          验证器函数必须注册为带两个参数，一个包含要验证的选项的文本数组，以及一个表示与选项关联的对象类型的OID。例如：
      </p>

      <pre class="pre codeblock">CREATE FUNCTION NEW_fdw_validator( text[], oid )
  RETURNS void
  AS 'MODULE_PATHNAME'
LANGUAGE C STRICT;</pre>

       <p class="p">OID参数反映了对象存储在系统catalog中的类型，其中包括
        <samp class="ph codeph">ForeignDataWrapperRelationId</samp>,
        <samp class="ph codeph">ForeignServerRelationId</samp>,
        <samp class="ph codeph">UserMappingRelationId</samp>, 或
        <samp class="ph codeph">ForeignTableRelationId</samp>. 如果外部数据包装器未提供验证器函数，则Greenplum数据库不会在对象创建时或对象更改时检查选项有效性。</p>

    </div>

  </div>

  <div class="topic nested1" id="topic3">
    <h2 class="title topictitle2">外部数据包装器回调函数</h2>

    <div class="body">
      <p class="p">外部数据包装器API定义了Greenplum数据库在扫描和更新外部表时调用的回调函数。API还包括了对外部表做explain和analyze操作的回调函数。</p>

      <p class="p">外部数据包装器处理函数会返回一个由<samp class="ph codeph">palloc</samp>申请的包含下面描述的回调函数指针的<samp class="ph codeph">FdwRoutine</samp>结构体。
          <samp class="ph codeph">FdwRoutine</samp>结构体存储在头文件<samp class="ph codeph">foreign/fdwapi.h</samp>中，下面是定义：
      </p>

       <pre class="pre codeblock">/*
 * FdwRoutine is the struct returned by a foreign-data wrapper's handler
 * function.  It provides pointers to the callback functions needed by the
 * planner and executor.
 *
 * More function pointers are likely to be added in the future.  Therefore
 * it's recommended that the handler initialize the struct with
 * makeNode(FdwRoutine) so that all fields are set to NULL.  This will
 * ensure that no fields are accidentally left undefined.
 */
typedef struct FdwRoutine
{
	NodeTag		type;

	/* Functions for scanning foreign tables */
	GetForeignRelSize_function GetForeignRelSize;
	GetForeignPaths_function GetForeignPaths;
	GetForeignPlan_function GetForeignPlan;
	BeginForeignScan_function BeginForeignScan;
	IterateForeignScan_function IterateForeignScan;
	ReScanForeignScan_function ReScanForeignScan;
	EndForeignScan_function EndForeignScan;

	/*
	 * Remaining functions are optional.  Set the pointer to NULL for any that
	 * are not provided.
	 */

	/* Functions for updating foreign tables */
	AddForeignUpdateTargets_function AddForeignUpdateTargets;
	PlanForeignModify_function PlanForeignModify;
	BeginForeignModify_function BeginForeignModify;
	ExecForeignInsert_function ExecForeignInsert;
	ExecForeignUpdate_function ExecForeignUpdate;
	ExecForeignDelete_function ExecForeignDelete;
	EndForeignModify_function EndForeignModify;
	IsForeignRelUpdatable_function IsForeignRelUpdatable;

	/* Support functions for EXPLAIN */
	ExplainForeignScan_function ExplainForeignScan;
	ExplainForeignModify_function ExplainForeignModify;

	/* Support functions for ANALYZE */
	AnalyzeForeignTable_function AnalyzeForeignTable;
} FdwRoutine;
</pre>

      <p class="p">必须在外部数据包装器中实现和扫描相关的函数，其他回调函数是可选的。</p>

      <p class="p">扫描相关的函数包括：</p>

      
<div class="tablenoborder">
<table cellpadding="4" cellspacing="0" summary="" id="topic3__in201681" class="table" frame="border" border="1" rules="all">
          
          
          <thead class="thead" align="left">
            <tr class="row">
              <th class="entry" valign="top" width="35.573122529644266%" id="d20013e305">回调签名</th>

              <th class="entry" valign="top" width="64.42687747035573%" id="d20013e308">描述</th>

            </tr>

          </thead>

          <tbody class="tbody">
            <tr class="row">
              <td class="entry" valign="top" width="35.573122529644266%" headers="d20013e305 ">
<pre class="pre codeblock">void
GetForeignRelSize (PlannerInfo *root,
                   RelOptInfo *baserel,
                   Oid foreigntableid)</pre>
</td>

              <td class="entry" valign="top" width="64.42687747035573%" headers="d20013e308 ">获取一个外部表大小的估算值。在对一个外部表做查询计划的开始时调用。</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="35.573122529644266%" headers="d20013e305 ">
<pre class="pre codeblock">void
GetForeignPaths (PlannerInfo *root,
                 RelOptInfo *baserel,
                 Oid foreigntableid)</pre>
</td>

              <td class="entry" valign="top" width="64.42687747035573%" headers="d20013e308 ">为一个外部表的扫描操作创建可能的访问路径。在查询计划过程中调用。
                  <div class="note note">
<span class="notetitle">Note:</span> 注意：一个与Greenplum数据库相兼容的FDW必须在它的
                      <samp class="ph codeph">GetForeignPaths()</samp>回调函数中调用
                      <samp class="ph codeph">create_foreignscan_path()</samp>。</div>

              </td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="35.573122529644266%" headers="d20013e305 ">
<pre class="pre codeblock">ForeignScan *
GetForeignPlan (PlannerInfo *root,
                RelOptInfo *baserel,
                Oid foreigntableid,
                ForeignPath *best_path,
                List *tlist,
                List *scan_clauses)</pre>
</td>

              <td class="entry" valign="top" width="64.42687747035573%" headers="d20013e308 ">从已选择的外部访问路径中创建一个<samp class="ph codeph">ForeignScan</samp>计划节点。
                  在查询计划结束时调用。
              </td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="35.573122529644266%" headers="d20013e305 ">
<pre class="pre codeblock">void
BeginForeignScan (ForeignScanState *node,
                  int eflags)</pre>
</td>

              <td class="entry" valign="top" width="64.42687747035573%" headers="d20013e308 ">开始执行一个外部扫描。在执行器启动时调用。</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="35.573122529644266%" headers="d20013e305 ">
<pre class="pre codeblock">TupleTableSlot *
IterateForeignScan (ForeignScanState *node)</pre>
</td>

              <td class="entry" valign="top" width="64.42687747035573%" headers="d20013e308 ">从外部源获取一行，并在一个元组表槽中返回；如果没有可用的行则返回NULL。</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="35.573122529644266%" headers="d20013e305 ">
<pre class="pre codeblock">void
ReScanForeignScan (ForeignScanState *node)</pre>
</td>

              <td class="entry" valign="top" width="64.42687747035573%" headers="d20013e308 ">从头开始重新扫描。</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="35.573122529644266%" headers="d20013e305 ">
<pre class="pre codeblock">void
EndForeignScan (ForeignScanState *node)</pre>
</td>

              <td class="entry" valign="top" width="64.42687747035573%" headers="d20013e308 ">结束扫描并释放资源。</td>

            </tr>

          </tbody>

        </table>
</div>

      <p class="p">关于FDW回调函数的输入输出更详细的信息，请参考PostgreSQL文档
        <a class="xref" href="https://www.postgresql.org/docs/9.4/fdw-callbacks.html" target="_blank">Foreign Data Wrapper Callback Routines</a>。</p>

    </div>

  </div>

  <div class="topic nested1" id="helper">
    <h2 class="title topictitle2">外部数据包装器帮助函数</h2>

    <div class="body">
      <p class="p">FDW API从Greenplum数据库核心服务输出了几个帮助函数，
          所以外部数据包装器的作者可以轻松的访问FDW相关对象的属性，
          比如当用户创建或修改外部数据包装器、服务或外部表时提供的选项。
          要使用这些帮助函数，必须在源文件里包含<samp class="ph codeph">foreign.h</samp>头文件：
          </p>

      <pre class="pre codeblock">#include "foreign/foreign.h"</pre>

      <p class="p">FDW API包括了下面表格列出的这些帮助函数。
          想了解更多关于这些函数的信息请参考PostgreSQL文档
        <a class="xref" href="https://www.postgresql.org/docs/9.4/fdw-helpers.html" target="_blank">Foreign Data Wrapper Helper Functions</a>。</p>

      
<div class="tablenoborder">
<table cellpadding="4" cellspacing="0" summary="" id="helper__fdw_helper" class="table" frame="border" border="1" rules="all">
          
          
          <thead class="thead" align="left">
            <tr class="row">
              <th class="entry" valign="top" width="35.573122529644266%" id="d20013e445">帮着签名</th>

              <th class="entry" valign="top" width="64.42687747035573%" id="d20013e448">描述</th>

            </tr>

          </thead>

          <tbody class="tbody">
            <tr class="row">
              <td class="entry" valign="top" width="35.573122529644266%" headers="d20013e445 ">
<pre class="pre codeblock">ForeignDataWrapper *
GetForeignDataWrapper(Oid fdwid);</pre>
</td>

              <td class="entry" valign="top" width="64.42687747035573%" headers="d20013e448 ">通过给定的OID，返回外部数据包装器<samp class="ph codeph">ForeignDataWrapper</samp>对象。</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="35.573122529644266%" headers="d20013e445 ">
<pre class="pre codeblock">ForeignDataWrapper *
GetForeignDataWrapperByName(const char *name, bool missing_ok);</pre>
</td>

              <td class="entry" valign="top" width="64.42687747035573%" headers="d20013e448 ">通过给定的名称，返回外部数据包装器<samp class="ph codeph">ForeignDataWrapper</samp>对象。</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="35.573122529644266%" headers="d20013e445 ">
<pre class="pre codeblock">ForeignServer *
GetForeignServer(Oid serverid);</pre>
</td>

              <td class="entry" valign="top" width="64.42687747035573%" headers="d20013e448 ">通过给定的OID，返回外部服务的<samp class="ph codeph">ForeignServer</samp>对象。</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="35.573122529644266%" headers="d20013e445 ">
<pre class="pre codeblock">ForeignServer *
GetForeignServerByName(const char *name, bool missing_ok);</pre>
</td>

              <td class="entry" valign="top" width="64.42687747035573%" headers="d20013e448 ">通过给定的名称，返回外部服务的<samp class="ph codeph">ForeignServer</samp>对象。</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="35.573122529644266%" headers="d20013e445 ">
<pre class="pre codeblock">UserMapping *
GetUserMapping(Oid userid, Oid serverid);</pre>
</td>

              <td class="entry" valign="top" width="64.42687747035573%" headers="d20013e448 ">在给定的服务上为给定的用户返回用户映射<samp class="ph codeph">UserMapping</samp>对象。</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="35.573122529644266%" headers="d20013e445 ">
<pre class="pre codeblock">ForeignTable *
GetForeignTable(Oid relid);</pre>
</td>

              <td class="entry" valign="top" width="64.42687747035573%" headers="d20013e448 ">根据OID返回对应外部表的<samp class="ph codeph">ForeignTable</samp>对象。</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="35.573122529644266%" headers="d20013e445 ">
<pre class="pre codeblock">List *
GetForeignColumnOptions(Oid relid, AttrNumber attnum);</pre>
</td>

              <td class="entry" valign="top" width="64.42687747035573%" headers="d20013e448 ">根据OID对应的外部表和属性编号，返回列的FDW选项。</td>

            </tr>

          </tbody>

        </table>
</div>

    </div>

  </div>

  <div class="topic nested1" id="topic5">
    <h2 class="title topictitle2">Greenplum数据库注意事项</h2>

    <div class="body">
      <p class="p">一个Greenplum数据库用户可以在创建和修改一个外部表、外部服务或外部数据包装器时指定<samp class="ph codeph">mpp_execute</samp>选项。
          一个Greenplum数据库兼容的外部数据包装器会在扫描时检查<samp class="ph codeph">mpp_execute</samp>属性值并根据它决定向哪发送数据，
          包括：向<samp class="ph codeph">master</samp>（默认值），任何节点（master或任何一个节点），或所有节点。</p>

      <div class="note note">
<span class="notetitle">Note:</span> 注意： 不管<samp class="ph codeph">mpp_execute</samp>如何设置，
          使用外部数据包装器的写/更新操作总是在Greenplum数据库master节点上执行。</div>

      <p class="p">下面的扫描代码片段探测与外部表关联的<samp class="ph codeph">mpp_execute</samp>值。</p>

        <pre class="pre codeblock">ForeignTable *table = GetForeignTable(foreigntableid);
if (table-&gt;exec_location == FTEXECLOCATION_ALL_SEGMENTS)
{
    ...
}
else if (table-&gt;exec_location == FTEXECLOCATION_ANY)
{
    ...
}
else if (table-&gt;exec_location == FTEXECLOCATION_MASTER)
{
    ...
} </pre>

      <p class="p">如果外部表创建和外部服务的时候没有设置<samp class="ph codeph">mpp_execute</samp>，
          外部数据包装器会探测并决定。
          如果没有任何一个外部数据相关的对象设置<samp class="ph codeph">mpp_execute</samp>，
          则使用默认的<samp class="ph codeph">master</samp>。
      </p>

      <p class="p">如果外部数据包装器支持<samp class="ph codeph">mpp_execute</samp>设置成<samp class="ph codeph">'all'</samp>，
          它会实现一个Greenplum节点与数据匹配的策略。
          为了不重复的从远处取数据，每个节点上的FDW必须能决定哪部分数据归它负责。
          一个FDW会使用节点标识和节点数量去帮助做这个决定。
          这面这段代码演示了一个外部数据包装器是怎样获取节点编号和节点数量的：
      </p>

      <pre class="pre codeblock">int segmentNumber = GpIdentity.segindex;
int totalNumberOfSegments = getgpsegmentCount();</pre>

    </div>

  </div>

  <div class="topic nested1" id="pkg">
    <h2 class="title topictitle2">使用PGXS建立一个外部数据包装器扩展</h2>

    <div class="body">
      <p class="p">将你用FDW API写的外部数据包装器函数编译成Greenplum数据库按需加载的一个或多个共享库。</p>

      <p class="p">你可以使用PostgreSQL扩展基础库(PGXS)为Greenplum数据库安装构建外部数据包装器的源代码。该框架自动化了简单模块的常用构建规则。如果你需要构建一个更复杂的用例，你必须写自己的构建系统。</p>

      <p class="p">使用PGXS基础库为你的FDW生成一个共享库，创建一个设置好PGXS相关变量的简单的<samp class="ph codeph">Makefile</samp>。</p>

      <div class="note note">
<span class="notetitle">Note:</span> 注意： 请参考<a class="xref" href="https://www.postgresql.org/docs/9.4/extend-pgxs.html" target="_blank">Extension Building Infrastructure</a>
          文档中关于PGXS支持的<samp class="ph codeph">Makefile</samp>变量。</div>

	  <p class="p">例如：下面<samp class="ph codeph">Makefile</samp>根据base_fdw_1.c和base_fdw_2.c这两个C的源文件在当前工作目录生成了一个名字叫<samp class="ph codeph">base_fdw.so</samp>的共享库：
      </p>

      <pre class="pre codeblock">MODULE_big = base_fdw
OBJS = base_fdw_1.o base_fdw_2.o

PG_CONFIG = pg_config
PGXS := $(shell $(PG_CONFIG) --pgxs)

PG_CPPFLAGS = -I$(shell $(PG_CONFIG) --includedir)
SHLIB_LINK = -L$(shell $(PG_CONFIG) --libdir)
include $(PGXS)
</pre>

      <p class="p">下面是<samp class="ph codeph">Makefile</samp>中用到的指令的描述：</p>

      <ul class="ul">
        <li class="li">
<samp class="ph codeph">MODULE_big</samp> - 标识<samp class="ph codeph">Makefile</samp>生成的共享库的基本名称。</li>

        <li class="li">
<samp class="ph codeph">PG_CPPFLAGS</samp> - 将Greenplum数据库安装中的<samp class="ph codeph">include/</samp>目录加到到编译器头文件的查找路径里。</li>

        <li class="li">
<samp class="ph codeph">SHLIB_LINK</samp> 将Greenplum数据库安装中的库目录(<samp class="ph codeph">$GPHOME/lib/</samp>)加到链接查找路径里。</li>

        <li class="li">
<samp class="ph codeph">PG_CONFIG</samp>和<samp class="ph codeph">PGXS</samp>变量设置和<samp class="ph codeph">include</samp>语句是必需的，
            通常位于<samp class="ph codeph">Makefile</samp>的最后三行。</li>

      </ul>

      <p class="p">要将外部数据包装器打包为Greenplum数据库扩展，可以创建脚本
          （<samp class="ph codeph"><var class="keyword varname">newfdw - version</var>.sql</samp>）和控制
          （<samp class="ph codeph"><var class="keyword varname">newfdw</var>.control</samp>）文件，这些文件注册FDW句柄和验证器函数，创建外部数据包装器并识别FDW共享库文件的特征。
      </p>

      <div class="note note">
<span class="notetitle">Note:</span> 注意： PostgreSQL文档<a class="xref" href="https://www.postgresql.org/docs/9.4/extend-extensions.html" target="_blank">Packaging Related Objects into an Extension</a>
        描述了如何打包一个扩展。</div>

      <p class="p">示例名为<samp class="ph codeph">base_fdw--1.0.sql</samp>的外部数据包装器扩展脚本样例：</p>

      <pre class="pre codeblock">CREATE FUNCTION base_fdw_handler()
  RETURNS fdw_handler
  AS 'MODULE_PATHNAME'
LANGUAGE C STRICT;

CREATE FUNCTION base_fdw_validator(text[], oid)
  RETURNS void
  AS 'MODULE_PATHNAME'
LANGUAGE C STRICT;

CREATE FOREIGN DATA WRAPPER base_fdw
  HANDLER base_fdw_handler
  VALIDATOR base_fdw_validator;</pre>

      <p class="p">示例名为<samp class="ph codeph">base_fdw.control</samp>的FDW控制文件：</p>
<pre class="pre codeblock"># base_fdw FDW extension
comment = 'base foreign-data wrapper implementation; does not do much'
default_version = '1.0'
module_pathname = '$libdir/base_fdw'
relocatable = true</pre>

      <p class="p">把下面这些指令加到<samp class="ph codeph">Makefile</samp>里，
          可以指定FDW扩展控制文件的基本名称（<samp class="ph codeph">EXTENSION</samp>）
          和SQL脚本（<samp class="ph codeph">DATA</samp>）：
      </p>

        <pre class="pre codeblock">EXTENSION = base_fdw
DATA = base_fdw--1.0.sql</pre>

      <p class="p">在包含有这些命令的<samp class="ph codeph">Makefile</samp>文件目录里运行<samp class="ph codeph">make install</samp>
          会将共享库、FDW SQL和控制文件拷贝到Greenplum数据库安装目录中（<samp class="ph codeph">$GPHOME</samp>）特定的或默认的位置。
      </p>

    </div>

  </div>

  <div class="topic nested1" id="deployconsider">
    <h2 class="title topictitle2">部署注意事项</h2>

    <div class="body">
      <p class="p">您必须以适合在Greenplum数据库群集中部署的形式打包FDW共享库和扩展文件。当你创建和部署安装包时，考虑一下因素：</p>

      <ul class="ul">
        <li class="li">FDW共享库必须安装到集群中master节点和每个segment节点的相同位置。
            在<samp class="ph codeph">.control</samp>文件里指定这个路径。这个路径通常是<samp class="ph codeph">$GPHOME/lib/postgresql/</samp>。
        </li>

        <li class="li">FDW的<samp class="ph codeph">.sql</samp>和<samp class="ph codeph">.control</samp>文件必须安装到集群中
            master节点和每个segment节点的<samp class="ph codeph">$GPHOME/share/postgresql/extension/</samp>路径。
        </li>

        <li class="li">
<samp class="ph codeph">gpadmin</samp>用户必须拥有访问整个FDW共享库和扩展文件的权限。
        </li>

      </ul>

    </div>

  </div>



        

      </main>
    </div>
  </div>
</div>

<div id="scrim"></div>

<div class="container">
  <footer class="site-footer-links">
    
  </footer>
</div><!--end of container-->

</body>
</html>
