<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  
  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300italic,400italic,400,600' rel='stylesheet' type='text/css'>
  <!-- Use title if it's in the page YAML frontmatter -->
  <title>
      关于Greenplum数据库中的并发控制 |
    Greenplum Database Docs
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/stylesheets/all.css" rel="stylesheet" media="screen, print" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href='/images/favicon.ico' rel='shortcut icon'>

  <script src="/javascripts/all.js"></script>
  
</head>

<body class="x6-0 x6-0_admin_guide x6-0_admin_guide_intro x6-0_admin_guide_intro_about_mvcc has-subnav">

<div class="viewport">
  <div class='wrap'>
    <script type="text/javascript">
      document.domain = "greenplum.org";
    </script>

     
  <header class="header header-layout">
    <h1 class="logo">
      <a href="/">Greenplum Database Documentation</a>
    </h1>
    
    <div class="header-links js-bar-links">
      <div class="btn-menu" data-behavior="MenuMobile"></div>
      <div class="header-item"><a href="https://greenplum.org">Back to Greenplum Database</a></div>
      <div class="header-item">
        <a href="https://github.com/greenplum-db/gpdb/wiki">Wiki</a>
      </div>
      
    </div>
  </header>


    <div class="container">

      <!--googleoff: index-->
      <div id="sub-nav" class="nav-container js-sidenav" role="navigation" >
  <a class="sidenav-title" data-behavior="SubMenuMobile">
    Doc Index
  </a>
  <div class="nav-content">
    
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/../../v6/homenav.html">Greenplum数据库® 6.0文档</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/admin_guide.html">管理员指南</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/intro/partI.html">Greenplum数据库概念</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/intro/arch_overview.html">关于Greenplum的架构</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/intro/about_utilities.html">关于管理和监控工具</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/intro/about_mvcc.html">关于Greenplum数据库中的并发控制</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/intro/mvcc_example.html">管理事务ID的例子</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/intro/about_loading.html">关于并行数据装载</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/intro/about_ha.html">关于Greenplum数据库中的冗余和故障切换</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/intro/about_statistics.html">关于Greenplum数据库中的数据库统计信息</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/managing/partII.html">管理一个Greenplum系统</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/managing/versioning.html">关于Greenplum数据库发布版本号</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/startstop.html">启动和停止Greenplum数据库</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/access_db/topics/g-accessing-the-database.html">访问数据库</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/access_db/topics/g-establishing-a-database-session.html">建立一个数据库会话</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/access_db/topics/g-supported-client-applications.html">支持的客户端应用</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/access_db/topics/g-greenplum-database-client-applications.html">Greenplum数据库客户端应用</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/access_db/topics/g-connecting-with-psql.html">用psql连接</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/access_db/topics/pgbouncer.html">使用PgBouncer连接池</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/access_db/topics/g-database-application-interfaces.html">数据库应用接口</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/access_db/topics/g-troubleshooting-connection-problems.html">连接问题的发现及解决</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/topics/g-configuring-the-greenplum-system.html">配置Greenplum数据库系统</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/topics/g-about-greenplum-master-and-local-parameters.html">关于Greenplum数据库的Master参数和本地参数</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/topics/g-setting-configuration-parameters.html">设置配置参数</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/topics/g-setting-a-local-configuration-parameter.html">设置本地配置参数</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/topics/g-setting-a-master-configuration-parameter.html">设置Master配置参数</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/topics/g-setting-parameters-at-the-system-level.html">设置系统级别参数</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/topics/g-setting-parameters-at-the-database-level.html">设置数据库级别参数</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/topics/g-setting-parameters-at-the-role-level.html">设置角色级别参数</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/topics/g-setting-parameters-in-a-session.html">设置会话级别参数</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/topics/g-viewing-server-configuration-parameter-settings.html">查看服务器配置参数设置</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/topics/g-configuration-parameter-categories.html">配置参数种类</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/compression.html">启用压缩</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/highavail/topics/g-enabling-high-availability-features.html">启用高可用和数据持久化特征</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/highavail/topics/g-overview-of-high-availability-in-greenplum-database.html">Greenplum数据库高可用性概述</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/highavail/topics/g-overview-of-segment-mirroring.html">Segment镜像概述</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/highavail/topics/g-overview-of-master-mirroring.html">Master镜像概述</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/highavail/topics/g-enabling-mirroring-in-greenplum-database.html">在Greenplum数据库中启用镜像</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/highavail/topics/g-enabling-segment-mirroring.html">启用Segment镜像</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/highavail/topics/g-enabling-master-mirroring.html">启用Master镜像</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/highavail/topics/g-detecting-a-failed-segment.html">检测故障的Segment</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/highavail/topics/g-checking-for-failed-segments.html">检测故障Segment</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/highavail/topics/g-checking-the-log-files.html">检查日志文件</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/highavail/topics/g-recovering-a-failed-segment.html">恢复故障Segment</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/highavail/topics/g-recovering-from-segment-failures.html">从Segment故障中恢复</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/highavail/topics/g-when-a-segment-host-is-not-recoverable.html">当一台Segment主机不可恢复时</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/highavail/topics/g-recovering-a-failed-master.html">恢复故障的Master</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/highavail/topics/g-restoring-master-mirroring-after-a-recovery.html">在恢复后还原Master镜像</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/managing/backup-main.html">备份和恢复数据库</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-overview.html">备份和恢复概述</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/managing/backup-gpbackup.html">使用gpbackup和gprestore并行备份</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-gpbackup.html#topic_vh5_1hd_tbb">需求和限制</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-gpbackup.html#topic_x3s_lqj_tbb">备份或还原中包含的对象</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-gpbackup.html#topic_qgj_b3d_tbb">执行基本备份和还原操作</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-gpbackup.html#topic_et4_b5d_tbb">过滤备份或恢复的内容</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-gpbackup.html#topic_qwd_d5d_tbb">配置邮件通知</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-gpbackup.html#topic_xnj_b4c_tbb">理解备份文件</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/managing/backup-gpbackup-incremental.html">使用gpbackup和gprestore创建增量备份</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-gpbackup-incremental.html#topic_kvf_mkr_t2b">关于增量备份集</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-gpbackup-incremental.html#topic_btr_xfr_t2b">使用增量备份</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/managing/backup-boostfs.html">将gpbackup和gprestore与BoostFS一起使用</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-boostfs.html#topic_zp4_mvv_bdb">安装BoostFS</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-boostfs.html#topic_t4z_tvv_bdb">使用BoostFS备份和恢复</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/managing/backup-plugins.html">使用gpbackup存储插件</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/managing/backup-s3-plugin.html">使用带有gpbackup和gprestore的S3存储插件</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/managing/backup-plugin-api.html">备份&#x2F;恢复存储插件API（Beta版）</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/managing/plugin_api/backup_data.html">backup_data</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/plugin_api/backup_file.html">backup_file</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/plugin_api/cleanup_plugin_for_backup.html">cleanup_plugin_for_backup</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/plugin_api/cleanup_plugin_for_restore.html">cleanup_plugin_for_restore</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/plugin_api/plugin_api_version.html">plugin_api_version</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/plugin_api/restore_data.html">restore_data</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/plugin_api/restore_file.html">restore_file</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/plugin_api/setup_plugin_for_backup.html">setup_plugin_for_backup</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/plugin_api/setup_plugin_for_restore.html">setup_plugin_for_restore</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/expand/expand-main.html">扩容Greenplum系统</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/expand/expand-overview.html">系统扩容概述</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/expand/expand-planning.html">规划Greenplum系统扩容</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/expand/expand-nodes.html">准备并增加节点</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/expand/expand-initialize.html">初始化新节点</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/expand/expand-redistribute.html">重分布表</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/expand/expand-rm-schema.html">移除扩容Schema</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/monitor.html">监控Greenplum系统</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/managing/maintain.html">日常系统维护任务</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/monitoring/monitoring.html">Recommended Monitoring and Maintenance Tasks</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/partIII.html">管理Greenplum数据库访问</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/client_auth.html">配置客户端认证</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/ldap.html">使用带TLS&#x2F;SSL的LDAP认证</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/kerberos.html">使用Kerberos认证</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/kerberos-lin-client.html">为Linux客户端进行Kerberos配置</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/kerberos-win-client.html">为Windows客户端进行Kerberos配置</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/roles_privs.html">管理角色与权限</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/ddl/ddl.html">定义数据库对象</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/ddl/ddl-database.html">创建和管理数据库</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/ddl/ddl-tablespace.html">创建和管理表空间</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/ddl/ddl-schema.html">创建和管理SCHEMA</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/ddl/ddl-table.html">创建和管理表</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/ddl/ddl-storage.html">选择表存储模型</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/ddl/ddl-partition.html">对大型表分区</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/ddl/ddl-sequence.html">创建和使用序列</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/ddl/ddl-index.html">在Greenplum数据库中使用索引</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/ddl/ddl-view.html">创建和管理视图</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/distribution.html">分布与倾斜</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/dml.html">插入, 更新, 和删除数据 </a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/query/topics/query.html">查询数据</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/parallel-proc.html">关于Greenplum的查询处理</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/query/topics/query-piv-optimizer.html">关于GPORCA</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-piv-opt-overview.html">GPORCA概述</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-piv-opt-enable.html">启用和禁用GPORCA</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-piv-opt-root-partition.html">收集根分区统计信息</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-piv-opt-notes.html">使用GPORCA时的考虑</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-piv-opt-features.html">GPORCA特性和增强</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-piv-opt-changed.html">GPORCA改变的行为</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-piv-opt-limitations.html">GPORCA的限制</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-piv-opt-fallback.html">判断被使用的查询优化器</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-piv-uniform-part-tbl.html">关于统一多级分区表</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/defining-queries.html">定义查询</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/CTE-query.html">WITH查询（公用表表达式）</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/functions-operators.html">使用函数和操作符</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/json-data.html">使用JSON数据</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/xml-data.html">使用XML数据</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/textsearch/full-text-search.html">使用全文搜索</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/intro.html">关于全文搜索</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/tables-indexes.html">在数据库表中搜索文本</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/controlling.html">控制文本搜索</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/features.html">文本搜索附加功能</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/parsers.html">文本搜索解析器</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/dictionaries.html">文本搜索词典</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/configuration.html">文本搜索配置示例</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/testing.html">测试和调试文本搜索</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/gist-gin.html">文本搜索的GiST和GIN索引</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/psql-support.html">psql支持</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/textsearch/limitations.html">限制</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-performance.html">查询性能</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/spill-files.html">管理查询生成的溢出文件</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/query/topics/query-profiling.html">查询分析</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/external/g-working-with-file-based-ext-tables.html">使用外部数据</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/external/g-external-tables.html">定义外部表</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-file-protocol.html">file:&#x2F;&#x2F;协议</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-gpfdist-protocol.html">gpfdist:&#x2F;&#x2F;协议</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-gpfdists-protocol.html">gpfdists:&#x2F;&#x2F; 协议</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-pxf-protocol.html">pxf:&#x2F;&#x2F; 协议</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-s3-protocol.html">s3:&#x2F;&#x2F; 协议</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-accessing-ext-files-custom-protocol.html">使用自定义协议</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-handling-errors-ext-table-data.html">处理外部表数据中的错误</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-creating-and-using-web-external-tables.html">创建和使用外部Web表</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/external/g-creating-external-tables---examples.html">Examples for Creating External Tables</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-example-1-single-gpfdist-instance-on-single-nic-machine.html">Example 1—Single gpfdist instance on single-NIC machine</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-example-2-multiple-gpfdist-instances.html">Example 2—Multiple gpfdist instances </a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-example-3-multiple-gpfdists-instances.html">Example 3—Multiple gpfdists instances </a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-example-4-single-gpfdist-instance-with-error-logging.html">Example 4—Single gpfdist instance with error logging</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-example-5-text-format-on-a-hadoop-distributed-file-server.html">Example 5—TEXT Format on a Hadoop Distributed File Server</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-example-6-multiple-files-in-csv-format-with-header-rows.html">Example 6—Multiple files in CSV format with header rows</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-example-7-readable-web-external-table-with-script.html">Example 7—Readable External Web Table with Script</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-example-8-writable-external-table-with-gpfdist.html">Example 8—Writable External Table with gpfdist</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-example-9-writable-external-web-table-with-script.html">Example 9—Writable External Web Table with Script</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-example-10-readable-and-writable-external-tables-with-xml-transformations.html">Example 10—Readable and Writable External Tables with XML Transformations</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/pxf-overview.html">使用PXF访问外部数据</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/external/g-foreign.html">使用外部表访问外部数据</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-devel-fdw.html">写一个外部数据的包装器</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/g-using-the-greenplum-parallel-file-server--gpfdist-.html">使用Greenplum的并行文件服务器（gpfdist）</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-loading-and-unloading-data.html">装载和卸载数据</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-loading-data-using-an-external-table.html">使用外部表装载数据</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-loading-and-writing-non-hdfs-custom-data.html">装载和写入非HDFS自定义数据</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-using-a-custom-format.html">使用一种自定义格式</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-importing-and-exporting-fixed-width-data.html">导入和导出固定宽度的数据</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-examples-read-fixed-width-data.html">例子：读取宽度固定的数据</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-using-a-custom-protocol.html">使用一种自定协议</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-handling-load-errors.html">处理装载错误</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-define-an-external-table-with-single-row-error-isolation.html">定义一个带有单行错误隔离的外部表</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-create-an-error-table-and-declare-a-reject-limit.html">捕捉行格式化错误并且声明拒绝极限 </a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-viewing-bad-rows-in-the-error-table-or-error-log.html">在错误日志中查看不正确的行</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-moving-data-between-tables.html">在表之间移动数据</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-loading-data-with-gpload.html">用gpload装载数据</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/external/pxf-overview.html">使用PXF访问外部数据</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/transforming-xml-data.html">使用gpfdist和gpload转换外部数据</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-loading-data-with-copy.html">用COPY装载数据</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-running-copy-in-single-row-error-isolation-mode.html">在单行错误隔离模式中运行COPY</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-optimizing-data-load-and-query-performance.html">优化数据装载和查询性能</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-unloading-data-from-greenplum-database.html">从Greenplum数据库卸载数据</a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-defining-a-file-based-writable-external-table.html">定义基于文件的可写外部表</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-example-1-greenplum-file-server-gpfdist.html">例 1—Greenplum文件服务器（gpfdist）</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-example-2-hadoop-file-server.html">例 2—Hadoop文件系统(pxf)</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-defining-a-command-based-writable-external-web-table.html">定义基于命令的可写外部Web表</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-disabling-execute-for-web-or-writable-external-tables.html">为Web或者可写外部表禁用EXECUTE</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-unloading-data-using-a-writable-external-table.html">使用可写外部表卸载数据</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-unloading-data-using-copy.html">使用COPY卸载数据</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-formatting-data-files.html">格式化数据文件</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-formatting-rows.html">格式化行</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-formatting-columns.html">格式化列</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-representing-null-values.html">表示NULL值</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-escaping.html">转义</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-escaping-in-text-formatted-files.html">在文本格式的文件中转义</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-escaping-in-csv-formatted-files.html">在CSV格式的文件中转义</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-character-encoding.html">字符编码</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-example-custom-data-access-protocol.html">自定义数据访问协议实例 </a>
        
  <ul>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/load/topics/g-installing-the-external-table-protocol.html">安装外部表协议</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/load/topics/g-gpextprotocal.c.html">gpextprotocal.c</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/partV.html">性能管理</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/perf_intro.html">管理性能</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/perf_issues.html">性能问题的常见原因</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/wlmgmt_intro.html">Greenplum数据库内存总览</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="/v6/admin_guide/wlmgmt.html">管理资源</a>
        
  <ul>
    
      <li class="">
        <a href="/v6/admin_guide/workload_mgmt_resgroups.html">用资源组进行工作负载管理</a>
        

      </li>
    
      <li class="">
        <a href="/v6/admin_guide/workload_mgmt.html">使用资源队列</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="/v6/admin_guide/perf_troubleshoot.html">检修性能问题</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


      </li>
    
  </ul>


  </div>
</div>

      <!--googleon: index-->

      <main class="content content-layout" id="js-content" role="main">
        <a id="top"></a>
        
          <h1 class="title-container" style="display: none;">
    关于Greenplum数据库中的并发控制
  </h1>

          <div id="js-quick-links" >
            
          </div>
        <div class="to-top" id="js-to-top">
          <a href="#top" title="back to top"></a>
        </div>
        

  <h1 class="title topictitle1">关于Greenplum数据库中的并发控制</h1>

  
  <div class="body">
<p class="shortdesc">Greenplum数据库使用了PostgreSQL的多版本并发控制（MVCC）模型来管理对于堆表的并发事务。</p>

    <p class="p">数据库管理系统中的并发控制允许在确保数据库的完整性的前提下，并发查询能够完成并且得到正确的结果。
      传统的数据库使用两阶段锁协议来阻止一个事务修改已经被另一个并发事务读取的数据并且阻止任何并发事务读取或者写入另一个事务已经更新的数据。
      协调事务所需的锁增加了数据库中的竞争，降低了总体事务吞吐量。</p>

    <p class="p">Greenplum数据库使用PostgreSQL的多版本并发控制（MVCC）模型来管理堆表的并发。
      通过MVCC，每一个查询都在它开始时的一个数据库快照上操作。
      在执行时，一个查询不能看到其他并发事务所作出的更改。
      这确保了一个查询看到的是数据库的一个一致的视图。
      读取行的查询不会被写入行的事务所阻塞。
      反过来，写入行的查询也不会被读取行的事务所阻塞。
      这使得Greenplum可以达到比使用锁来协调读写事务的传统数据库系统更高的并发度。</p>

    <div class="note note">
<span class="notetitle">Note:</span> 追加优化表使用一种不同于MVCC的并发控制模型管理。它们是为了“一次写，多次读”的应用而设计，这些应用从不或者很少会进行行级更新。</div>

    <div class="section">
<h2 class="title sectiontitle">快照</h2>
      
      <p class="p">MVCC模型依赖于系统能够管理数据行的多个版本的能力。一个查询其实是在该查询开始时的数据库快照上操作。
        快照就是在一个语句或者事务开始时可见的行的集合。快照保证查询在其执行期间看到的是数据库的一个一致且合法的视图。</p>

      <p class="p">每一个事务都会被分配一个唯一的事务ID（XID），它是一个增量式的32位值。
        当一个新事务开始时，它被分配下一个XID。没有被包裹在一个事务中的一个SQL语句会被当做一个单语句事务，即会给它隐式地加上BEGIN和COMMIT。
        这和一些数据库系统中的自动提交概念类似。</p>

      <div class="note note">
<span class="notetitle">Note:</span> Greenplum数据库只为涉及DDL或者DML操作的事务分配XID值，它们通常是唯一需要XID的事务。</div>

      <p class="p">当一个事务插入一行时，其XID会被保存在该行的 xmin系统列中。
        当一个事务删除一行时，其XID会被保存在xmax系统列中。
        更新一行被视为一次删除加上一次插入，因此XID会被保存在当前行的xmax中以及新插入行的xmin中。
        xmin和 xmax列再加上事务完成状态就指定了一个事务的范围，行的这个版本对于其中的事务可见。
        一个事务可以看到所有小于xmin的事务的效果，这些事务确保已经被提交，但它无法看到任何大于等于xmax的事务的效果。</p>

      <p class="p">多语句事务还必须记录一个事务中哪个命令插入了一行（cmin）或者删除了一行（cmax），这样事务能够看到事务中先前的命令所作的更改。
        命令序列只在事务期间有意义，因此在一个事务开始时该序列被重置为0。</p>

      <p class="p">XID是数据库的一个性质。每一个Segment数据库都有其自己的XID序列，因此不能拿它和其他Segment数据库的XID进行比较。
        Master会使用一个集群范围的会话ID号来与Segment协调分布式事务，会话ID号被称为gp_session_id。
        Segment会会维护一个分布式事务ID到其本地XID的映射。
        Master用两阶段提交协议在所有Segment之间协调分布式事务。
        如果一个事务在任一一个Segment上失败，它将会在所有Segment上回滚。</p>

      <div class="p">用户可以用一个SELECT语句查看任意行的xmin、xmax、cmin和 cmax列：<pre class="pre codeblock">SELECT xmin, xmax, cmin, cmax, * FROM <var class="keyword varname">tablename</var>;</pre>
</div>

      <p class="p">因为用户是在Master上运行该SELECT命令，看到的XID都是分布式事务ID。如果用户能在一个Segment数据库上执行该命令，xmin和xmax值将是该Segment的本地XID。</p>

      <div class="note note">
<span class="notetitle">Note:</span> Greenplum数据库会将复制表的每行分发到所有节点上，所以每一行在所有节点上都是重复的。
        每个segment节点维护自己的<samp class="ph codeph">xmin</samp>，<samp class="ph codeph">xmax</samp>，<samp class="ph codeph">cmin</samp>和
        <samp class="ph codeph">cmax</samp>，和<samp class="ph codeph">gp_segment_id</samp>与<samp class="ph codeph">ctid</samp>系统列一样。
        Greenplum数据库不允许用户访问复制表的这些列，因为他们在查询中没有单一、明确的值。
        </div>

    </div>

    <div class="section">
<h2 class="title sectiontitle">事务ID</h2>
      
      <p class="p">MVCC模型使用事务ID（XID）来判断哪些行在一个查询或者事务开始时是可见的。
        XID是一个32位值，因此在该值溢出并且回卷到零之前，一个数据库理论上可以执行超过四十亿个事务。
        不过，Greenplum数据库使用模 232的计算方式来使用XID，这允许事务ID回卷，就像时钟会在十二点回卷一样。
        对于任何给定的XID，有大约二十亿个过去的XID和二十亿个未来的XID。
        直到一行的一个版本存在大约二十亿个事务之前，这一套机制都有效，当这种情况发生时那个版本就会突然变成一个新行。
        为了阻止这种情况的发生，Greenplum有一个被称为 FrozenXID的特殊XID，当把它和任何其他常规XID比较时它都是较老的哪一个。
        如果行中的xmin位于那二十亿个事务之中，就必须被替换为FrozenXID，这也是VACUUM命令执行的功能之一。</p>

      <p class="p">至少在每二十亿个事务时清理数据库可以阻止XID回卷。Greenplum数据库会监控事务ID并且在需要一次VACUUM操作时做出告警。</p>

      <div class="p">当不再可用的事务ID达到可观的比例并且事务ID回卷还没发生时，将会发出一个警告：
        <pre class="pre codeblock">WARNING: database "<var class="keyword varname">database_name</var>" must be vacuumed within <var class="keyword varname">number_of_transactions</var> transactions</pre>
</div>

      <p class="p">当该警告被发出时，就需要一次VACUUM操作。如果没有执行所需的VACUUM操作，当Greenplum数据库达到事务ID回卷发生之前的一个限制点时，它将会停止创建新事务来避免可能的数据丢失并且发出这样的错误：</p>

      <pre class="pre codeblock">FATAL: database is not accepting commands to avoid wraparound data loss in database "<var class="keyword varname">database_name</var>"</pre>

      <p class="p">关于从这种错误恢复的过程请见<a class="xref" href="../managing/maintain.html#topic3__np160654">从一次事务ID限制错误中恢复</a>。</p>

      <p class="p">服务器配置参数xid_warn_limit和 xid_stop_limit控制何时显示这些警告和错误。
        xid_warn_limit参数指定在xid_stop_limit之前多少个事务ID时发出警告。
        xid_stop_limit参数指定在回卷发生之前多少个事务ID时发出错误并且不允许创建新的事务。</p>

    </div>

    <div class="section" id="topic_kl4_pl2_2s__section_f4m_n5n_fs">
<h2 class="title sectiontitle">事务隔离模式</h2>
      
      <div class="p">SQL标准描述了数据库事务并发运行时可能发生的三种现象：<ul class="ul" id="topic_kl4_pl2_2s__ul_up2_tq3_pt">
          <li class="li">
<em class="ph i">脏读 </em> – 一个事务可能读到来自另一个并发事务的未提交数据。</li>

          <li class="li">
<em class="ph i">不可重复读</em> – 在一个事务中两次读取同一行得到不同的结果，因为另一个并发事务在这个事务开始后提交了更改。</li>

          <li class="li">
<em class="ph i">幻读</em> – 在同一个事务中两次执行同一个查询可能返回不同的行集合，因为另一个并发事务增加了行。</li>

        </ul>
</div>

      <p class="p">SQL标准定义了数据库系统需要支持的四种事务隔离模式，以及在事务并发执行时可以出现的现象。
        </p>

      
<div class="tablenoborder">
<table cellpadding="4" cellspacing="0" summary="" id="topic_kl4_pl2_2s__table_gxb_qsz_nt" class="table" frame="border" border="1" rules="all">
<caption><span class="tablecap">Table 1. SQL事务隔离模式</span></caption>
          
          
          
          
          <thead class="thead" align="left">
            <tr class="row">
              <th class="entry" valign="top" width="25%" id="d32304e172">级别</th>

              <th class="entry" valign="top" width="25%" id="d32304e175">脏读</th>

              <th class="entry" valign="top" width="25%" id="d32304e178">不可重复读</th>

              <th class="entry" valign="top" width="25%" id="d32304e181">幻读</th>

            </tr>

          </thead>

          <tbody class="tbody">
            <tr class="row">
              <td class="entry" valign="top" width="25%" headers="d32304e172 ">未提交读</td>

              <td class="entry" valign="top" width="25%" headers="d32304e175 ">可能</td>

              <td class="entry" valign="top" width="25%" headers="d32304e178 ">可能</td>

              <td class="entry" valign="top" width="25%" headers="d32304e181 ">可能</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="25%" headers="d32304e172 ">已提交读</td>

              <td class="entry" valign="top" width="25%" headers="d32304e175 ">不可能</td>

              <td class="entry" valign="top" width="25%" headers="d32304e178 ">可能</td>

              <td class="entry" valign="top" width="25%" headers="d32304e181 ">可能</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="25%" headers="d32304e172 ">可重复读</td>

              <td class="entry" valign="top" width="25%" headers="d32304e175 ">不可能</td>

              <td class="entry" valign="top" width="25%" headers="d32304e178 ">不可能</td>

              <td class="entry" valign="top" width="25%" headers="d32304e181 ">可能</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="25%" headers="d32304e172 ">可串行化</td>

              <td class="entry" valign="top" width="25%" headers="d32304e175 ">不可能</td>

              <td class="entry" valign="top" width="25%" headers="d32304e178 ">不可能</td>

              <td class="entry" valign="top" width="25%" headers="d32304e181 ">不可能</td>

            </tr>

          </tbody>

        </table>
</div>

      <p class="p">Greenplum数据库中未提交读和已提交读行为与SQL标准的已提交读一致。
        Greenplum数据库中可串行化与可重复读隔离级别除了避免了幻读外，行为与SQL标准的已提交读一样。</p>

      <p class="p">已提交读和可重复读的区别是：在已提交读模式下，每个语句可以看到该语句执行前已提交的行；
        在可重复读模式下，语句只能看到该事务启动前提交的行。</p>

      <p class="p">在已提交读模式下，如果另一个并发执行的事务修改了行的值并提交，该行的值读两遍结果可能不同。
        已提交读允许幻读，一个查询执行两次拿到的结果集可能不同。</p>

      <p class="p">可重复读模式避免了非可重复读和幻读，虽然后者并不是标准中所必须的。
        一个尝试着修改其他并发事务修改过的数据的事务将被回滚。
        在可重复读隔离级别下执行事务的应用必须做好处理因为可串行化错误失败的事务。
        如果可重复读对于应用并不是必须的，建议使用已提交读模式。</p>

      <p class="p">可串行化模式，Greenplum数据库并不完全支持，可以保证一组事务在并行执行时得到的结果与串行执行的结果相同。
        在Greenplum数据库里指定可串行化的方式会退化到可重复读模式。
        MVCC 快照隔离(SI)模式在没有昂贵的锁开销的前提下避免了脏读、不可重复读和幻读，
        但是仍然会存在在Greenplum数据库可串行化模式下的事务，无法做到真正的串行化。
        这些异常通常归咎于Greenplum数据库没有执行谓词锁定，即一个事务里的写会影响另一个并行事务里之前读的结果。</p>

      <div class="note note">
<span class="notetitle">Note:</span> PostgreSQL 9.1 可串行化隔离级别引入了一种新的可串行化快照隔离(SSI)模式，可以与SQL标准定义的可串行化隔离级别完全兼容。
        这个模式在Greenplum数据库中不可用。
        SSI监视可能导致序列化异常的条件的并发事务。
        当发现了潜在的串行化错误，一个事务被提交，其余的被回滚，并且必须重试。</div>

      <p class="p">Greenplum数据库并行运行的事务需要检查并识别可能并行更新相同数据的交互。
        通过使用显式表锁或要求冲突事务更新以表示冲突的虚拟行，可以防止发现的问题。</p>

      <div class="p">SQL语句<samp class="ph codeph">SET TRANSACTION ISOLATION LEVEL</samp>可以设置当前事务的隔离级别。
        必须要在执行
        <samp class="ph codeph">SELECT</samp>,
          <samp class="ph codeph">INSERT</samp>, <samp class="ph codeph">DELETE</samp>, <samp class="ph codeph">UPDATE</samp>, or
          <samp class="ph codeph">COPY</samp>
        语句前设置:<pre class="pre codeblock">BEGIN;
SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;
...
COMMIT;
</pre>
</div>

      <div class="p">隔离模式也可以在BEGIN语句里指定：
        <pre class="pre codeblock">BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;</pre>
</div>

      <p class="p">可以通过设置<var class="keyword varname">default_transaction_isolation</var>配置项来改变会话的默认隔离级别。</p>

    </div>

    <div class="section">
<h2 class="title sectiontitle">从表中移除过期的行</h2>
      
      <p class="p">更新或者删除一行会在表中留下该行的一个过期版本。
        当一个过期的行不在被任何活跃事务引用时，它可以被移除从而腾出其所占用的空间进行重用。
        VACUUM命令会标记过期行所使用的空间可以被重用。</p>

      <p class="p">当表中的过期行累积后，为了容纳新的行就必须扩展磁盘文件。
        这样执行查询所需的磁盘I/O就会增加，从而性能受到影响。
        这种情况被称为膨胀，并且应该通过定期清理表来解决。</p>

      <p class="p">VACUUM命令（不带FULL）可以与其他查询并行运行。
        它会标记之前被过期行所占用的空间为空闲可用。如果剩余的空闲空间数量可观，它会把该页面加到该表的空闲空间映射中。
        当Greenplum数据库之后需要空间分配给新行时，它首先会参考该表的空闲空间映射以寻找有可用空间的页面。
        如果没有找到这样的页面，它会为该文件追加新的页面。</p>

      <p class="p">VACUUM（不带FULL）不会合并页面或者减小表在磁盘上的尺寸。
        它回收的空间只是放在空闲空间映射中表示可用。为了阻止磁盘文件大小增长，重要的是足够频繁地运行VACUUM。
        运行VACUUM的频率取决于表中更新和删除（插入只会增加新行）的频率。
        重度更新的表可能每天需要运行几次VACUUM来确保通过空闲空间映射能找到可用的空闲空间。
        在运行了一个更新或者删除大量行的事务之后运行VACUUM也非常重要。</p>

      <p class="p">VACUUM FULL命令会把表重写为没有过期行，并且将表减小到其最小尺寸。
        表中的每一页都会被检查，其中的可见行被移动到前面还没有完全填满的页面中。
        空页面会被丢弃。该表会被一直锁住直到VACUUM FULL完成。
        相对于常规的VACUUM命令来说，它是一种非常昂贵的操作，可以用定期的清理来避免或者推迟这种操作。
        最好是在一个维护期来运行VACUUM FULL。VACUUM FULL的一种替代方案是用一个CREATE TABLE AS语句重新创建该表并且删除掉旧表。</p>

      <p class="p">用户可以运行VACUUM VERBOSE tablename来得到一份Segment上已移除的死亡行数量、受影响页面数以及有可用空闲空间页面数的报告。</p>

      <div class="p">查询pg_class系统表可以找出一个表在所有Segment上使用了多少页面。注意首先对该表执行ANALYZE确保得到的是准确的数据。
        <pre class="pre codeblock">SELECT relname, relpages, reltuples FROM pg_class WHERE relname='<var class="keyword varname">tablename</var>';</pre>
</div>

      <p class="p">另一个有用的工具是gp_toolkit方案中的gp_bloat_diag视图，它通过比较一个表使用的实际页数和预期的页数来确定表膨胀。
        更多有关gp_bloat_diag的内容请见Greenplum数据库参考指南中的“gp_toolkit管理方案”。</p>

    </div>

  </div>

<div class="related-links">
<ul class="ullinks">
<li class="link ulchildlink">
<strong><a href="../intro/mvcc_example.html">管理事务ID的例子</a></strong><br>
</li>
</ul>

<div class="familylinks">
<div class="parentlink">
<strong>Parent topic:</strong> <a class="link" href="../intro/partI.html" title="这一节给出了Greenplum数据库组件和特性的概述，例如高可用性、并行数据装载特性以及管理工具。">Greenplum数据库概念</a>
</div>
</div>
</div>


        

      </main>
    </div>
  </div>
</div>

<div id="scrim"></div>

<div class="container">
  <footer class="site-footer-links">
    
  </footer>
</div><!--end of container-->

</body>
</html>
